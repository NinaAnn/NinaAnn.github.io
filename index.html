<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="English">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Nina&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Nina&#39;s Blog">
<meta property="og:locale" content="English">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nina&#39;s Blog">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Nina's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="English">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Nina's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Good Good Study, Day Day Up</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/20/golangå­¦ä¹ ç¬”è®°ä¸‰ï¼šContext/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/20/golangå­¦ä¹ ç¬”è®°ä¸‰ï¼šContext/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°ä¸‰ï¼šContext
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-20 22:08:41 / Modified: 22:12:19" itemprop="dateCreated datePublished" datetime="2020-02-20T22:08:41+08:00">2020-02-20</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å­¦ä¹ å®Œå…¨æ²¡æœ‰é¡ºåºï¼Œå°±æ˜¯å†™serverçš„æ—¶å€™çœ‹åˆ°ä¸æ‡‚çš„å°±å»å­¦ï¼Œä½¿ç”¨å¯¼å‘å‹å­¦ä¹ ã€‚ã€‚ã€‚</p>
<p>http serverå¤ªç»å¸¸çœ‹åˆ°contextäº†ä½†æ˜¯åˆä¸æ˜¯ç‰¹åˆ«äº†è§£ï¼Œå°±å»ç¿»äº†ä¸€ä¸‹å®˜ç½‘å’Œå„ç§å¥‡æ€ªçš„åšå®¢ğŸ˜‚</p>
<p>å®˜ç½‘æ–‡æ¡£ï¼š<a href="https://pkg.go.dev/golang.org/x/net/context" target="_blank" rel="noopener">https://pkg.go.dev/golang.org/x/net/context</a></p>
<p>å®˜æ–¹åšå®¢ï¼š<a href="https://blog.golang.org/context" target="_blank" rel="noopener">https://blog.golang.org/context</a></p>
<h2 id="ä¸ºä»€ä¹ˆæœ‰context"><a href="#ä¸ºä»€ä¹ˆæœ‰context" class="headerlink" title="ä¸ºä»€ä¹ˆæœ‰context"></a>ä¸ºä»€ä¹ˆæœ‰context</h2><p>å†…å®¹æ˜¯æŠ„çš„ğŸ˜‚ï¼ŒåŸæ–‡æŸåšå®¢ï¼š<a href="https://www.cnblogs.com/qcrao-2018/archive/2019/06/12/11007503.html" target="_blank" rel="noopener">https://www.cnblogs.com/qcrao-2018/archive/2019/06/12/11007503.html</a></p>
<p>è®²å¾—æ ¼å¤–æ¸…æ¥šï¼Œæ²¡æœ‰åŠ¨åŠ›å†å»å†™ä¸€æ¬¡ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œå½“æœ‰ä¸€ä¸ªrequestè¿‡æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå¼€å¾ˆå¤šgoroutineå»åšä¸åŒçš„å¤„ç†ï¼Œæ¯”å¦‚è·å–æ•°æ®åº“ç­‰ç­‰ï¼Œcontextå°±æ˜¯ç»™è¿™äº›goroutineé—´çš„å…±äº«å€¼ä¼ é€’æä¾›ä¸€ä¸ªæ–¹æ³•ã€‚</p>
<p><img src="/../images/go/without_context.png" alt="without context"></p>
<p><img src="/../images/go/with_context.png" alt="with context"></p>
<p>æ–‡ä¸­ä¸¾äº†ä¸¤ä¸ªåœºæ™¯ï¼Œä¸€ä¸ªæ˜¯å„ç§goroutineéœ€è¦åŒä¸€ä¸ªtokenï¼Œä¹Ÿå°±æ˜¯ä¼ ç»Ÿæ„ä¹‰çš„å…±äº«å€¼ï¼Œå¦ä¸€ä¸ªå°±æ˜¯å½“æŸé¡¹æ“ä½œå¡ä½æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¶…æ—¶æ§åˆ¶ï¼Œgoroutineå°±ä¼šéšç€requestçš„åˆ°æ¥è¶Šå¼€è¶Šå¤šè¶Šå¼€è¶Šå¤šï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªå…¬å…±çš„deadlineåšè¶…æ—¶å–æ¶ˆçš„æ“ä½œã€‚</p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å›åˆ°å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A Context carries a deadline, cancelation signal, and request-scoped values</span></span><br><span class="line"><span class="comment">// across API boundaries. Its methods are safe for simultaneous use by multiple</span></span><br><span class="line"><span class="comment">// goroutines.</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="comment">// Done returns a channel that is closed when this Context is canceled</span></span><br><span class="line">    <span class="comment">// or times out.</span></span><br><span class="line">    Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Err indicates why this context was canceled, after the Done channel</span></span><br><span class="line">    <span class="comment">// is closed.</span></span><br><span class="line">    Err() error</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Deadline returns the time when this Context will be canceled, if any.</span></span><br><span class="line">    Deadline() (deadline time.Time, ok <span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Value returns the value associated with key or nil if none.</span></span><br><span class="line">    Value(key <span class="keyword">interface</span>&#123;&#125;) <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å››ä¸ªä¹Ÿå°±æ˜¯ä¸€ä¸ªcontextæ‰€éœ€è¦æœ‰çš„åŸºæœ¬å‡½æ•°ï¼ŒDoneè¿”å›ä¸€ä¸ªè¢«å…³é—­çš„channelï¼Œä¸ºä»€ä¹ˆè¦ç”¨ä¸€ä¸ªè¢«å…³é—­çš„channelï¼Ÿæ˜¯å› ä¸ºgoroutineä»ä¸€ä¸ªè¢«å…³é—­çš„channelé‡Œæ˜¯å¯ä»¥å–å‡ºé›¶å€¼çš„ï¼Œæ‰€ä»¥ä¸€æ—¦goroutineä»é‡Œé¢å–å‡ºé›¶å€¼ï¼Œå°±æ„å‘³ç€å®ƒå¯ä»¥åœæ­¢å¹¶ä¸”å¼€å§‹åšä¸€äº›æ”¶å°¾å·¥ä½œäº†ã€‚åŒæ—¶Errå‡½æ•°ä¼šè¿”å›é”™è¯¯åŸå› ã€‚</p>
<h3 id="APIä»‹ç»"><a href="#APIä»‹ç»" class="headerlink" title="APIä»‹ç»"></a>APIä»‹ç»</h3><h4 id="Backgroundå’ŒTODO"><a href="#Backgroundå’ŒTODO" class="headerlink" title="Backgroundå’ŒTODO"></a>Backgroundå’ŒTODO</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> emptyCtx <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Deadline</span><span class="params">()</span> <span class="params">(deadline time.Time, ok <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Done</span><span class="params">()</span> &lt;-<span class="title">chan</span> <span class="title">struct</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Err</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>backgroundå’Œtodoå°±æ˜¯æ ¹æ®ä¸Šé¢çš„å®ç°</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Background</span><span class="params">()</span> <span class="title">Context</span></span></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºçš„å°±æ˜¯ä¸€ä¸ªç©ºçš„contextï¼Œå› ä¸ºé‡Œé¢çš„Doneè¿”å›çš„channelæ˜¯ç©ºï¼Œæ‰€ä»¥å…¶å®å®ƒæ°¸è¿œä¹Ÿä¸ä¼šè¢«cancelï¼ŒTODOå°±æ˜¯åœ¨ä½ ä¸çŸ¥é“è¦ä¼ ä»€ä¹ˆè¿›å»çš„æ—¶å€™å…ˆæ‹¿æ¥å ä¸ªä½ç½®ã€‚</p>
<h4 id="WithCancel"><a href="#WithCancel" class="headerlink" title="WithCancel"></a>WithCancel</h4><p>å¾ˆå¤šæ—¶å€™è¶…æ—¶çš„æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœæ­¢æ‰€æœ‰çš„coroutineï¼Œæ‰“ä¸ªæ¯”æ–¹è·å–dbè¶…æ—¶äº†ï¼Œé‚£æˆ‘ä»¬å¸Œæœ›é€€å‡ºdbçš„goroutineï¼ŒæŠŠä¸€ä¸ªè¶…æ—¶çš„errorç»™åˆ°serverï¼Œserverå†è¿”å›è¿™ä¸ªerrorï¼Œä¹Ÿå°±æ˜¯å­goroutineï¼ˆä¸Šé¢çš„goroutineb,câ€¦ï¼‰åœæ­¢çš„æƒ…å†µä¸‹æˆ‘ä»¬ä¸å¸Œæœ›çˆ¶goroutineï¼ˆä¸Šé¢çš„goroutine aï¼‰ä¹Ÿç»™åœäº†ã€‚è¿™ä¸ªæ—¶å€™å°±æœ‰äº†withcancelã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCancel</span><span class="params">(parent Context)</span> <span class="params">(ctx Context, cancel CancelFunc)</span></span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨withcancelï¼Œä¼šæ ¹æ®çˆ¶contextåˆ›å»ºä¸€ä¸ªdeadlineä¸æ¯”çˆ¶contextæ™šçš„å­contextï¼Œå­contexté‡Œé¢ä¼šæœ‰ä¸€ä¸ªæ–°çš„channelï¼Œè¿™ä¸ªchannelè¢«å…³é—­æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p>
<ul>
<li>ddlè¶…äº†</li>
<li>è¿”å›çš„é‚£ä¸ªCancelFuncè¢«å¼•ç”¨äº†</li>
<li>çˆ¶contextçš„Done channelè¢«å…³äº†ã€‚</li>
</ul>
<h4 id="WithTimeout"><a href="#WithTimeout" class="headerlink" title="WithTimeout"></a>WithTimeout</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(parent Context, timeout time.Duration)</span> <span class="params">(Context, CancelFunc)</span></span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯å¦‚æœç¨‹åºè¿è¡Œè¶…æ—¶ï¼Œå°±è‡ªå·±cancelæ‰ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">slowOperationWithTimeout</span><span class="params">(ctx context.Context)</span> <span class="params">(Result, error)</span></span> &#123;</span><br><span class="line">	ctx, cancel := context.WithTimeout(ctx, <span class="number">100</span>*time.Millisecond)</span><br><span class="line">	<span class="keyword">defer</span> cancel()  <span class="comment">// releases resources if slowOperation completes before timeout elapses</span></span><br><span class="line">	<span class="keyword">return</span> slowOperation(ctx)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„defer cancel() æ˜¯å½“æ•´ä¸ªå‡½æ•°æ­£å¸¸è¿›è¡Œå¹¶ä¸”é€€å‡ºï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰è¶…æ—¶çš„æƒ…å†µä¸‹ï¼‰ï¼Œéœ€è¦åœ¨é€€å‡ºä¹‹å‰æ¸…ç†ä¸€ä¸‹ï¼ˆdeferçš„å…·ä½“æƒ…å†µè¯¦è§go errorï¼‰</p>
<h4 id="WithValue"><a href="#WithValue" class="headerlink" title="WithValue"></a>WithValue</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key <span class="keyword">interface</span>&#123;&#125;, val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Context</span></span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡contextä¼ å€¼çš„è¿‡ç¨‹ï¼Œå®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼šè¿”å›çˆ¶contextä¸­keyå¯¹åº”çš„å€¼ï¼Œä¹Ÿå°±æ˜¯valueï¼Œæ‰“ä¸ªæ¯”æ–¹è·å–appidä¹‹ç±»çš„ï¼Ÿ</p>
<p>å…¶å®æ ¹æ®é‚£ä¸ªåšå®¢çš„æºä»£ç æè¿°ï¼Œå…¶å®æ¯æ¬¡è·å–valueçš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªcontextå­˜äº†å°±ç”¨è‡ªå·±çš„ï¼Œæ²¡æœ‰å°±å¾€ä¸Šæ‰¾ï¼Œæ‰€ä»¥å­˜ä¸åŒçš„å€¼ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ï¼Œä½†æ˜¯åœ¨å®é™…ä½¿ç”¨æ—¶éå¸¸å®¹æ˜“é™·å…¥æ··ä¹±ï¼Œæ‰€ä»¥å®˜æ–¹æ–‡æ¡£æœ€åæäº†ä¸€ä¸ªçœŸè¯šçš„å»ºè®®ï¼š<strong>Use context Values only for request-scoped data that transits processes and APIs, not for passing optional parameters to functions. </strong> ç¿»è¯‘è¿‡æ¥å°±æ˜¯åªç”¨æ¥ä¼ requestèŒƒå›´å†…çš„å€¼ï¼Œåˆ«å»å½“å‡½æ•°ä¼ å‚é‚£ä¹ˆç”¨ğŸ˜‚ã€‚</p>
<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><h3 id="canceleræ¥å£"><a href="#canceleræ¥å£" class="headerlink" title="canceleræ¥å£"></a>canceleræ¥å£</h3><p>å‰é¢å·²ç»æ”¾äº†Contextæ¥å£ï¼Œè¿™é‡Œé¦–å…ˆæŠŠcanceleræ¥å£æ”¾ä¸€ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> canceler <span class="keyword">interface</span> &#123;</span><br><span class="line">    cancel(removeFromParent <span class="keyword">bool</span>, err error)</span><br><span class="line">    Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WithCancelçš„å®ç°"><a href="#WithCancelçš„å®ç°" class="headerlink" title="WithCancelçš„å®ç°"></a>WithCancelçš„å®ç°</h3><p>ç„¶åæ˜¯æ ¹æ®Contextæ¥å£æ´¾ç”Ÿï¼ˆgoè¯­è¨€ä¼¼ä¹ä¸èƒ½è¿™ä¹ˆè¯´ä½†æ˜¯æ¯”è¾ƒå¥½ç†è§£ï¼‰çš„cancelContextç»“æ„ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> cancelCtx <span class="keyword">struct</span> &#123;</span><br><span class="line">    Context</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿æŠ¤ä¹‹åçš„å­—æ®µ</span></span><br><span class="line">    mu       sync.Mutex</span><br><span class="line">    done     <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">    children <span class="keyword">map</span>[canceler]<span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">    err      error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ˜¯Doneçš„å®ç°</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cancelCtx)</span> <span class="title">Done</span><span class="params">()</span> &lt;-<span class="title">chan</span> <span class="title">struct</span></span>&#123;&#125; &#123;</span><br><span class="line">    c.mu.Lock()</span><br><span class="line">    <span class="keyword">if</span> c.done == <span class="literal">nil</span> &#123;</span><br><span class="line">        c.done = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    d := c.done</span><br><span class="line">    c.mu.Unlock()</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åæ­£å°±æ˜¯è¿”å›ä¸€ä¸ªç©ºçš„æ–°channelï¼Œè¿™ä¸ªchannelæ²¡åœ°æ–¹å»å†™å…¥ï¼Œæ‰€ä»¥é™¤éå…³é—­ä¸ç„¶å°±ä¼šä¸€ç›´å¡ä½ã€‚</p>
<p>ç„¶åå°±æ˜¯cancelæ–¹æ³•çš„ä¹¦å†™ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cancelCtx)</span> <span class="title">cancel</span><span class="params">(removeFromParent <span class="keyword">bool</span>, err error)</span></span> &#123;</span><br><span class="line">    <span class="comment">// å¿…é¡»è¦ä¼  err</span></span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"context: internal error: missing cancel error"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    c.mu.Lock()</span><br><span class="line">    <span class="keyword">if</span> c.err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.mu.Unlock()</span><br><span class="line">        <span class="keyword">return</span> <span class="comment">// å·²ç»è¢«å…¶ä»–åç¨‹å–æ¶ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»™ err å­—æ®µèµ‹å€¼</span></span><br><span class="line">    c.err = err</span><br><span class="line">    <span class="comment">// å…³é—­ channelï¼Œé€šçŸ¥å…¶ä»–åç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> c.done == <span class="literal">nil</span> &#123;</span><br><span class="line">        c.done = closedchan</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">close</span>(c.done)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†å®ƒçš„æ‰€æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> child := <span class="keyword">range</span> c.children &#123;</span><br><span class="line">        <span class="comment">// é€’å½’åœ°å–æ¶ˆæ‰€æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">        child.cancel(<span class="literal">false</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†å­èŠ‚ç‚¹ç½®ç©º</span></span><br><span class="line">    c.children = <span class="literal">nil</span></span><br><span class="line">    c.mu.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> removeFromParent &#123;</span><br><span class="line">        <span class="comment">// ä»çˆ¶èŠ‚ç‚¹ä¸­ç§»é™¤è‡ªå·± </span></span><br><span class="line">        removeChild(c.Context, c)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠ„çš„è¿˜æ˜¯ç¬¬ä¸€ç« çš„åšå®¢ï¼Œå†™çš„å¯æ¸…æ¥šäº†æ‡’å¾—å†åŠ ä¸œè¥¿ã€‚å…·ä½“ç©¶ç«Ÿä»€ä¹ˆæ—¶å€™ä»çˆ¶èŠ‚ç‚¹ä¸­ç§»é™¤è‡ªå·±ä»€ä¹ˆæ—¶å€™ä¸ç§»é™¤ï¼Œä¸»è¦è¿˜æ˜¯å–å†³äºéå†åˆ é™¤å­èŠ‚ç‚¹é‡Œé¢çš„å‡½æ•°é€»è¾‘ï¼Œå¸Œæœ›åé¢æ”¹æ”¹å°±æ²¡è¿™ä¸ªå‚æ•°ç®—äº†ğŸ˜‚</p>
<h3 id="WithValueçš„å®ç°"><a href="#WithValueçš„å®ç°" class="headerlink" title="WithValueçš„å®ç°"></a>WithValueçš„å®ç°</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> valueCtx <span class="keyword">struct</span> &#123;</span><br><span class="line">    Context</span><br><span class="line">    key, val <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸é‡è¦é‡è¦çš„æ˜¯åé¢Value()å‡½æ•°çš„å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *valueCtx)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"%v.WithValue(%#v, %#v)"</span>, c.Context, c.key, c.val)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *valueCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">if</span> c.key == key &#123;</span><br><span class="line">        <span class="keyword">return</span> c.val</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c.Context.Value(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¿™ä¸ªå€¼ç›®å‰å–ä¸åˆ°çš„è¯å°±ä¼šä»çˆ¶Contexté‡Œé¢å–ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/20/ginæ¡†æ¶å­¦ä¹ ç¬”è®°ä¸€ï¼šç®€å•ä½¿ç”¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/20/ginæ¡†æ¶å­¦ä¹ ç¬”è®°ä¸€ï¼šç®€å•ä½¿ç”¨/" itemprop="url">
                  ginæ¡†æ¶å­¦ä¹ ç¬”è®°ä¸€ï¼šç®€å•ä½¿ç”¨
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-20 22:07:07 / Modified: 22:08:03" itemprop="dateCreated datePublished" datetime="2020-02-20T22:07:07+08:00">2020-02-20</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/gin/" itemprop="url" rel="index"><span itemprop="name">gin</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åªæ˜¯ä¸€ä¸ªä½¿ç”¨æ–¹å¼çš„memoï¼Œé˜²æ­¢ä»¥åè®°ä¸ä½è¿˜è¦æŸ¥ï¼ˆå…¶å®å°±æ˜¯ä¸ªç®€æ˜“ç‰ˆç¿»è¯‘ã€‚ã€‚ã€‚æ¯•ç«Ÿæ˜¯ä¸ªåƒåœ¾çš„è‡ªå·±ï¼‰</p>
<p>gitåœ°å€ï¼š<a href="https://github.com/gin-gonic/gin" target="_blank" rel="noopener">https://github.com/gin-gonic/gin</a></p>
<p>APIåˆ—è¡¨ï¼š<a href="https://godoc.org/github.com/gin-gonic/gin" target="_blank" rel="noopener">https://godoc.org/github.com/gin-gonic/gin</a></p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure>
<p>è¦è£…å¥½å¤šä¸œè¥¿ã€‚ã€‚ã€‚è€Œä¸”ç½‘ã€‚ã€‚ã€‚æ…¢æ…¢ç­‰å°±æ˜¯äº†</p>
<p>è¿è¡ŒåŸºç¡€ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Creates a gin router with default middleware:</span></span><br><span class="line">	<span class="comment">// logger and recovery (crash-free) middleware</span></span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	router.GET(<span class="string">"/someGet"</span>, getting)</span><br><span class="line">	router.POST(<span class="string">"/somePost"</span>, posting)</span><br><span class="line">	router.PUT(<span class="string">"/somePut"</span>, putting)</span><br><span class="line">	router.DELETE(<span class="string">"/someDelete"</span>, deleting)</span><br><span class="line">	router.PATCH(<span class="string">"/somePatch"</span>, patching)</span><br><span class="line">	router.HEAD(<span class="string">"/someHead"</span>, head)</span><br><span class="line">	router.OPTIONS(<span class="string">"/someOptions"</span>, options)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// By default it serves on :8080 unless a</span></span><br><span class="line">	<span class="comment">// PORT environment variable was defined.</span></span><br><span class="line">	router.Run()</span><br><span class="line">	<span class="comment">// router.Run(":3000") for a hard coded port</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="router"><a href="#router" class="headerlink" title="router"></a>router</h2><h3 id="é»˜è®¤è·¯ç”±"><a href="#é»˜è®¤è·¯ç”±" class="headerlink" title="é»˜è®¤è·¯ç”±"></a>é»˜è®¤è·¯ç”±</h3><p><code>gin.Default()</code></p>
<p>go ginåœ¨å†…éƒ¨å°è£…å¥½äº†ä¸€å¥—è·¯ç”±ç®¡ç†æœºåˆ¶ï¼Œä¸»è¦ä»‹ç»ä¸€ä¸‹é‡Œé¢è·å–å‚æ•°çš„æ–¹å¼å§ã€‚ï¼ˆå…¶å®å°±æ˜¯ç¿»è¯‘gitæ–‡æ¡£ï¼‰</p>
<h4 id="è·¯å¾„åŒ¹é…å‚æ•°"><a href="#è·¯å¾„åŒ¹é…å‚æ•°" class="headerlink" title="è·¯å¾„åŒ¹é…å‚æ•°"></a>è·¯å¾„åŒ¹é…å‚æ•°</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// This handler will match /user/john but will not match /user/ or /user</span></span><br><span class="line">	router.GET(<span class="string">"/user/:name"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">		c.String(http.StatusOK, <span class="string">"Hello %s"</span>, name)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// However, this one will match /user/john/ and also /user/john/send</span></span><br><span class="line">	<span class="comment">// If no other routers match /user/john, it will redirect to /user/john/</span></span><br><span class="line">	router.GET(<span class="string">"/user/:name/*action"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">		action := c.Param(<span class="string">"action"</span>)</span><br><span class="line">		message := name + <span class="string">" is "</span> + action</span><br><span class="line">		c.String(http.StatusOK, message)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// For each matched request Context will hold the route definition</span></span><br><span class="line">	router.POST(<span class="string">"/user/:name/*action"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.FullPath() == <span class="string">"/user/:name/*action"</span> <span class="comment">// true</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="GET-ä¼ å…¥çš„å‚æ•°"><a href="#GET-ä¼ å…¥çš„å‚æ•°" class="headerlink" title="GET ä¼ å…¥çš„å‚æ•°"></a>GET ä¼ å…¥çš„å‚æ•°</h4><p>query string: <code>/welcome?firstname=Jane&amp;lastname=Doe</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">router.GET(<span class="string">"/welcome"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		firstname := c.DefaultQuery(<span class="string">"firstname"</span>, <span class="string">"Guest"</span>)</span><br><span class="line">		lastname := c.Query(<span class="string">"lastname"</span>) <span class="comment">// shortcut for c.Request.URL.Query().Get("lastname")</span></span><br><span class="line"></span><br><span class="line">		c.String(http.StatusOK, <span class="string">"Hello %s %s"</span>, firstname, lastname)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­DefaultQueryï¼šDefaultQuery(key, defaultValue string) stringï¼Œæœ‰é»˜è®¤å€¼çš„è·å–å‚æ•°ã€‚</p>
<h4 id="POSTè¡¨å•è·å–å‚æ•°"><a href="#POSTè¡¨å•è·å–å‚æ•°" class="headerlink" title="POSTè¡¨å•è·å–å‚æ•°"></a>POSTè¡¨å•è·å–å‚æ•°</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">router.POST(<span class="string">"/form_post"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		message := c.PostForm(<span class="string">"message"</span>)</span><br><span class="line">		nick := c.DefaultPostForm(<span class="string">"nick"</span>, <span class="string">"anonymous"</span>)</span><br><span class="line"></span><br><span class="line">		c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"status"</span>:  <span class="string">"posted"</span>,</span><br><span class="line">			<span class="string">"message"</span>: message,</span><br><span class="line">			<span class="string">"nick"</span>:    nick,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="ç”¨mapçš„æ–¹å¼è·å–queryé‡Œçš„æ•°ç»„"><a href="#ç”¨mapçš„æ–¹å¼è·å–queryé‡Œçš„æ•°ç»„" class="headerlink" title="ç”¨mapçš„æ–¹å¼è·å–queryé‡Œçš„æ•°ç»„"></a>ç”¨mapçš„æ–¹å¼è·å–queryé‡Œçš„æ•°ç»„</h4><p>requestï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /post?ids[a]=1234&amp;ids[b]=hello HTTP/1.1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">names[first]=thinkerou&amp;names[second]=tianou</span><br></pre></td></tr></table></figure>
<p>serverä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	router.POST(<span class="string">"/post"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">		ids := c.QueryMap(<span class="string">"ids"</span>)</span><br><span class="line">		names := c.PostFormMap(<span class="string">"names"</span>)</span><br><span class="line"></span><br><span class="line">		fmt.Printf(<span class="string">"ids: %v; names: %v"</span>, ids, names)</span><br><span class="line">	&#125;)</span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è·å–æ–‡ä»¶"><a href="#è·å–æ–‡ä»¶" class="headerlink" title="è·å–æ–‡ä»¶"></a>è·å–æ–‡ä»¶</h4><p>request:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:8080/upload \</span><br><span class="line">  -F "file=@/Users/appleboy/test.zip" \</span><br><span class="line">  -H "Content-Type: multipart/form-data"</span><br></pre></td></tr></table></figure>
<p>serverä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	<span class="comment">// Set a lower memory limit for multipart forms (default is 32 MiB)</span></span><br><span class="line">	<span class="comment">// router.MaxMultipartMemory = 8 &lt;&lt; 20  // 8 MiB</span></span><br><span class="line">	router.POST(<span class="string">"/upload"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="comment">// single file</span></span><br><span class="line">		file, _ := c.FormFile(<span class="string">"file"</span>)</span><br><span class="line">		log.Println(file.Filename)</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Upload the file to specific dst.</span></span><br><span class="line">		<span class="comment">// c.SaveUploadedFile(file, dst)</span></span><br><span class="line"></span><br><span class="line">		c.String(http.StatusOK, fmt.Sprintf(<span class="string">"'%s' uploaded!"</span>, file.Filename))</span><br><span class="line">	&#125;)</span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å‚æ•°ç±»å‹ç»‘å®š"><a href="#å‚æ•°ç±»å‹ç»‘å®š" class="headerlink" title="å‚æ•°ç±»å‹ç»‘å®š"></a>å‚æ•°ç±»å‹ç»‘å®š</h4><p>é’ˆå¯¹jsonï¼Œxmlï¼ŒYAMLç­‰å…¶ä»–ç±»å‹çš„requestæˆ–è€…ä¼ ç»Ÿqueryï¼Œæˆ‘ä»¬æŠŠrequest bodyç»‘å®šåˆ°æŸä¸€ç‰¹å®šç±»å‹ä¸Šï¼Œå†å¯¹è¿™ç§ç±»å‹çš„æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚</p>
<p>bindåˆ†ä¸ºä¸¤ç±»ï¼šmustbind å’Œshouldbindï¼ŒåŒºåˆ«æ˜¯å½“mustbindå‡ºé”™çš„æ—¶å€™ï¼Œè¿”å›errorå¹¶ä¸”å¼ºåˆ¶ç»ˆæ­¢åç»­å¤„ç†å¹¶è¿”å›error 400ã€‚shouldbindå½“å‡ºé”™çš„æ—¶å€™åªä¼šè¿”å›errorï¼Œæ˜¯å¦ç»§ç»­æ‰§è¡Œç”±ç¼–å†™è€…è‡ªå·±å†³å®šã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Binding from JSON</span></span><br><span class="line"><span class="keyword">type</span> Login <span class="keyword">struct</span> &#123;</span><br><span class="line">	User     <span class="keyword">string</span> <span class="string">`form:"user" json:"user" xml:"user"  binding:"required"`</span></span><br><span class="line">	Password <span class="keyword">string</span> <span class="string">`form:"password" json:"password" xml:"password" binding:"required"`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœè¾“å…¥useræ²¡è¾“å…¥passwordï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šæŠ¥é”™ã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æœæŠŠä¸Šé¢passwordçš„bingingæ”¹æˆï¼šbinding:"-"å°±ä¸ä¼šæŠ¥é”™äº†</span></span><br><span class="line">router.POST(<span class="string">"/loginJSON"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> json Login</span><br><span class="line">		<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;json); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">"error"</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> json.User != <span class="string">"manu"</span> || json.Password != <span class="string">"123"</span> &#123;</span><br><span class="line">			c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125; </span><br><span class="line">		</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨bind+validatorå¯ä»¥å®ç°é‰´æƒï¼Œç”¨åˆ°å†è¯´ã€‚</p>
<h4 id="Html-æ¸²æŸ“"><a href="#Html-æ¸²æŸ“" class="headerlink" title="Html æ¸²æŸ“"></a>Html æ¸²æŸ“</h4><p>Using LoadHTMLGlob() or LoadHTMLFiles()</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	router.LoadHTMLGlob(<span class="string">"templates/*"</span>)</span><br><span class="line">	<span class="comment">//router.LoadHTMLFiles("templates/template1.html", "templates/template2.html")</span></span><br><span class="line">	router.GET(<span class="string">"/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.HTML(http.StatusOK, <span class="string">"index.tmpl"</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"Main website"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>templates/index.tmpl</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">		&#123;&#123; .title &#125;&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¸²æŸ“è¿™éƒ¨åˆ†ç”¨åˆ°çš„é¢‘ç‡ä¸€ç›´ä¸ç®—å¤ªé«˜å°±è¿™æ ·å§</p>
<h3 id="ä¸å«middlewareçš„è·¯ç”±"><a href="#ä¸å«middlewareçš„è·¯ç”±" class="headerlink" title="ä¸å«middlewareçš„è·¯ç”±"></a>ä¸å«middlewareçš„è·¯ç”±</h3><p>ä¹Ÿå°±æ˜¯ä¸åƒdefaultä¸€æ ·å°è£…å¥½åŒ…æ‹¬logç­‰ç­‰ï¼Œå…·ä½“ä¹Ÿç­‰ç”¨åˆ°äº†å†è¯´</p>
<h3 id="ç”¨ginè¿è¡Œå¤šä¸ªserver"><a href="#ç”¨ginè¿è¡Œå¤šä¸ªserver" class="headerlink" title="ç”¨ginè¿è¡Œå¤šä¸ªserver"></a>ç”¨ginè¿è¡Œå¤šä¸ªserver</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	<span class="string">"golang.org/x/sync/errgroup"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	g errgroup.Group</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">router01</span><span class="params">()</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">	e := gin.New()</span><br><span class="line">	e.Use(gin.Recovery())</span><br><span class="line">	e.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(</span><br><span class="line">			http.StatusOK,</span><br><span class="line">			gin.H&#123;</span><br><span class="line">				<span class="string">"code"</span>:  http.StatusOK,</span><br><span class="line">				<span class="string">"error"</span>: <span class="string">"Welcome server 01"</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">		)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">router02</span><span class="params">()</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">	e := gin.New()</span><br><span class="line">	e.Use(gin.Recovery())</span><br><span class="line">	e.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(</span><br><span class="line">			http.StatusOK,</span><br><span class="line">			gin.H&#123;</span><br><span class="line">				<span class="string">"code"</span>:  http.StatusOK,</span><br><span class="line">				<span class="string">"error"</span>: <span class="string">"Welcome server 02"</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">		)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server01 := &amp;http.Server&#123;</span><br><span class="line">		Addr:         <span class="string">":8080"</span>,</span><br><span class="line">		Handler:      router01(),</span><br><span class="line">		ReadTimeout:  <span class="number">5</span> * time.Second,</span><br><span class="line">		WriteTimeout: <span class="number">10</span> * time.Second,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	server02 := &amp;http.Server&#123;</span><br><span class="line">		Addr:         <span class="string">":8081"</span>,</span><br><span class="line">		Handler:      router02(),</span><br><span class="line">		ReadTimeout:  <span class="number">5</span> * time.Second,</span><br><span class="line">		WriteTimeout: <span class="number">10</span> * time.Second,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	g.Go(<span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">		err := server01.ListenAndServe()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	g.Go(<span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">		err := server02.ListenAndServe()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := g.Wait(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Graceful-Restart-and-Stop"><a href="#Graceful-Restart-and-Stop" class="headerlink" title="Graceful Restart and Stop"></a>Graceful Restart and Stop</h3><p>éšæ‰‹æŸ¥äº†ä¸€ä¸‹ï¼Œä¼˜é›…é‡å¯å’Œä¼˜é›…å…³é—­å®é™…ä¸Šæ˜¯ä¸€ç§ç­–ç•¥ï¼Œå°±æ˜¯åœ¨shutdownçš„æ—¶å€™å…ˆæ‰§è¡Œå®Œæ‰‹ä¸­æ‰€æœ‰çš„å½“ä¸‹æ‰€æœ‰çš„è¯·æ±‚å†å…³é—­ï¼Œä¼˜é›…é‡å¯å°±æ˜¯è¦åœ¨é‡å¯çš„è¿‡ç¨‹ä¸­æ›´åŠ å¹³æ»‘ï¼ˆè¯´äº†ç­‰äºæ²¡è¯´</p>
<p>ä¸‹é¢æ˜¯æŠ„çš„åˆ«çš„åšå®¢ï¼š</p>
<p>ä¸€ç§GracefulRestartçš„æ–¹æ³•æ˜¯ï¼Œé€šè¿‡éƒ¨ç½²ç³»ç»Ÿé…åˆnginxæ¥å®Œæˆã€‚ç”±äºå¤§éƒ¨åˆ†ä¸šåŠ¡ç³»ç»Ÿéƒ½æ˜¯æŒ‚åœ¨nginxä¹‹åé€šè¿‡nginxè¿›è¡Œåå‘ä»£ç†çš„ï¼Œå› æ­¤åœ¨é‡å¯æŸå°æœºå™¨çš„è¿›ç¨‹Aæ—¶ï¼Œå¯ä»¥æŠŠè¯¥æœºå™¨IPä»nginxçš„upstreamä¸­æ‘˜é™¤æ‰ï¼Œç­‰ä¸€æ®µæ—¶é—´æ¯”å¦‚1åˆ†é’Ÿï¼Œè¯¥è¿›ç¨‹å·®ä¸å¤šä¹Ÿå¤„ç†å®Œäº†æ‰€ä»¥è¯·æ±‚ï¼Œå®é™…ä¸Šå·²ç»å¤„äºç©ºé—²çŠ¶æ€äº†ã€‚è¿™æ—¶å°±å¯ä»¥killæ‰è¯¥è¿›ç¨‹å¹¶é‡å¯ï¼Œç­‰é‡å¯æˆåŠŸä¹‹åï¼Œå†æŠŠè¯¥æœºå™¨çš„IPåŠ å›åˆ°nginxå¯¹åº”çš„upstreamä¸­å»ã€‚<br>è¿™ç§æ–¹å¼æ˜¯è¯­è¨€ã€å¹³å°æ— å…³çš„ä¸€ç§æŠ€æœ¯æ–¹æ¡ˆï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š</p>
<ul>
<li>é¦–å…ˆå°±æ˜¯å¤æ‚ï¼Œéœ€è¦éƒ¨ç½²ç³»ç»Ÿå’Œç½‘å…³(nginx)æ°åˆ°å¥½å¤„åœ°é…åˆã€‚å¼€å‘äººå‘˜ç‚¹å‡»éƒ¨ç½²æ—¶ï¼Œéƒ¨ç½²ç³»ç»Ÿéœ€è¦é€šçŸ¥nginxæ‘˜æ‰æŸä¸ªupstreamçš„æŸä¸ªIPï¼›ç„¶åç­‰è¿›ç¨‹é‡å¯æˆåŠŸä¹‹åï¼Œéƒ¨ç½²ç³»ç»Ÿéœ€è¦é€šçŸ¥nginxåœ¨æŸä¸ªupstreamä¸­åŠ ä¸ŠæŸä¸ªIPã€‚è¿™ä¸€æ•´å¥—ç³»ç»Ÿçš„å¼€å‘æµ‹è¯•è¿˜æ˜¯æœ‰ä¸€å®šå¤æ‚æ€§çš„ã€‚</li>
<li>å…¶æ¬¡æ˜¯ç­‰å¾…æ—¶é—´çš„æœªçŸ¥æ€§ã€‚å½“æŠŠæœºå™¨Aæ‘˜æ‰ä»¥åè¿‡å¤šä¹…è¿›ç¨‹æ‰èƒ½å¤„ç†å®Œè¯·æ±‚ï¼Ÿ10ç§’ï¼Ÿ1åˆ†é’Ÿï¼Ÿè°ä¹Ÿä¸çŸ¥é“â€¦é—´éš”çŸ­äº†ï¼Œä¼šå‡ºé—®é¢˜ï¼Œå› ä¸ºéƒ¨åˆ†è¯·æ±‚è¢«å¡æ–­äº†ï¼›é—´éš”é•¿äº†ï¼Œä¸Šçº¿åˆæ…¢ï¼Œè€Œä¸”ä½ è¿˜æ˜¯ä¸èƒ½ç¡®å®šæ˜¯å¦è¯·æ±‚éƒ½å¤„ç†å®Œäº†ï¼ˆå…¶å®åŸºæœ¬ä¸Šæ²¡é—®é¢˜ï¼Œä½†æ˜¯ç†è®ºä¸Šæ— æ³•ä¿è¯ï¼‰ã€‚</li>
<li>å¦ä¸€ä¸ªé—®é¢˜æ˜¯å‹åŠ›é™¡å¢ã€‚å¯¹äºå¤§å…¬å¸åŠ¨è¾„å‡ ç™¾å°çš„é›†ç¾¤ï¼Œæ‘˜ä¸€ä¸¤å°æ— å…³ç´§è¦ã€‚ä½†æ˜¯å¯¹äºå°å…¬å¸ï¼Œæ¯”å¦‚æŸä¸ªæœåŠ¡åªæœ‰ä¸¤å°æœºå™¨ï¼Œå¹¶ä¸”æ¯å°æœºå™¨å‹åŠ›éƒ½æŒºå¤§ã€‚è¿™æ—¶å¦‚æœç›´æ¥æ‘˜ä¸€å°ï¼Œæ‰€æœ‰æµé‡åˆ°å¦ä¸€å°æœºå™¨ä¸Šï¼Œä½¿å¾—é‚£å°æœºå™¨æ‰¿å—ä¸ä½ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ã€‚</li>
</ul>
<p>å› æ­¤è¿™é‡Œå¼•å‡ºç¬¬äºŒç§å®ç°æ–¹å¼â€”â€”fdç»§æ‰¿</p>
<p>åé¢çš„ä¸æŠ„äº†ï¼Œç­‰æœ‰æ—¶é—´æ…¢æ…¢æ•´ç†ä¸€ä¸‹ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/18/golangå­¦ä¹ ç¬”è®°äºŒï¼šconcurrency/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/18/golangå­¦ä¹ ç¬”è®°äºŒï¼šconcurrency/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°äºŒï¼šconcurrency
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-18 10:30:17 / Modified: 10:31:13" itemprop="dateCreated datePublished" datetime="2020-02-18T10:30:17+08:00">2020-02-18</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Goåœ¨æˆ‘ä¸ªäººç†è§£é‡Œæœ€ç‹¬ç‰¹çš„ä¸œè¥¿ï¼Œå¯¹å¹¶å‘æ”¯æŒæœ‰ç€é‡å¤§çš„ä½œç”¨ã€‚</p>
<h2 id="çº¿ç¨‹ï¼Œåç¨‹å’Œgoroutine"><a href="#çº¿ç¨‹ï¼Œåç¨‹å’Œgoroutine" class="headerlink" title="çº¿ç¨‹ï¼Œåç¨‹å’Œgoroutine"></a>çº¿ç¨‹ï¼Œåç¨‹å’Œgoroutine</h2><blockquote>
<ul>
<li>è¿›ç¨‹ï¼šæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å †å’Œæ ˆï¼Œæ—¢ä¸å…±äº«å †ï¼Œäº¦ä¸å…±äº«æ ˆï¼Œè¿›ç¨‹ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ã€‚</li>
<li>çº¿ç¨‹ï¼šæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆå’Œå…±äº«çš„å †ï¼Œå…±äº«å †ï¼Œä¸å…±äº«æ ˆï¼Œçº¿ç¨‹äº¦ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ã€‚</li>
<li>åç¨‹ :å’Œçº¿ç¨‹ä¸€æ ·å…±äº«å †ï¼Œä¸å…±äº«æ ˆï¼Œåç¨‹ç”±ç¨‹åºå‘˜åœ¨åç¨‹çš„ä»£ç é‡Œæ˜¾ç¤ºè°ƒåº¦ã€‚</li>
</ul>
</blockquote>
<p>è¿›ç¨‹æ‡’å¾—è¯´äº†ï¼Œçº¿ç¨‹æŒ‰ç…§é“ç†åº”è¯¥åœ¨JAVAè¯´çš„ï¼Œåç¨‹æŒ‰ç…§é“ç†åº”è¯¥åœ¨swooleé‡Œé¢è¯´çš„ï¼ˆåˆæ¬ äº†ç‚¹ä¸œè¥¿è¦å­¦ï¼‰</p>
<p>ç®€å•è¯´ä¸€ä¸‹å°±æ˜¯ï¼Œåç¨‹å…¨ç¨‹éƒ½æ˜¯ç”¨æˆ·æ€çš„ï¼Œæ“ä½œç³»ç»Ÿå¯¹äºåç¨‹æ²¡æœ‰ä»»ä½•çš„æ„ŸçŸ¥ï¼Œå®ƒæ‰€æœ‰çš„è°ƒåº¦éƒ½ç”±ç”¨æˆ·å®Œæˆã€‚goroutineå…¶å®å°±æ˜¯ä¸éœ€è¦ç”¨æˆ·æŠŠæ‰€æœ‰çš„åç¨‹è°ƒåº¦éƒ½å†™ä¸‹æ¥ï¼Œè€Œæ˜¯ç”¨Goè¯­è¨€åœ¨runtimeï¼Œç³»ç»Ÿè°ƒç”¨ç­‰å¤šæ–¹é¢å¯¹åç¨‹è°ƒåº¦è¿›è¡Œäº†å°è£…å’Œå¤„ç†ã€‚</p>
<h2 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a>goroutine</h2><p>å…¶å®å°±æ˜¯ä¸ªeffective goçš„å­¦ä¹ ç¬”è®°ï¼ˆä¸­æ–‡ç¿»è¯‘ï¼‰ï¼š</p>
<p><a href="https://golang.org/doc/effective_go.html#concurrency" target="_blank" rel="noopener">https://golang.org/doc/effective_go.html#concurrency</a></p>
<p><a href="https://github.com/golang/go/wiki/LearnConcurrency" target="_blank" rel="noopener">https://github.com/golang/go/wiki/LearnConcurrency</a> </p>
<p>ä¸­å¿ƒæ€æƒ³ï¼š</p>
<blockquote>
<p>Do not communicate by sharing memory; instead, share memory by communicating.</p>
</blockquote>
<h3 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h3><p>Communicating Sequential Processes (CSP)</p>
<h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><p>channelæ˜¯ goroutine ä¹‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥ç±»æ¯”æˆ Unix ä¸­çš„è¿›ç¨‹çš„é€šä¿¡æ–¹å¼ç®¡é“ã€‚</p>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>channel ä½¿ç”¨å†…ç½®çš„ make å‡½æ•°åˆ›å»ºï¼Œä¸‹é¢å£°æ˜äº†ä¸€ä¸ª chan int ç±»å‹çš„ channel:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br></pre></td></tr></table></figure>
<p>golang æä¾›äº†å†…ç½®çš„ close å‡½æ•°å¯¹ channel è¿›è¡Œå…³é—­æ“ä½œã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">close</span>(ch)</span><br></pre></td></tr></table></figure>
<p>æœ‰å…³ channel çš„å…³é—­ï¼Œä½ éœ€è¦æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼ˆæŠ„çš„ï¼‰:</p>
<ul>
<li>å…³é—­ä¸€ä¸ªæœªåˆå§‹åŒ–(nil) çš„ channel ä¼šäº§ç”Ÿ panic</li>
<li>é‡å¤å…³é—­åŒä¸€ä¸ª channel ä¼šäº§ç”Ÿ panic</li>
<li>å‘ä¸€ä¸ªå·²å…³é—­çš„ channel ä¸­å‘é€æ¶ˆæ¯ä¼šäº§ç”Ÿ panic</li>
<li>ä»å·²å…³é—­çš„ channel è¯»å–æ¶ˆæ¯ä¸ä¼šäº§ç”Ÿ panicï¼Œä¸”èƒ½è¯»å‡º channel ä¸­è¿˜æœªè¢«è¯»å–çš„æ¶ˆæ¯ï¼Œè‹¥æ¶ˆæ¯å‡å·²è¯»å‡ºï¼Œåˆ™ä¼šè¯»åˆ°ç±»å‹çš„é›¶å€¼ã€‚ä»ä¸€ä¸ªå·²å…³é—­çš„ channel ä¸­è¯»å–æ¶ˆæ¯æ°¸è¿œä¸ä¼šé˜»å¡ï¼Œå¹¶ä¸”ä¼šè¿”å›ä¸€ä¸ªä¸º false çš„ ok-idiomï¼Œå¯ä»¥ç”¨å®ƒæ¥åˆ¤æ–­ channel æ˜¯å¦å…³é—­</li>
<li>å…³é—­ channel ä¼šäº§ç”Ÿä¸€ä¸ªå¹¿æ’­æœºåˆ¶ï¼Œæ‰€æœ‰å‘ channel è¯»å–æ¶ˆæ¯çš„ goroutine éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯</li>
</ul>
<h4 id="buffer"><a href="#buffer" class="headerlink" title="buffer"></a>buffer</h4><p>ç®€å•æ¥è¯´ï¼Œæ— ç¼“å­˜çš„channelåƒå¤šçº¿ç¨‹çš„synchronizeï¼Œå‘ç©ºchannelè¯»å–æ¶ˆæ¯æˆ–è€…å‘æœ‰æ•°æ®çš„channelé‡Œå‘é€æ•°æ®éƒ½ä¼šé˜»å¡ï¼Œæœ‰ç¼“å­˜çš„ channelï¼Œå½“ç¼“å­˜æœªæ»¡æ—¶ï¼Œå‘ channel ä¸­å‘é€æ¶ˆæ¯æ—¶ä¸ä¼šé˜»å¡ï¼Œå½“ç¼“å­˜æ»¡æ—¶ï¼Œå‘é€æ“ä½œå°†è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰å…¶ä»– goroutine ä»ä¸­è¯»å–æ¶ˆæ¯ï¼›ç›¸åº”çš„ï¼Œå½“ channel ä¸­æ¶ˆæ¯ä¸ä¸ºç©ºæ—¶ï¼Œè¯»å–æ¶ˆæ¯ä¸ä¼šå‡ºç°é˜»å¡ï¼Œå½“ channel ä¸ºç©ºæ—¶ï¼Œè¯»å–æ“ä½œä¼šé€ æˆé˜»å¡ï¼Œç›´åˆ°æœ‰ goroutine å‘ channel ä¸­å†™å…¥æ¶ˆæ¯ã€‚</p>
<p>æœ‰ç¼“å­˜çš„channelæœ‰ç‚¹åƒsemaphoreï¼Œåƒä¸‹é¢çš„ä»£ç ï¼Œsem bufferçš„å¤§å°å†³å®šäº†åŒæ—¶æœ‰å‡ ä¸ªåç¨‹åœ¨æ‰§è¡Œhandleã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sem = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, MaxOutstanding)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(r *Request)</span></span> &#123;</span><br><span class="line">    sem &lt;- <span class="number">1</span>    <span class="comment">// Wait for active queue to drain.</span></span><br><span class="line">    process(r)  <span class="comment">// May take a long time.</span></span><br><span class="line">    &lt;-sem       <span class="comment">// Done; enable next request to run.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serve</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        req := &lt;-queue</span><br><span class="line">        <span class="keyword">go</span> handle(req)  <span class="comment">// Don't wait for handle to finish.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶è¿˜æœ‰å¦ä¸€ç§ä¸éœ€è¦ç”¨channelç¼“å­˜å»é™åˆ¶çš„æ–¹æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> r := <span class="keyword">range</span> queue &#123;</span><br><span class="line">        process(r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serve</span><span class="params">(clientRequests <span class="keyword">chan</span> *Request, quit <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Start handlers</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; MaxOutstanding; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> handle(clientRequests)</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;-quit  <span class="comment">// Wait to be told to exit.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¯ä»¥åº”ç”¨çš„ç®—æ³•"><a href="#å¯ä»¥åº”ç”¨çš„ç®—æ³•" class="headerlink" title="å¯ä»¥åº”ç”¨çš„ç®—æ³•"></a>å¯ä»¥åº”ç”¨çš„ç®—æ³•</h4><h5 id="channelåµŒå¥—"><a href="#channelåµŒå¥—" class="headerlink" title="channelåµŒå¥—"></a>channelåµŒå¥—</h5><p>æ¥è‡ªeffective goï¼Œä½†å…¶å®æ²¡æœ‰å¤ªç†è§£ä¹¦ä¸Šè¯´çš„ <code>safe, parallel demultiplexing</code> æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p>
<p>ç®€å•è§£é‡Šä¸€ä¸‹ï¼Œä»£ç æ¥ä¸Šé¢çš„æœ€åä¸€æ®µä»£ç ï¼Œå½“è§£å†³å¤šä¸ªä¸åŒè¿”å›å€¼çš„requesté—®é¢˜çš„æ—¶å€™ï¼Œåˆ©ç”¨ç»“æ„ä½“å’Œresult channelå¯ä»¥è®©handleå˜æˆä¸€ä¸ªé€šç”¨å‡½æ•°ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Request <span class="keyword">struct</span> &#123;</span><br><span class="line">    args        []<span class="keyword">int</span></span><br><span class="line">    f           <span class="function"><span class="keyword">func</span><span class="params">([]<span class="keyword">int</span>)</span> <span class="title">int</span></span></span><br><span class="line"><span class="function">    <span class="title">resultChan</span>  <span class="title">chan</span> <span class="title">int</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ç”±clientè‡ªå·±æä¾›éœ€è¦è§£å†³çš„å‡½æ•°å’Œå®ƒæ‰€æœ‰çš„å‚æ•°ï¼Œå¹¶ä¸”å®šä¸€ä¸ªresult channelç”¨æ¥æ¥æ”¶è¿”å›å€¼ï¼Œè¿™æ ·æ¯ä¸ªrequestéƒ½æœ‰å±äºè‡ªå·±çš„responseè·¯å¾„ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(a []<span class="keyword">int</span>)</span> <span class="params">(s <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> a &#123;</span><br><span class="line">        s += v</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request := &amp;Request&#123;[]<span class="keyword">int</span>&#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;, sum, <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)&#125;</span><br><span class="line"><span class="comment">// Send request</span></span><br><span class="line">clientRequests &lt;- request</span><br><span class="line"><span class="comment">// Wait for response.</span></span><br><span class="line">fmt.Printf(<span class="string">"answer: %d\n"</span>, &lt;-request.resultChan)</span><br></pre></td></tr></table></figure>
<p>å½“requestéƒ½å®šä¹‰å¥½ä¹‹åï¼Œhandlerå°±åªè¦è¿™æ ·å†™å°±å¯ä»¥äº†è€Œå®Œå…¨ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªä¸åŒçš„requestè¿›è¡Œä¿®æ”¹ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> req := <span class="keyword">range</span> queue &#123;</span><br><span class="line">        req.resultChan &lt;- req.f(req.args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="å¹¶è¡Œç®—æ³•"><a href="#å¹¶è¡Œç®—æ³•" class="headerlink" title="å¹¶è¡Œç®—æ³•"></a>å¹¶è¡Œç®—æ³•</h5><p>è¿™ä¸ªå’Œmpiå‡ ä¹ä¸€æ¨¡ä¸€æ ·ä¸æƒ³å†™äº†</p>
<h5 id="leaky-buffer"><a href="#leaky-buffer" class="headerlink" title="leaky buffer"></a>leaky buffer</h5><p>è¿™ä¸ªçš„æ˜¯åŸºäºæ¼æ¡¶ä½œå‡ºçš„è®¾è®¡ï¼Œæ¼æ¡¶æ˜¯åœ¨é€šä¿¡æ‹¥å¡æ§åˆ¶(congestion controlï¼‰ä¸­ä½¿ç”¨çš„ç®—æ³•ã€‚ï¼ˆcongestion control å°±æ¯”å¦‚ä¹‹å‰å­¦çš„æ…¢å¯åŠ¨ï¼Œå¿«é€Ÿæ¢å¤ç­‰ç­‰ã€‚ï¼‰åƒæ¼æ–—ä¸€æ ·ï¼Œæ— è®ºæµå…¥çš„æµé‡å¤šå¤§ï¼Œç»è¿‡æ¼æ–—ä¹‹åæµå‡ºçš„æµé‡é€Ÿç‡éƒ½æ˜¯ç¨³å®šçš„ã€‚</p>
<p>ä¸ºä»€ä¹ˆå«leakyæ˜¯å› ä¸ºå½“æ¼æ–—æ»¡äº†ä¹‹åçš„æ•°æ®å°±ä¼šè¢«ä¸¢å¼ƒï¼Œç„¶åç»è¿‡å…¶ä»–çš„å¤„ç†ã€‚</p>
<p>effective goé‡Œå†™çš„æ¼æ¡¶ç®—æ³•ä¸å¤ªæ¸…æ¥šæˆ‘æ‰¾äº†å¦ä¸€ä¸ª</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> leakybuf</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> LeakyBuf <span class="keyword">struct</span> &#123;</span><br><span class="line">	bufSize  <span class="keyword">int</span> <span class="comment">// size of each buffer</span></span><br><span class="line">	freeList <span class="keyword">chan</span> []<span class="keyword">byte</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewLeakyBuf creates a leaky buffer which can hold at most n buffer, each</span></span><br><span class="line"><span class="comment">// with bufSize bytes.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLeakyBuf</span><span class="params">(n, bufSize <span class="keyword">int</span>)</span> *<span class="title">LeakyBuf</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;LeakyBuf&#123;</span><br><span class="line">		bufSize:  bufSize,</span><br><span class="line">		freeList: <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="keyword">byte</span>, n),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get returns a buffer from the leaky buffer or create a new buffer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lb *LeakyBuf)</span> <span class="title">Get</span><span class="params">()</span> <span class="params">(b []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> b = &lt;-lb.freeList:</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		b = <span class="built_in">make</span>([]<span class="keyword">byte</span>, lb.bufSize)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Put add the buffer into the free buffer pool for reuse. Panic if the buffer</span></span><br><span class="line"><span class="comment">// size is not the same with the leaky buffer's. This is intended to expose</span></span><br><span class="line"><span class="comment">// error usage of leaky buffer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lb *LeakyBuf)</span> <span class="title">Put</span><span class="params">(b []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b) != lb.bufSize &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">"invalid buffer size that's put into leaky buffer"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> lb.freeList &lt;- b:</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®€å•æ¥è¯´å°±æ˜¯ç”¨å¸¦bufferçš„channel freeListæ¥åšè¿™ä¸ªæ¼æ–—ï¼Œå½“æ¼æ–—ç©ºäº†çš„æ—¶å€™getå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„bufferï¼ˆå…·ä½“å¹²ä»€ä¹ˆæˆ‘ä¹Ÿä¸çŸ¥é“ï¼‰ï¼Œè€Œå¯¹putæ¥è¯´å¦‚æœæ¼æ–—æ»¡äº†å°±ä¼šè¿›å…¥defaultï¼ˆä¹Ÿå°±æ˜¯æŠ›å¼ƒå½“å‰bufferï¼‰ï¼Œè¿™ä¸ªç®—æ³•æ˜¯æƒ³è¯æ˜åˆ©ç”¨channelæ¥å®ç°ä¸€äº›ç®—æ³•ä¼šæ›´åŠ ç®€å•æ˜“æ‡‚ã€‚</p>
<h2 id="ä¸€äº›æ³¨æ„äº‹é¡¹"><a href="#ä¸€äº›æ³¨æ„äº‹é¡¹" class="headerlink" title="ä¸€äº›æ³¨æ„äº‹é¡¹"></a>ä¸€äº›æ³¨æ„äº‹é¡¹</h2><h3 id="åç¨‹å‚æ•°è°ƒç”¨é—®é¢˜"><a href="#åç¨‹å‚æ•°è°ƒç”¨é—®é¢˜" class="headerlink" title="åç¨‹å‚æ•°è°ƒç”¨é—®é¢˜"></a>åç¨‹å‚æ•°è°ƒç”¨é—®é¢˜</h3><p>é¦–å…ˆå›åˆ°æœ€å‰é¢bufferçš„åŠŸèƒ½é‡Œæåˆ°çš„å¯ä»¥å½“semaphoreç”¨çš„ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sem = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, MaxOutstanding)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(r *Request)</span></span> &#123;</span><br><span class="line">    sem &lt;- <span class="number">1</span>    <span class="comment">// Wait for active queue to drain.</span></span><br><span class="line">    process(r)  <span class="comment">// May take a long time.</span></span><br><span class="line">    &lt;-sem       <span class="comment">// Done; enable next request to run.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serve</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        req := &lt;-queue</span><br><span class="line">        <span class="keyword">go</span> handle(req)  <span class="comment">// Don't wait for handle to finish.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶è¿™ä¸ªä»£ç æœ‰é—®é¢˜ï¼Œè™½ç„¶åŒæ—¶åªæœ‰ MaxOutstandingä¸ªåç¨‹ä¼šæ‰§è¡Œï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šåŒæ—¶åˆ›å»ºéå¸¸éå¸¸å¤šä¸ªåç¨‹ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜åšäº†ä¸€å®šçš„æ”¹è¿›ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serve</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> req := <span class="keyword">range</span> queue &#123;</span><br><span class="line">        sem &lt;- <span class="number">1</span></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            process(req) <span class="comment">// Buggy; see explanation below.</span></span><br><span class="line">            &lt;-sem</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠsemè¿™ä¸ªchannelç”¨æ¥æ§åˆ¶åç¨‹çš„åˆ›å»ºï¼Œè¿™æ ·è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™å°±æ¶‰åŠåˆ°æ ‡é¢˜çš„å‚æ•°è°ƒç”¨é—®é¢˜ã€‚</p>
<p>å…¶å®å’Œå¤šçº¿ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œä¸Šé¢åˆ›å»ºçš„æ‰€æœ‰åç¨‹çš„process(req)æŒ‡å‘çš„reqéƒ½æ˜¯åŒä¸€ä¸ªåœ°å€ï¼Œåœ¨å¾ªç¯çš„è¿‡ç¨‹ä¸­reqä¸æ–­åœ°å˜åŒ–ï¼Œå°±ä¼šå¯¼è‡´processçš„reqå¹¶ä¸ä¸€å®šæ˜¯æƒ³æ‰§è¡Œçš„é‚£ä¸€ä¸ªï¼Œå°±å¤šçº¿ç¨‹çš„ç»éªŒæ¥è¯´å¾ªç¯æ¬¡æ•°å°‘çš„è¯å¾ˆæœ‰å¯èƒ½ç¬¬ä¸€ä¸ªåç¨‹åˆ›å»ºå¥½çš„æ—¶å€™reqå·²ç»å¾ªç¯åˆ°äº†æœ€åä¸€ä¸ªã€‚ï¼ˆå¤šçº¿ç¨‹è¸©è¿‡çš„å‘å†è¸©ä¸€éï¼‰</p>
<p>æ‰€ä»¥åˆå¤šäº†ç¬¬äºŒæ¬¡æ”¹è¿›ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serve</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> req := <span class="keyword">range</span> queue &#123;</span><br><span class="line">        sem &lt;- <span class="number">1</span></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(req *Request)</span></span> &#123;</span><br><span class="line">            process(req)</span><br><span class="line">            &lt;-sem</span><br><span class="line">        &#125;(req)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠreqä½œä¸ºå‚æ•°ä¼ è¿›å»å°±æ²¡é—®é¢˜äº†ï¼ŒæŒ‰ç…§cçš„ç»éªŒä¼šç»™å®ƒåœ¨æœ¬åœ°å¤åˆ¶ä¸€å—åœ°å€ç©ºé—´çš„ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¾ªç¯ä¸€å¼€å§‹å°±ï¼šreq := reqï¼Œä½†æ˜¯çœ‹ç€å¾ˆå¥‡æ€ªã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/18/golangå­¦ä¹ ç¬”è®°ä¸€ï¼šåŸºç¡€ç¯‡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/18/golangå­¦ä¹ ç¬”è®°ä¸€ï¼šåŸºç¡€ç¯‡/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°ä¸€ï¼šåŸºç¡€ç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-18 10:26:31 / Modified: 10:27:54" itemprop="dateCreated datePublished" datetime="2020-02-18T10:26:31+08:00">2020-02-18</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go run hello.go</span></span><br><span class="line">Hello, World!</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go build hello.go </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">hello    hello.go</span><br><span class="line"><span class="meta">$</span><span class="bash"> ./hello </span></span><br><span class="line">Hello, World!</span><br></pre></td></tr></table></figure>
<h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><h3 id="å˜é‡å£°æ˜"><a href="#å˜é‡å£°æ˜" class="headerlink" title="å˜é‡å£°æ˜"></a>å˜é‡å£°æ˜</h3><h4 id="ä¸€èˆ¬å½¢å¼"><a href="#ä¸€èˆ¬å½¢å¼" class="headerlink" title="ä¸€èˆ¬å½¢å¼"></a>ä¸€èˆ¬å½¢å¼</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier <span class="keyword">type</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier1, identifier2 <span class="keyword">type</span></span><br></pre></td></tr></table></figure>
<h4 id="æ ¹æ®å€¼è‡ªåŠ¨åˆ¤æ–­ç±»å‹"><a href="#æ ¹æ®å€¼è‡ªåŠ¨åˆ¤æ–­ç±»å‹" class="headerlink" title="æ ¹æ®å€¼è‡ªåŠ¨åˆ¤æ–­ç±»å‹"></a>æ ¹æ®å€¼è‡ªåŠ¨åˆ¤æ–­ç±»å‹</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v_name = value</span><br></pre></td></tr></table></figure>
<h4 id="ç”¨-æ›¿ä»£var"><a href="#ç”¨-æ›¿ä»£var" class="headerlink" title="ç”¨:=æ›¿ä»£var"></a>ç”¨:=æ›¿ä»£var</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v_name := value</span><br></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>å¯ä»¥åœ¨åˆ›å»ºçš„æ—¶å€™åˆå§‹åŒ–å€¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>ä¸åˆå§‹åŒ–å°±é»˜è®¤é›¶ï¼š</p>
<blockquote>
<ul>
<li><p>æ•°å€¼ç±»å‹ï¼ˆåŒ…æ‹¬complex64/128ï¼‰ä¸º <strong>0</strong></p>
</li>
<li><p>å¸ƒå°”ç±»å‹ä¸º <strong>false</strong></p>
</li>
<li><p>å­—ç¬¦ä¸²ä¸º <strong>â€œâ€</strong>ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰</p>
</li>
<li><p>ä»¥ä¸‹å‡ ç§ç±»å‹ä¸º <strong>nil</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;   <span class="keyword">var</span> a *<span class="keyword">int</span></span><br><span class="line">&gt;   <span class="keyword">var</span> a []<span class="keyword">int</span></span><br><span class="line">&gt;   <span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">string</span>] <span class="keyword">int</span></span><br><span class="line">&gt;   <span class="keyword">var</span> a <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">&gt;   <span class="keyword">var</span> a <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">string</span>)</span> <span class="title">int</span></span></span><br><span class="line"><span class="function">&gt;   <span class="title">var</span> <span class="title">a</span> <span class="title">error</span> // <span class="title">error</span> æ˜¯æ¥å£</span></span><br><span class="line"><span class="function">&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h3 id="new-å’Œ-make"><a href="#new-å’Œ-make" class="headerlink" title="new å’Œ make"></a>new å’Œ make</h3><blockquote>
<p>Goè¯­è¨€ä¸­çš„ new å’Œ make ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>make åªèƒ½ç”¨æ¥åˆ†é…åŠåˆå§‹åŒ–ç±»å‹ä¸º sliceã€mapã€chan çš„æ•°æ®ã€‚new å¯ä»¥åˆ†é…ä»»æ„ç±»å‹çš„æ•°æ®ï¼›</li>
<li>new åˆ†é…è¿”å›çš„æ˜¯æŒ‡é’ˆï¼Œå³ç±»å‹ *Typeã€‚make è¿”å›å¼•ç”¨ï¼Œå³ Typeï¼›</li>
<li>new åˆ†é…çš„ç©ºé—´è¢«æ¸…é›¶ã€‚make åˆ†é…ç©ºé—´åï¼Œä¼šè¿›è¡Œåˆå§‹åŒ–ï¼›</li>
</ul>
</blockquote>
<h2 id="åŒ…å¼•å…¥"><a href="#åŒ…å¼•å…¥" class="headerlink" title="åŒ…å¼•å…¥"></a>åŒ…å¼•å…¥</h2><h3 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h3><p>ä¸ªäººç†è§£ï¼šå’Œiostreamç±»ä¼¼ï¼Œéƒ½æ˜¯æ ¼å¼åŒ–I/Oçš„åŒ…ï¼Œç®€å•æ ¼å¼ï¼š</p>
<h4 id="Printf"><a href="#Printf" class="headerlink" title="Printf"></a>Printf</h4><p>å°±æ˜¯ä¸ªè¾“å‡ºï¼Œç”¨æ³•å’ŒCçš„printfè¿˜æœ‰pythonçš„<code>format</code>æœ‰ç€å¾®å¦™çš„ç›¸ä¼¼æ€§ï¼Œéƒ½æ˜¯ç¬¬ä¸€ä¸ªå˜é‡å®šä¹‰è¾“å‡ºæ ¼å¼ï¼Œåé¢å¡«å…¥è¾“å‡ºå˜é‡ã€‚</p>
<ol>
<li><code>%v</code> å ä½ç¬¦å¯ä»¥æ‰“å°ä»»ä½• Go çš„å€¼ï¼Œâ€œåŠ å·â€æ ‡è®°(<code>%+v</code>)ä¼šæ·»åŠ å­—æ®µå</li>
<li><code>%T</code> å¯ä»¥æ‰“å°å‡ºå˜é‡çš„ç±»å‹</li>
<li><code>%#v</code>  ç›¸åº”å€¼çš„Goè¯­æ³•è¡¨ç¤º</li>
<li><code>%%</code>  å­—æ¯ä¸Šçš„ç™¾åˆ†å·ï¼Œå¹¶éå€¼çš„å ä½ç¬¦</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> Sample <span class="keyword">struct</span> &#123;</span><br><span class="line">	a   <span class="keyword">int</span></span><br><span class="line">	str <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := Sample&#123;a: <span class="number">1</span>, str: <span class="string">"hello"</span>&#125;</span><br><span class="line"> </span><br><span class="line">	fmt.Printf(<span class="string">"%v\n"</span>, s)   <span class="comment">//&#123;1, hello&#125;</span></span><br><span class="line">	fmt.Printf(<span class="string">"%+v\n"</span>, s)  <span class="comment">//&#123;a:1, str:hello&#125;</span></span><br><span class="line">	fmt.Printf(<span class="string">"%#v\n"</span>, s)  <span class="comment">//main.Sample&#123;a:1, str:"hello"&#125;</span></span><br><span class="line">	fmt.Printf(<span class="string">"%T\n"</span>, s)   <span class="comment">// main.Sample</span></span><br><span class="line">	fmt.Printf(<span class="string">"%%\n"</span>, s.a) <span class="comment">// %  %!(EXTRA int=1)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆæŠ„ä¸€ä¸ªä¾‹å­ï¼‰ï¼Œå…¶ä»–æ™®é€šçš„<code>%d</code>ä»€ä¹ˆçš„å°±æ‡’å¾—å†™äº†ã€‚</p>
<p>å…¶ä»–ç‰¹æ®Šç”¨æ³•ï¼š</p>
<p><strong>æŒ‡å®šå®½åº¦</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fmt.Printf(<span class="string">"%10d\n"</span>, <span class="number">353</span>)  <span class="comment">// will print "       353"</span></span><br><span class="line"><span class="comment">//å°†å®½åº¦æŒ‡å®šä¸º * æ¥å°†å®½åº¦å½“ä½œ Printf çš„å‚æ•°:</span></span><br><span class="line">fmt.Printf(<span class="string">"%*d\n"</span>, <span class="number">10</span>, <span class="number">353</span>)  <span class="comment">// will print "       353"</span></span><br></pre></td></tr></table></figure>
<p><strong>å¤šæ¬¡å¼•ç”¨ä¸€ä¸ªå˜é‡</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœä½ åœ¨ä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ä¸­å¤šæ¬¡å¼•ç”¨ä¸€ä¸ªå˜é‡ï¼Œä½ å¯ä»¥ä½¿ç”¨ %[n]ï¼Œå…¶ä¸­ n æ˜¯ä½ çš„å‚æ•°ç´¢å¼•ï¼ˆä½ç½®ï¼Œä» 1 å¼€å§‹ï¼‰</span></span><br><span class="line">fmt.Printf(<span class="string">"The price of %[1]s was $%[2]d. $%[2]d! imagine that.\n"</span>, <span class="string">"carrot"</span>, <span class="number">23</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Sprintf"><a href="#Sprintf" class="headerlink" title="Sprintf"></a>Sprintf</h4><p><code>Sprintf</code> åˆ™æ ¼å¼åŒ–å¹¶è¿”å›ä¸€ä¸ªå­— ç¬¦ä¸²è€Œä¸å¸¦ä»»ä½•<strong>è¾“å‡º</strong>ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s := fmt.Sprintf(<span class="string">"æ˜¯å­—ç¬¦ä¸² %s "</span>,<span class="string">"string"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Fprintf"><a href="#Fprintf" class="headerlink" title="Fprintf"></a>Fprintf</h4><p>å’ŒPrintfçš„åŒºåˆ«ï¼šæ ¼å¼åŒ–å¹¶è¾“å‡ºåˆ°<code>æŒ‡å®šçš„åœ°æ–¹</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Fprintf(os.Stdout, <span class="string">"%s\n"</span>, <span class="string">"hello world!"</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±æ˜¯å’Œ<code>Printf</code>ä¸€æ ·ä»<code>os.stdout</code>è¾“å‡ºï¼Œçœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">buf := bufio.NewWriter(os.Stdout)</span><br><span class="line">	<span class="comment">// and now so does buf.</span></span><br><span class="line">fmt.Fprintf(buf, <span class="string">"%s\n"</span>, <span class="string">"hello world! - buffered"</span>)</span><br><span class="line">buf.Flush()</span><br></pre></td></tr></table></figure>
<p>å°±å˜æˆäº†æŠŠè¾“å‡ºæ‰”è¿›é˜Ÿåˆ—é‡Œã€‚</p>
<h4 id="Println"><a href="#Println" class="headerlink" title="Println"></a>Println</h4><p>è¾“å‡ºä½†æ˜¯æ— æ³•æ ¼å¼åŒ–ã€‚</p>
<h3 id="è‡ªå®šä¹‰åŒ…"><a href="#è‡ªå®šä¹‰åŒ…" class="headerlink" title="è‡ªå®šä¹‰åŒ…"></a>è‡ªå®šä¹‰åŒ…</h3><p>æŠ„åšå®¢æ—¶é—´ï¼š</p>
<blockquote>
<ul>
<li>æ–‡ä»¶åä¸åŒ…åæ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä¸ä¸€å®šè¦å°†æ–‡ä»¶åä¸åŒ…åå®šæˆåŒä¸€ä¸ªã€‚</li>
<li>æ–‡ä»¶å¤¹åä¸åŒ…åæ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå¹¶ééœ€è¦ä¸€è‡´ã€‚</li>
<li>åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶åªèƒ½æœ‰ä¸€ä¸ªåŒ…åï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ã€‚</li>
</ul>
</blockquote>
<p>æ–‡ä»¶ç»“æ„:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Test</span><br><span class="line">--helloworld.go</span><br><span class="line"></span><br><span class="line">myMath</span><br><span class="line">--myMath1.go</span><br><span class="line">--myMath2.go</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç :</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// helloworld.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"./myMath"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    fmt.Println(<span class="string">"Hello World!"</span>)</span><br><span class="line">    fmt.Println(mathClass.Add(<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">    fmt.Println(mathClass.Sub(<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// myMath1.go</span></span><br><span class="line"><span class="keyword">package</span> mathClass</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(x,y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// myMath2.go</span></span><br><span class="line"><span class="keyword">package</span> mathClass</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sub</span><span class="params">(x,y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x - y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h2><p>å¸¸é‡ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿è¡Œæ—¶ä¸ä¼šè¢«ä¿®æ”¹çš„é‡ï¼Œå¸¸é‡ä¸­çš„æ•°æ®ç±»å‹åªå¯ä»¥æ˜¯å¸ƒå°”å‹ã€æ•°å­—å‹ï¼ˆæ•´æ•°å‹ã€æµ®ç‚¹å‹å’Œå¤æ•°ï¼‰å’Œå­—ç¬¦ä¸²å‹ã€‚å¸¸é‡å¯ä»¥ç”¨<code>len()</code>, <code>cap()</code>, <code>unsafe.Sizeof()</code>å‡½æ•°è®¡ç®—è¡¨è¾¾å¼çš„å€¼ã€‚</p>
<ul>
<li>æ˜¾å¼ç±»å‹å®šä¹‰ï¼š <code>const b string = &quot;abc&quot;</code></li>
<li>éšå¼ç±»å‹å®šä¹‰ï¼š <code>const b = &quot;abc&quot;</code></li>
</ul>
<h3 id="itoa"><a href="#itoa" class="headerlink" title="itoa"></a>itoa</h3><p>iotaï¼Œç‰¹æ®Šå¸¸é‡ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå¯ä»¥è¢«ç¼–è¯‘å™¨ä¿®æ”¹çš„å¸¸é‡ã€‚const ä¸­æ¯æ–°å¢ä¸€è¡Œå¸¸é‡å£°æ˜å°†ä½¿ iota è®¡æ•°ä¸€æ¬¡(iota å¯ç†è§£ä¸º const è¯­å¥å—ä¸­çš„<strong>è¡Œç´¢å¼•</strong>)ã€‚</p>
<p>ç¬¬ä¸€ä¸ª iota ç­‰äº 0ï¼Œæ¯å½“ iota åœ¨æ–°çš„ä¸€è¡Œè¢«ä½¿ç”¨æ—¶ï¼Œå®ƒçš„å€¼éƒ½ä¼šè‡ªåŠ¨åŠ  1ï¼›æ‰€ä»¥ a=0, b=1, c=2 å¯ä»¥ç®€å†™ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    a = <span class="literal">iota</span></span><br><span class="line">    b</span><br><span class="line">    c</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç»§ç»­æŠ„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">const</span> (</span><br><span class="line">            a = <span class="literal">iota</span>   <span class="comment">//0</span></span><br><span class="line">            b          <span class="comment">//1</span></span><br><span class="line">            c          <span class="comment">//2</span></span><br><span class="line">            d = <span class="string">"ha"</span>   <span class="comment">//ç‹¬ç«‹å€¼ï¼Œiota += 1</span></span><br><span class="line">            e          <span class="comment">//"ha"   iota += 1</span></span><br><span class="line">            f = <span class="number">100</span>    <span class="comment">//iota +=1</span></span><br><span class="line">            g          <span class="comment">//100  iota +=1</span></span><br><span class="line">            h = <span class="literal">iota</span>   <span class="comment">//7,æ¢å¤è®¡æ•°</span></span><br><span class="line">            i          <span class="comment">//8</span></span><br><span class="line">    )</span><br><span class="line">    fmt.Println(a,b,c,d,e,f,g,h,i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><p>goçš„è¿ç®—ç¬¦å€’æ˜¯å’ŒCçš„æ²¡ä»€ä¹ˆå¤ªå¤§åŒºåˆ«ï¼Œè¦ç”¨è‡ªå·±æŸ¥ã€‚</p>
<h2 id="è¯­å¥"><a href="#è¯­å¥" class="headerlink" title="è¯­å¥"></a>è¯­å¥</h2><p>è¯´ç‚¹ä¸ä¸€æ ·çš„ï¼Œgoè¯­è¨€<strong>æ²¡æœ‰while</strong>ï¼Œä¹Ÿæ˜¯forã€‚ã€‚ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> condition &#123; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>æ ¼å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">function_name</span><span class="params">( [parameter list] )</span> [<span class="title">return_types</span>]</span> &#123;</span><br><span class="line">   å‡½æ•°ä½“</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// example</span></span><br><span class="line"><span class="comment">/* å‡½æ•°è¿”å›ä¸¤ä¸ªæ•°çš„æœ€å¤§å€¼ */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(num1, num2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">   <span class="comment">/* å£°æ˜å±€éƒ¨å˜é‡ */</span></span><br><span class="line">   <span class="keyword">var</span> result <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (num1 &gt; num2) &#123;</span><br><span class="line">      result = num1</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result = num2</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒGo è¯­è¨€ä½¿ç”¨çš„æ˜¯å€¼ä¼ é€’ï¼Œå³åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¸ä¼šå½±å“åˆ°å®é™…å‚æ•°ã€‚</p>
<h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><p>è¿˜æ˜¯å’ŒCä¸€æ ·ï¼Œgoè¯­è¨€åˆå§‹åŒ–æ•°ç»„æ—¶éœ€è¦ç”³æ˜æ•°ç»„çš„é•¿åº¦ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> æ•°ç»„å˜é‡å [å…ƒç´ æ•°é‡]Type</span><br><span class="line"> <span class="comment">//  ä¾‹å­</span></span><br><span class="line"><span class="keyword">var</span> a [<span class="number">3</span>]<span class="keyword">int</span>             <span class="comment">// å®šä¹‰ä¸‰ä¸ªæ•´æ•°çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">// â€œ...â€çœç•¥å·ï¼Œåˆ™è¡¨ç¤ºæ•°ç»„çš„é•¿åº¦æ˜¯æ ¹æ®åˆå§‹åŒ–å€¼çš„ä¸ªæ•°æ¥è®¡ç®—</span></span><br><span class="line">q := [...]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯9102å¹´äº†è¿˜ç”¨è¿™ä¹ˆæ­»æ¿çš„è¯­è¨€è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæ‰€ä»¥å‡ºç°äº†åˆ‡ç‰‡ï¼š</p>
<h3 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h3><p>åˆ‡ç‰‡ï¼ˆsliceï¼‰æ˜¯å»ºç«‹åœ¨æ•°ç»„ä¹‹ä¸Šçš„æ›´æ–¹ä¾¿ï¼Œæ›´çµæ´»ï¼Œæ›´å¼ºå¤§çš„æ•°æ®ç»“æ„ã€‚åˆ‡ç‰‡å¹¶ä¸å­˜å‚¨ä»»ä½•å…ƒç´ è€Œåªæ˜¯å¯¹ç°æœ‰æ•°ç»„çš„å¼•ç”¨ã€‚</p>
<p>åˆ‡ç‰‡ä¸ªäººæ„Ÿè§‰å’ŒåŠ¨æ€æ•°ç»„å·®ä¸å¤šï¼Œå…·ä½“çš„è¿ç®—é€»è¾‘å’ŒåŸå› å°±åé¢å†è¯´ï¼Œè¿™é‡Œåªæä½¿ç”¨æ–¹æ³•ã€‚ä½ å¯ä»¥å£°æ˜ä¸€ä¸ªæœªæŒ‡å®šå¤§å°çš„æ•°ç»„æ¥å®šä¹‰åˆ‡ç‰‡ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier []<span class="keyword">type</span></span><br></pre></td></tr></table></figure>
<p>åˆ‡ç‰‡ä¸éœ€è¦è¯´æ˜é•¿åº¦ã€‚</p>
<p>æˆ–ä½¿ç”¨make()å‡½æ•°æ¥åˆ›å»ºåˆ‡ç‰‡:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slice1 []<span class="keyword">type</span> = <span class="built_in">make</span>([]<span class="keyword">type</span>, <span class="built_in">len</span>)</span><br><span class="line"></span><br><span class="line">ä¹Ÿå¯ä»¥ç®€å†™ä¸º</span><br><span class="line"></span><br><span class="line">slice1 := <span class="built_in">make</span>([]<span class="keyword">type</span>, <span class="built_in">len</span>)</span><br></pre></td></tr></table></figure>
<p>å‘åˆ‡ç‰‡ä¸­å¢åŠ æ–°å…ƒç´ ï¼šappend(oldslice, newelement)</p>
<h2 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h2><p>å’ŒCçš„è¿˜æ˜¯æ— æ¯”ç›¸ä¼¼ï¼Œç´¯äº†æ”¾å¼ƒã€‚</p>
<h2 id="ç»“æ„å’Œæ–¹æ³•"><a href="#ç»“æ„å’Œæ–¹æ³•" class="headerlink" title="ç»“æ„å’Œæ–¹æ³•"></a>ç»“æ„å’Œæ–¹æ³•</h2><p>ç»“æ„çš„å®šä¹‰æ–¹æ³•</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> struct_variable_type <span class="keyword">struct</span> &#123;</span><br><span class="line">   member definition</span><br><span class="line">   member definition</span><br><span class="line">   ...</span><br><span class="line">   member definition</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³äºç»“æ„ï¼šï¼ˆæŠ„çš„ï¼‰</p>
<blockquote>
<ol>
<li>ç”¨äºå®šä¹‰å¤æ‚çš„æ•°æ®ç»“æ„</li>
<li>structé‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µ(å±æ€§)ï¼Œå­—æ®µå¯ä»¥æ˜¯ä»»æ„ç±»å‹</li>
<li>structç±»å‹å¯ä»¥å®šä¹‰æ–¹æ³•(æ³¨æ„å’Œå‡½æ•°çš„åŒºåˆ«)</li>
<li>structç±»å‹æ˜¯å€¼ç±»å‹</li>
<li>structç±»å‹å¯ä»¥åµŒå¥—</li>
<li>Goè¯­è¨€æ²¡æœ‰classç±»å‹ï¼Œåªæœ‰structç±»å‹</li>
</ol>
</blockquote>
<p> åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<ol>
<li>æŒ‡é’ˆç±»å‹<br>var å˜é‡ = new (ç»“æ„ä½“åç§°)<br>var å˜é‡ = &amp;ç»“æ„ä½“åç§°{}<br>var å˜é‡ = &amp;ç»“æ„ä½“åç§°{æˆå‘˜A:å€¼ï¼Œæˆå‘˜B:å€¼}</li>
<li>å€¼ç±»å‹<br>var å˜é‡= ç»“æ„ä½“{æˆå‘˜A:å€¼ï¼Œæˆå‘˜B:å€¼}</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Books <span class="keyword">struct</span> &#123;</span><br><span class="line">   title <span class="keyword">string</span></span><br><span class="line">   author <span class="keyword">string</span></span><br><span class="line">   subject <span class="keyword">string</span></span><br><span class="line">   book_id <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> Book1 Books </span><br><span class="line">  <span class="keyword">var</span> Book2 *Books = &amp;Book&#123;&#125;</span><br><span class="line">  <span class="keyword">var</span> Book3 *Books = <span class="built_in">new</span>(Books)</span><br><span class="line">  <span class="keyword">var</span> struct_pointer *Books = &amp;Book1 <span class="comment">//æŒ‡å‘book1ç»“æ„ä½“çš„æŒ‡é’ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¢ä¸ªä¾‹å­ï¼ˆè¿˜æ˜¯æŠ„çš„ï¼‰</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name   <span class="keyword">string</span></span><br><span class="line">    Age    <span class="keyword">int</span></span><br><span class="line">    Source <span class="keyword">int</span></span><br><span class="line">    Next   *Student</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">creat</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> stu_head = Student&#123;Name: <span class="string">"li"</span>, Age: <span class="number">20</span>, Source: <span class="number">100</span>, Next: <span class="literal">nil</span>&#125;</span><br><span class="line">    <span class="keyword">var</span> stu_head1 = <span class="built_in">new</span>(Student)</span><br><span class="line">    <span class="keyword">var</span> stu_head3 = &amp;Student&#123;</span><br><span class="line">        Name: <span class="string">"wang"</span>,</span><br><span class="line">        Age:  <span class="number">12</span>,</span><br><span class="line">        Next: stu_head1,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(stu_head)</span><br><span class="line">    fmt.Println(*stu_head1)</span><br><span class="line">    fmt.Println(stu_head3.Next)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    creat()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p>æ–¹æ³•è¿™ç§ä¸œè¥¿æ€»ç®—å›åˆ°äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„OOç¼–ç¨‹çš„ä¸–ç•Œã€‚ã€‚ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å®ç°æ¥å£æ–¹æ³• */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(struct_name_variable struct_name)</span> <span class="title">method_name1</span><span class="params">()</span> [<span class="title">return_type</span>]</span> &#123;</span><br><span class="line">   <span class="comment">/* æ–¹æ³•å®ç° */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Go æ²¡æœ‰é¢å‘å¯¹è±¡ï¼Œè€Œæˆ‘ä»¬çŸ¥é“å¸¸è§çš„ Javaï¼ŒC++ ç­‰è¯­è¨€ä¸­ï¼Œå®ç°ç±»çš„æ–¹æ³•åšæ³•éƒ½æ˜¯ç¼–è¯‘å™¨éšå¼çš„ç»™å‡½æ•°åŠ ä¸€ä¸ª this æŒ‡é’ˆï¼Œè€Œåœ¨ Go é‡Œï¼Œè¿™ä¸ª this æŒ‡é’ˆéœ€è¦æ˜ç¡®çš„ç”³æ˜å‡ºæ¥ï¼Œå…¶å®å’Œå…¶å®ƒ OO è¯­è¨€å¹¶æ²¡æœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span> <span class="title">getArea</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">  <span class="comment">//c.radius å³ä¸º Circle ç±»å‹å¯¹è±¡ä¸­çš„å±æ€§</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">3.14</span> * c.radius * c.radius</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>åƒPythonçš„dictçš„é”®å€¼å¯¹ï¼Œä½†æ˜¯è¿˜ä¸çŸ¥é“å†…éƒ¨å­˜å‚¨æ–¹å¼ï¼Œç´¯äº†æ€ä¹ˆç”¨ä»¥åå†è¯´ã€‚</p>
<h2 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h2><p>å°±æ˜¯æˆ‘ä»¬çŸ¥é“çš„interfaceã€‚ã€‚ã€‚ã€‚ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™ä¸æ˜¯ç”¨implementationæˆ–è€…æ˜¯ç»§æ‰¿ï¼Œåªè¦åœ¨interfaceé‡Œå®šä¹‰äº†ä¼šè¢«ç»§æ‰¿çš„ç±»å…ƒç´ å°±è¡Œã€‚</p>
<p>ç»§ç»­æŠ„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Phone <span class="keyword">interface</span> &#123;</span><br><span class="line">    call()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> NokiaPhone <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(nokiaPhone NokiaPhone)</span> <span class="title">call</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"I am Nokia, I can call you!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IPhone <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(iPhone IPhone)</span> <span class="title">call</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"I am iPhone, I can call you!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> phone Phone <span class="comment">//!!!,åœ¨å…·ä½“struct iphoneå’Œnokiaé‡Œæ˜¯ä¸‡ä¸‡ä¸èƒ½è¿™ä¹ˆå†™çš„ï¼Œå› ä¸ºnewè¿”å›çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œéœ€è¦èµ‹å€¼ç»™ä¸€ä¸ªæŒ‡é’ˆæ¥æŒ‡å‘è¿™ä¸ªåœ°å€ã€‚</span></span><br><span class="line"></span><br><span class="line">    phone = <span class="built_in">new</span>(NokiaPhone)</span><br><span class="line">    phone.call()</span><br><span class="line"></span><br><span class="line">    phone = <span class="built_in">new</span>(IPhone)</span><br><span class="line">    phone.call()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>interfaceçš„å…·ä½“å®ç°è¯¦è§<a href="https://www.jianshu.com/p/70003e0f49d1" target="_blank" rel="noopener">https://www.jianshu.com/p/70003e0f49d1</a> ï¼ˆåé¢æœ‰ç©ºå†ç ”ç©¶ï¼‰</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/18/RobPike-concurrency-lecture-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/18/RobPike-concurrency-lecture-note/" itemprop="url">
                  RobPike concurrency lecture note
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-18 10:19:29 / Modified: 10:25:31" itemprop="dateCreated datePublished" datetime="2020-02-18T10:19:29+08:00">2020-02-18</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Rob Pike çš„è®²åº§</p>
<p>pptï¼š<a href="https://talks.golang.org/2012/concurrency.slide#2" target="_blank" rel="noopener">https://talks.golang.org/2012/concurrency.slide#2</a></p>
<p>vedioï¼š<a href="https://www.youtube.com/watch?v=f6kdp27TYZs" target="_blank" rel="noopener">https://www.youtube.com/watch?v=f6kdp27TYZs</a></p>
<p>å°±æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€ä½†æ˜¯å¾ˆæ¸…æ¥šçš„å…³äºgo concurrencyçš„å…¥é—¨è®²åº§ã€‚</p>
<h2 id="è®²åœ¨å‰é¢"><a href="#è®²åœ¨å‰é¢" class="headerlink" title="è®²åœ¨å‰é¢"></a>è®²åœ¨å‰é¢</h2><h3 id="concurrency-and-parallelism"><a href="#concurrency-and-parallelism" class="headerlink" title="concurrency and parallelism"></a>concurrency and parallelism</h3><p>ä¸æƒ³è¯¦ç»†è¯´ä½†æ˜¯ã€‚ã€‚ã€‚ä»Robçš„è®²åº§æ¥ç®€å•è¯´å°±æ˜¯</p>
<ul>
<li>concurrencyï¼šä¸€ä¸ªprocessor</li>
<li>parallelismï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶å¤„ç†</li>
</ul>
<p>ï¼ˆå¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«ç³»åˆ—</p>
<h3 id="CSPçš„å¼€å§‹"><a href="#CSPçš„å¼€å§‹" class="headerlink" title="CSPçš„å¼€å§‹"></a>CSPçš„å¼€å§‹</h3><p>ä¸€åˆ‡çš„å¼€ç«¯ï¼š1978å¹´hoareçš„è®ºæ–‡ï¼Œè®²äº†communicating sequential processçš„åŸç†ã€‚</p>
<h2 id="Go-and-cocurrency"><a href="#Go-and-cocurrency" class="headerlink" title="Go and cocurrency"></a>Go and cocurrency</h2><p>Goå’Œå…¶ä»–å®ç°cspè¯­è¨€æœ€å¤§çš„åŒºåˆ«ï¼šå…¶ä»–è¯­è¨€æ¯”å¦‚Erlangæ˜¯ç›´æ¥å’Œprocessäº¤äº’ï¼Œè€Œgoè¯­è¨€æ˜¯å’Œchannelè¿›è¡Œäº¤æµã€‚</p>
<h3 id="Goroutine"><a href="#Goroutine" class="headerlink" title="Goroutine"></a>Goroutine</h3><ul>
<li>ç®€å•æ¥è¯´ï¼šä¸€ä¸ªç”±goæŒ‡ä»¤ç”Ÿæˆçš„å•ç‹¬è¿è¡Œå‡½æ•°</li>
<li>æ¯ä¸ªgoroutineæ‹¥æœ‰è‡ªå·±çš„stackï¼ŒåŒæ—¶è¿™ä¸ªstackçš„å¤§å°ä¼šéšç€æ‰§è¡Œçš„éœ€è¦å˜å¤§æˆ–ç¼©å°ã€‚è¿™æ ·çš„è¯å’Œæ¯ä¸ªçº¿ç¨‹éƒ½è¦æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œå¹¶ä¸”ä¸ºäº†ä¿è¯è¿è¡Œçš„å­˜å‚¨é—®é¢˜æ ˆç©ºé—´éœ€è¦è®¾è®¡çš„è¶³å¤Ÿå¤§ä¸ä¸€æ ·ï¼Œgoroutineçš„åˆå§‹åŒ–æ˜¯å¾ˆä¾¿å®œçš„</li>
<li>ä»goroutineçš„è°ƒåº¦ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¯èƒ½æ‰§è¡Œç€æˆç™¾ä¸Šåƒä¸ªåç¨‹ï¼ˆå¯ä»¥åé¢æ•´ç†ä¸€ä¸‹goroutineçš„è°ƒåº¦é—®é¢˜ï¼‰</li>
<li>å½“ç„¶ä»ç†è§£ä¸Šæ¥çœ‹å¯ä»¥æŠŠgoroutineç†è§£ä¸ºä¸€ä¸ªéå¸¸éå¸¸è½»ä¾¿çš„çº¿ç¨‹</li>
</ul>
<p>ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">boring</span><span class="params">(msg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; ; i++ &#123;</span><br><span class="line">        fmt.Println(msg, i)</span><br><span class="line">        time.Sleep(time.Duration(rand.Intn(<span class="number">1e3</span>)) * time.Millisecond)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"math/rand"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> boring(<span class="string">"boring!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š<code>Program exited.</code></p>
<h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><p>channelæ˜¯ä¸€ä¸ªgoroutineçš„åŸºç¡€ï¼Œå…·ä½“ä»‹ç»å’Œgoroutineç®€ä»‹é‡Œé¢åŸºæœ¬ä¸Šä¸€æ¨¡ä¸€æ ·ã€‚</p>
<h3 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h3><blockquote>
<p>A control structure unique to concurrency</p>
</blockquote>
<p>çœ‹èµ·æ¥å¾ˆåƒä¸€ä¸ªswitché€‰é¡¹ï¼Œä½†æ˜¯æ˜¯å®Œå…¨é’ˆå¯¹concurrencyè®¾ç½®çš„ï¼Œå®ƒå’Œswitchçš„åŒºåˆ«ï¼š</p>
<ul>
<li>æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯ä¸€ä¸ªcommunication(send or receive)</li>
<li>åœ¨å¼€å§‹æ—¶ä¼šè¡¡é‡æ‰€æœ‰çš„communication</li>
<li>æ•´ä¸ªæµç¨‹ä¼šä¸€ç›´å¡ä½ç›´åˆ°æŸä¸ªcommunicationå¯ä»¥è¿›è¡Œä¸‹å»</li>
<li>å¦‚æœåŒæ—¶æœ‰å¤šä¸ªcommunicationéƒ½å¯ä»¥è¿›è¡Œï¼Œéšæœºé€‰å–ä¸€ä¸ªè¿›è¡Œ</li>
<li>å¦‚æœæ‰€æœ‰communicationéƒ½æ— æ³•è¿›è¡Œå¹¶ä¸”æœ‰ä¸€ä¸ªdefaulté€‰é¡¹ï¼Œä¸å¡ä½ç›´æ¥èµ°default</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> v1 := &lt;-c1:</span><br><span class="line">    fmt.Printf(<span class="string">"received %v from c1\n"</span>, v1)</span><br><span class="line"><span class="keyword">case</span> v2 := &lt;-c2:</span><br><span class="line">    fmt.Printf(<span class="string">"received %v from c2\n"</span>, v1)</span><br><span class="line"><span class="keyword">case</span> c3 &lt;- <span class="number">23</span>:</span><br><span class="line">    fmt.Printf(<span class="string">"sent %v to c3\n"</span>, <span class="number">23</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    fmt.Printf(<span class="string">"no one was ready to communicate\n"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Daisy-chain"><a href="#Daisy-chain" class="headerlink" title="Daisy-chain"></a>Daisy-chain</h3><p>èŠèŠ±é“¾å¹¶ä¸æ˜¯ä¸€ä¸ªåƒselectä¸€æ ·çš„å‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯ä»¥ç”¨goè¯­è¨€å’Œåç¨‹æ¥ç®€å•å®ç°çš„åŠŸèƒ½</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(left, right <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    left &lt;- <span class="number">1</span> + &lt;-right</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">const</span> n = <span class="number">10000</span></span><br><span class="line">    leftmost := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">    right := leftmost</span><br><span class="line">    left := leftmost</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        right = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">        <span class="keyword">go</span> f(left, right)</span><br><span class="line">        left = right</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(c <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123; c &lt;- <span class="number">1</span> &#125;(right)</span><br><span class="line">    fmt.Println(&lt;-leftmost)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/../images/go/Daisy_chain.png" alt="Daisy Chain"></p>
<p>è¿™æ®µä»£ç å®ç°çš„å°±æ˜¯ä¸Šå›¾æ‰€ç¤ºçš„é€»è¾‘ï¼Œçœ‹èµ·æ¥éå¸¸éš¾ä»¥ç†è§£ï¼Œå®é™…ä¸Šmakeä¸€ä¸ªchannelä¹‹åè¿”å›çš„æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥å°±æ˜¯ä¸€å¼€å§‹leftå’ŒrightæŒ‡å‘çš„éƒ½æ˜¯æœ€å·¦ç«¯ä¹Ÿå°±æ˜¯ç»ˆç«¯çš„channelï¼Œä¹‹åæ–°å»ºäº†ä¸€ä¸ªchannelï¼Œå¹¶ä¸”è®©å·¦è¾¹çš„channelå»è·å–æ–°å»ºchannelçš„å€¼ï¼Œç„¶åå†æŠŠleftçš„æŒ‡é’ˆæŒ‡å‘å®ƒè®©å®ƒå˜æˆä¸‹ä¸€ä¸ªå·¦è¾¹ã€‚æœ€åå‘æœ€å³è¾¹çš„channelè¾“å…¥ä¸€ä¸ªå€¼ï¼Œè§¦å‘äº†è¿™æ¡ä¼ è¯é“¾ã€‚</p>
<p>ä»å®é™…çš„è¿è¡Œæƒ…å†µæ¥çœ‹ï¼Œå³ä½¿æˆ‘ä»¬åˆ›å»ºäº†ä¸Šä¸‡ä¸ªåç¨‹æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯è¿è¡Œæ—¶é—´éå¸¸è¿…é€Ÿï¼Œåç¨‹è½»é‡çš„ç‰¹å¾è®©ä»–åœ¨åˆ›å»ºå’Œè¿è¡Œçš„æ—¶å€™éå¸¸è¿…é€Ÿã€‚</p>
<h2 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a>Attention</h2><p>ç®€å•æ¥è¯´ï¼Œgoå’Œconcurrencyæ˜¯ä¸€ç§ç”¨äºsoftware constructionçš„éå¸¸å¥½çš„è¯­è¨€ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ä¸è¦æ€é¸¡ç”¨ç‰›åˆ€ï¼Œä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨å°±å¯ä»¥è§£å†³çš„é—®é¢˜å°±ä¸è¦ç”¨channeläº†ğŸ˜‚</p>
<p>goé‡Œé¢ä¹Ÿæä¾›äº†sync/atomicåŒ…æ¥æä¾›ä¸€äº›åœ°å€è®¿é—®åŒæ­¥/é”ç­‰å¤šçº¿ç¨‹ä¼šç”¨åˆ°çš„æ“ä½œï¼Œåˆç†è€ƒè™‘ä½¿ç”¨channelã€‚</p>
<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><p>ä¸€äº›å­¦ä¹ ç½‘ç«™</p>
<p>Go Home Page:</p>
<p><a href="http://golang.org/" target="_blank" rel="noopener">golang.org</a></p>
<p>Go Tour (learn Go in your browser)</p>
<p><a href="http://tour.golang.org/" target="_blank" rel="noopener">tour.golang.org</a></p>
<p>Package documentation:</p>
<p><a href="http://golang.org/pkg" target="_blank" rel="noopener">golang.org/pkg</a></p>
<p>Articles galore:</p>
<p><a href="http://golang.org/doc" target="_blank" rel="noopener">golang.org/doc</a></p>
<p>Concurrency is not parallelism:</p>
<p><a href="http://golang.org/s/concurrency-is-not-parallelism" target="_blank" rel="noopener">golang.org/s/concurrency-is-not-parallelism</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/29/multi-layer-vis-research/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/29/multi-layer-vis-research/" itemprop="url">
                  multi-layer vis research
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-29 00:41:05" itemprop="dateCreated datePublished" datetime="2019-03-29T00:41:05+08:00">2019-03-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-05-10 00:06:11" itemprop="dateModified" datetime="2019-05-10T00:06:11+08:00">2019-05-10</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/visualization/" itemprop="url" rel="index"><span itemprop="name">visualization</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/visualization/multi-layer/" itemprop="url" rel="index"><span itemprop="name">multi-layer</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="èåˆå¸ƒå±€"><a href="#èåˆå¸ƒå±€" class="headerlink" title="èåˆå¸ƒå±€"></a>èåˆå¸ƒå±€</h1><h2 id="æ–¹æ³•ä¸€ï¼šç«‹ä½“å¸ƒå±€"><a href="#æ–¹æ³•ä¸€ï¼šç«‹ä½“å¸ƒå±€" class="headerlink" title="æ–¹æ³•ä¸€ï¼šç«‹ä½“å¸ƒå±€"></a>æ–¹æ³•ä¸€ï¼šç«‹ä½“å¸ƒå±€</h2><h3 id="A-Multi-layer-Network-Topology-Visualization-Layout-Based-on-Louvain-Community-Detection"><a href="#A-Multi-layer-Network-Topology-Visualization-Layout-Based-on-Louvain-Community-Detection" class="headerlink" title="A Multi-layer Network Topology Visualization Layout Based on Louvain Community Detection"></a>A Multi-layer Network Topology Visualization Layout Based on Louvain Community Detection</h3><p><img src="/../images/multiLayer/multi-layer.png" alt="Multi-Layer"></p>
<p><img src="/../images/multiLayer/Louvian.png" alt="Louvian"></p>
<h3 id="MLMD-Multi-Layered-Visualization-for-Multi-Dimensional-Data"><a href="#MLMD-Multi-Layered-Visualization-for-Multi-Dimensional-Data" class="headerlink" title="MLMD: Multi-Layered Visualization for Multi-Dimensional Data"></a><a href="http://or.nsfc.gov.cn/bitstream/00001903-5/159179/1/1000006764565.pdf" target="_blank" rel="noopener">MLMD: Multi-Layered Visualization for Multi-Dimensional Data</a></h3><p>åŸºäºèšç±»å’Œè¾¹ç»‘å®šçš„å¸ƒå±€ä¼˜åŒ–ã€‚</p>
<p><img src="/../images/multiLayer/MLMD.png" alt="MLMD"></p>
<h3 id="Visualization-using-Multi-Layered-U-Matrix-in-Growing-Tree-Structured-Self-Organizing-Feature-Map"><a href="#Visualization-using-Multi-Layered-U-Matrix-in-Growing-Tree-Structured-Self-Organizing-Feature-Map" class="headerlink" title="Visualization using Multi-Layered U-Matrix in Growing Tree-Structured Self-Organizing Feature Map"></a><a href="http://ieeexplore.ieee.org/document/6084224/" target="_blank" rel="noopener">Visualization using Multi-Layered U-Matrix in Growing Tree-Structured Self-Organizing Feature Map</a></h3><p>ç”¨äºè¿›è¡Œæ ‘çš„å¤šå±‚å¸ƒå±€ï¼Œä½†æ˜¯ç”¨æ­£å…­è¾¹å½¢æ¥å›ºå®šä½ç½®çš„æ€æƒ³å¯ä»¥è€ƒè™‘</p>
<p><img src="/../images/multiLayer/SOM02.png" alt="SOMTree"></p>
<p><img src="/../images/multiLayer/SOM01.png" alt="SOMLyaout"></p>
<h3 id="Word-Clouds-in-the-Sky-Multi-layer-Spatio-temporal-Event-Visualization-from-a-Geo-parsed-Microblog-Stream"><a href="#Word-Clouds-in-the-Sky-Multi-layer-Spatio-temporal-Event-Visualization-from-a-Geo-parsed-Microblog-Stream" class="headerlink" title="Word-Clouds in the Sky: Multi-layer Spatio-temporal Event Visualization from a Geo-parsed Microblog Stream"></a><a href="https://ieeexplore.ieee.org/document/7557940" target="_blank" rel="noopener">Word-Clouds in the Sky: Multi-layer Spatio-temporal Event Visualization from a Geo-parsed Microblog Stream</a></h3><p><img src="/../images/multiLayer/word_cloud.png" alt="word cloud"></p>
<h2 id="æ–¹æ³•äºŒï¼šå¹³é¢å¸ƒå±€"><a href="#æ–¹æ³•äºŒï¼šå¹³é¢å¸ƒå±€" class="headerlink" title="æ–¹æ³•äºŒï¼šå¹³é¢å¸ƒå±€"></a>æ–¹æ³•äºŒï¼šå¹³é¢å¸ƒå±€</h2><h3 id="Fast-content-aware-resizing-of-multi-layer-information-visualization-via-adaptive-triangulation"><a href="#Fast-content-aware-resizing-of-multi-layer-information-visualization-via-adaptive-triangulation" class="headerlink" title="Fast content-aware resizing of multi-layer information visualization via adaptive triangulation"></a><a href="https://www.sciencedirect.com/science/article/pii/S1045926X16301665" target="_blank" rel="noopener">Fast content-aware resizing of multi-layer information visualization via adaptive triangulation</a></h3><p><img src="/../images/multiLayer/ada-tri.png" alt="adaptive tri"></p>
<h3 id="MultiNets-Web-Based-Multilayer-Network-Visualization"><a href="#MultiNets-Web-Based-Multilayer-Network-Visualization" class="headerlink" title="MultiNets: Web-Based Multilayer Network Visualization"></a><a href="https://link.springer.com/chapter/10.1007%2F978-3-319-23461-8_34" target="_blank" rel="noopener">MultiNets: Web-Based Multilayer Network Visualization</a></h3><p>åŒå±‚æ”¾åœ¨åŒä¸€å¼ å›¾é‡Œï¼Œç”¨é¢œè‰²åŒºåˆ†ã€‚</p>
<p><img src="/../images/multiLayer/multi-nets.png" alt="multi-nets"></p>
<h3 id="Py3plex-A-Library-for-Scalable-Multilayer-Network-Analysis-and-Visualization"><a href="#Py3plex-A-Library-for-Scalable-Multilayer-Network-Analysis-and-Visualization" class="headerlink" title="Py3plex: A Library for Scalable Multilayer Network Analysis and Visualization"></a><a href="https://link.springer.com/chapter/10.1007/978-3-030-05411-3_60" target="_blank" rel="noopener">Py3plex: A Library for Scalable Multilayer Network Analysis and Visualization</a></h3><p><img src="/../images/multiLayer/Py3plex.png" alt="Py3plex"></p>
<h3 id="The-State-of-the-Art-in-Multilayer-Network-Visualization"><a href="#The-State-of-the-Art-in-Multilayer-Network-Visualization" class="headerlink" title="The State of the Art in Multilayer Network Visualization"></a><a href="https://arxiv.org/pdf/1902.06815.pdf" target="_blank" rel="noopener">The State of the Art in Multilayer Network Visualization</a></h3><p><img src="/../images/multiLayer/multi_art_1.png" alt="multi-1"></p>
<p><img src="/../images/multiLayer/multi_art_2.png" alt="multi-2"></p>
<p><img src="/../images/multiLayer/multi_art_3.png" alt="multi-3"></p>
<h2 id="TOOLS"><a href="#TOOLS" class="headerlink" title="TOOLS"></a>TOOLS</h2><p><img src="/../images/multiLayer/tools.png" alt="Tools"></p>
<h3 id="muxVis"><a href="#muxVis" class="headerlink" title="muxVis"></a><a href="https://github.com/manlius/muxViz" target="_blank" rel="noopener">muxVis</a></h3><p><img src="/../images/multiLayer/case1.gif" alt="case1"></p>
<p><img src="/../images/multiLayer/case2.gif" alt="case2"></p>
<h2 id="Design"><a href="#Design" class="headerlink" title="Design"></a>Design</h2><h3 id="3D"><a href="#3D" class="headerlink" title="3D"></a>3D</h3><p>æŠŠæ¯å±‚IPç›¸åŒçš„ç‚¹åˆå¹¶è¿›è¡ŒåŠ›å¯¼å‘å¸ƒå±€<br><br>é—®é¢˜ï¼šå¤šä¸ªèŠ‚ç‚¹å¯èƒ½å¯¹åº”åŒä¸€ä¸ªIP</p>
<ul>
<li>è§£å†³æ–¹æ³•ä¸€ï¼š<br><img src="/../images/multiLayer/correction.png" alt="Correction"></li>
<li>è§£å†³æ–¹æ³•äºŒï¼š<br>å¯¹åº”åŒä¸€IPçš„èŠ‚ç‚¹åˆå¹¶<br>åªæå–å¤šå±‚æœ‰è¿æ¥çš„ç‚¹å’Œä»–ä»¬çš„è¾¹è¿›è¡Œåˆå§‹å¸ƒå±€ -&gt; ä½œä¸ºmedium layer<br>å‰©ä¸‹çš„èŠ‚ç‚¹åœ¨åˆ†æ•£è¿›è‡ªå·±çš„å±‚çš„æ—¶å€™å†å¸ƒå±€ã€‚åˆ©ç”¨medium layer çš„ Voronoi diagram å°†æ¯å±‚ç‚¹çš„ä½ç½®ç›¸å¯¹å›ºå®šå¹¶ä¸”æŠŠåˆå¹¶çš„ç‚¹åˆ†ç¦»</li>
<li>è§£å†³æ–¹æ³•ä¸‰ï¼š<br>ä¸åˆå¹¶ï¼Œå¯¹å¯¹åº”åŒä¸€IPçš„èŠ‚ç‚¹æ·»åŠ ä¸€æ ¹è™šæ‹Ÿè¾¹ -&gt; æ‹¥æœ‰å¼•åŠ› -&gt;è¿˜æ˜¯ä½œä¸ºsuper graph<br>åˆ©ç”¨super graph çš„ Voronoi diagram å°†æ¯å±‚ç‚¹çš„ä½ç½®ç›¸å¯¹å›ºå®šå¹¶ä¸”æŠŠåˆ†å¼€çš„ç‚¹åˆå¹¶</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/21/GNN-Research-Report/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/21/GNN-Research-Report/" itemprop="url">
                  GNN Research Report
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-21 21:55:23" itemprop="dateCreated datePublished" datetime="2019-03-21T21:55:23+08:00">2019-03-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-12 18:49:34" itemprop="dateModified" datetime="2019-04-12T18:49:34+08:00">2019-04-12</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Machine-Learning/" itemprop="url" rel="index"><span itemprop="name">Machine Learning</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Machine-Learning/GNN/" itemprop="url" rel="index"><span itemprop="name">GNN</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¸»è¦æ›´æ–°GNNé’ˆå¯¹å›¾å¸ƒå±€å’Œå¸ƒå±€evaluationä¸Šçš„é—®é¢˜å’Œæ€è·¯</p>
<hr>
<p>å›¾å¸ƒå±€çš„ä¿¡æ¯ï¼š1. èŠ‚ç‚¹çš„ç»“æ„ä¿¡æ¯ 2. èŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯ã€‚</p>
<p>GNN -&gt; è®­ç»ƒå¾—åˆ°èŠ‚ç‚¹çš„ç»“æ„ä¿¡æ¯<br><img src="/../images/GNN/GNN_structure.png" alt="GNN Structure"></p>
<hr>
<p>é—®é¢˜ï¼š1. å¦‚ä½•è·å–èŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯ 2. å¦‚ä½•å°†è¿™ä¸¤ä¸ªä¿¡æ¯ç»“åˆèµ·æ¥</p>
<p><strong>æ‹Ÿé‡‡ç”¨çš„æ–¹æ³•</strong>ï¼š</p>
<p>èŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯ï¼š</p>
<ol>
<li>ç»å¯¹ä½ç½®ä¿¡æ¯-&gt;GNN-&gt;è®­ç»ƒå¾—åˆ°å¸ƒå±€æ–¹æ³•ï¼ˆæ²¡æœ‰å¯è§£é‡Šæ€§ï¼‰</li>
<li>é‡‡ç”¨pointCNNæ€æƒ³ï¼Œé¦–å…ˆåˆ©ç”¨å‘¨å›´èŠ‚ç‚¹è·å–ç›¸å¯¹ä½ç½®ï¼Œç„¶ååŠ å…¥ $X-transform$ æ¥è®©èŠ‚ç‚¹ä½ç½®å…·æœ‰æ—‹è½¬ä¸å˜æ€§ï¼Œæœ€åå°†èŠ‚ç‚¹ä½ç½®featureç”¨CNNæ–¹æ³•å‡åˆ°é«˜ç»´ã€‚ï¼ˆé‚»åŸŸorç›¸é‚»èŠ‚ç‚¹ï¼‰</li>
<li>åˆ©ç”¨GNNè‡ªå·±è®­ç»ƒï¼ˆlabelå’Œloss functionéš¾å®šä¹‰)ã€‚</li>
<li>å½’ä¸€åŒ–ï¼Ÿ</li>
</ol>
<p>ç»“åˆä¸¤ä¸ªä¿¡æ¯ï¼š</p>
<ol>
<li>æŠŠGNNæå–featureå’Œåé¢çš„decisionï¼ˆå³$f$ å’Œ $g$ï¼‰æ­¥éª¤åˆ†å¼€ã€‚</li>
<li>å°†GNNè®­ç»ƒå¾—åˆ°çš„ç»“æ„ä¿¡æ¯å’ŒpointCNNè®­ç»ƒå¾—åˆ°çš„ä½ç½®ä¿¡æ¯åˆå¹¶(æ¯”å¦‚æœ€ç²—æš´çš„concat)</li>
</ol>
<p><img src="/../images/GNN/PCNN_rel.png" alt="PCNN relative position"></p>
<hr>
<p>Dynamic Graph</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1] <a href="http://arxiv.org/abs/1801.07791" target="_blank" rel="noopener">Li, Y., Bu, R., Sun, M., Wu, W., Di, X., &amp; Chen, B. (2018). PointCNN: Convolution On $\mathcal{X}$-Transformed Points.</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/27/GNN-General-Conclusion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/27/GNN-General-Conclusion/" itemprop="url">
                  GNN General Introduction
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-27 17:38:41" itemprop="dateCreated datePublished" datetime="2019-02-27T17:38:41+08:00">2019-02-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-12 18:49:30" itemprop="dateModified" datetime="2019-04-12T18:49:30+08:00">2019-04-12</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Machine-Learning/" itemprop="url" rel="index"><span itemprop="name">Machine Learning</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Machine-Learning/GNN/" itemprop="url" rel="index"><span itemprop="name">GNN</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Graph Neural Networkï¼Œ å‡ºç°åŸå› ï¼šCNNï¼šåŸºäºæ¬§å¼ç©ºé—´ï¼Œå¦‚æœæŒ‰ç…§CNNå¯¹å›¾è¿›è¡Œå·ç§¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„é‚»æ¥èŠ‚ç‚¹ä¸ä¸€æ ·-&gt;æ— æ³•å®ç°æƒé‡å…±äº«ï¼Œä½†åŒæ—¶æˆ‘ä»¬æƒ³ä»å›¾ä¸­æå–ç‰¹å¾ä¿¡æ¯ã€‚<br>åº”ç”¨æ•°æ®ï¼šç¤¾äº¤ç½‘ç»œï¼ŒåŒ–å­¦ï¼Œå›¾åƒï¼Œæ–‡æœ¬ç­‰ç­‰ã€‚</p>
<h2 id="GNN-ä»‹ç»"><a href="#GNN-ä»‹ç»" class="headerlink" title="GNN ä»‹ç»"></a>GNN ä»‹ç»</h2><p>æ•´ä¸ªGNNçš„è¿‡ç¨‹å¯ä»¥åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šç‰¹å¾è®¡ç®—å’Œç»“æœè®¡ç®—ï¼Œå³å›¾ä¸­çš„ $f$ å’Œ $g$ï¼Œ$f$ çš„æ€è·¯å’Œembeddingå¾ˆç›¸ä¼¼ï¼Œå°±æ˜¯å¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹ç”Ÿæˆä¸€ä¸ªæè¿°å®ƒçš„featureï¼Œä¸åŒçš„æ˜¯é™¤äº†èŠ‚ç‚¹ï¼Œè¾¹å’Œæ•´ä¸ªå›¾çš„featureä¹Ÿå¯ä»¥ç”Ÿæˆï¼Œ$g$ å°±æ˜¯æ ¹æ®è®¡ç®—å‡ºçš„featureè¾“å‡ºå¯¹åº”çš„ç»“æœï¼Œæ¯”å¦‚ç±»åˆ«ç­‰ã€‚<br>å†™æˆå…¬å¼å°±æ˜¯ï¼š<br>$$<br>\begin{aligned}<br>x_n&amp;=f_w(l_n,l_{co(n)},x_{ne(n)},l_{ne(n)})\\o_n&amp;=g_w(x_n,l_n)<br>\end{aligned}<br>$$<br><img src="/../images/GNN/GNN_structure.png" alt="GNN Structure"><br>$g$ å’ŒCNNçš„FCå±‚å¾ˆç›¸ä¼¼æ²¡ä»€ä¹ˆç‰¹æ®Šçš„ï¼ŒGNNçš„é‡ç‚¹ä¹Ÿæ”¾åœ¨äº†feature $x_n$çš„è®¡ç®—ä¸Šã€‚</p>
<p>æ ¹æ®09å¹´[1]æå‡ºçš„åˆå§‹GNNçš„æ€è·¯ï¼Œ$x_n$çš„è®¡ç®—æ–¹æ³•å…¶å®æ˜¯è¿›è¡Œä¸æ–­çš„æ›´æ–°ç›´åˆ°æ”¶æ•›ï¼Œæ‰€ä»¥æŠŠä¸Šé¢å³å›¾å°±æ˜¯å·¦å›¾æŒ‰ç…§æ—¶é—´è®¡ç®—å±•å¼€ã€‚</p>
<p>å…¶å®ä¸Šé¢çš„åˆå§‹GNNè®¡ç®—æ–¹æ³•åªç¡®å®šäº†å¦‚ä½•å¯¹æ¯ä¸ªèŠ‚ç‚¹è®¡ç®—featureï¼Œåæ¥åœ¨å®ƒçš„åŸºç¡€ä¸Šå‡ºç°äº†å„ç§è¾¹çš„è®¡ç®—æ–¹å¼ï¼Œæœ€ç»ˆ[2]æ€»ç»“å¹¶ä¸”æŠŠæ•´ä¸ªGNNæ¨¡å‹æ•´åˆåœ¨äº†ä¸€èµ·ã€‚</p>
<h2 id="GN-Block"><a href="#GN-Block" class="headerlink" title="GN Block"></a>GN Block</h2><p>æ¯ä¸€ä¸ªGN Blockä¸­ï¼Œ$e_n, v_n, u$ï¼Œ$e_n$ å’Œ  $v_n$ åˆ†åˆ«ä»£è¡¨äº†æ¯æ¡è¾¹å’ŒèŠ‚ç‚¹çš„å¯¹åº”å±æ€§ï¼Œ$u$ æ˜¯æ•´å¼ å›¾çš„ global attributeï¼Œæ ¹æ®æœ€åtaskçš„éœ€è¦é€‰æ‹©éœ€è¦çš„å±æ€§è¿›è¡Œè¾“å‡ºã€‚</p>
<p><img src="/../images/GNN/RIB_GNB.png" alt="GN propagate"><br>æ•´ä¸ªå‰é¦ˆè¿‡ç¨‹å…¶å®ä¹Ÿåªæœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š$\phi$ä½œä¸ºæ›´æ–°å‡½æ•°(update)ï¼Œ$\rho$ ä½œä¸ºèšåˆå‡½æ•°(aggregate)ï¼Œå‰è€…æ›´æ–°å„ç§featureçš„å€¼ï¼Œåè€…å°†æ‰€éœ€è¦çš„å€¼èšåˆåœ¨ä¸€èµ·ç”¨äºåé¢è¿›ä¸€æ­¥çš„æ›´æ–°ã€‚<br>ä¸‹é¢è¿™å¼ å›¾å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„GN Blockçš„æ›´æ–°è¿‡ç¨‹ã€‚<br><img src="/../images/GNN/GN_FULL.png" alt="GN FULL"></p>
<p>å¤šä¸ªGN Blockçš„é—®é¢˜ï¼Œè¿™ä¸¤ä¸ªéƒ½å±äºæ‹¥æœ‰å¤šä¸ªGN Blocksæ—¶å€™çš„ä¸åŒç»„åˆæ–¹æ³•ï¼Œåƒè‡ªç¼–ç å™¨å’ŒRNNå¾ªç¯æ—¶é€šè¿‡çš„æ˜¯åŒä¸€ä¸ªGN Blockï¼Œåªæ˜¯GRNNä¼šå¤šåŠ éšå±‚ï¼Œä¹Ÿå¯ä»¥å°†ä¸åŒç»“æ„çš„GN Blocksç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚<br><img src="/../images/GNN/GNBlocks Composition.png" alt="GNs"></p>
<h2 id="GNN-åˆ†ç±»"><a href="#GNN-åˆ†ç±»" class="headerlink" title="GNN åˆ†ç±»"></a>GNN åˆ†ç±»</h2><p>å…¶å®GNNçš„è¯ç”Ÿè¿‡ç¨‹éå¸¸çš„æ··ä¹±ï¼Œä¸åŒçš„äººæå‡ºçš„ä¸œè¥¿å„å¼å„æ ·ï¼Œè™½ç„¶è®ºæ–‡[2]ç»™äº†æ•´ä¸ªGNNä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ï¼Œä½†æ˜¯é‡Œé¢çš„ç»†èŠ‚å˜åŒ–å¯¼è‡´GNNæœ‰äº†å„ç§å„æ ·çš„ç±»åˆ«ï¼Œæ¸…åçš„survey[3]é‡Œç»™äº†æˆ‘ä»¬ä¸€ä¸ªè¯¦ç»†çš„åˆ†ç±»å¦‚ä¸‹å›¾ï¼š<br><img src="/../images/GNN/GNN_Category.png" alt="GN category"></p>
<p>åœ¨è¿™é‡Œæˆ‘åšäº†ä¸€ä¸ªæ›´åŠ ç®€å•ä¸€ç‚¹çš„åˆ†ç±»æ–¹å¼ï¼ŒæŠŠæ•´ä¸ªGNNåˆ†æˆä¸¤ç±»ï¼Œç¬¬ä¸€ç±»æ˜¯æŒ‰ç…§ç»“æ„æ¥è¯´ï¼š<br><img src="/../images/GNN/GN Blocks.png" alt="GN blocks"><br>ç¬¬ä¸€å¼ å›¾å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„GN Blockçš„æ›´æ–°è¿‡ç¨‹ï¼Œæ ¹æ®è¿™ä¸ªæ›´æ–°è¿‡ç¨‹åˆäº§ç”Ÿè®¸å¤šå˜åŒ–ï¼šæ¯”å¦‚æœ€å…¸å‹çš„MPNN(Message Passing Neural Network)[4]ï¼Œå®ƒæ˜¯åŸºäºRNNæå‡ºçš„æ€æƒ³ï¼ŒæŠŠEdgeçš„æ›´æ–°çœ‹ä½œä¸€ä¸ªéšå±‚ï¼Œè®­ç»ƒä¹‹åå‚ä¸èŠ‚ç‚¹çš„æ›´æ–°ã€‚</p>
<p>ç¬¬äºŒç±»æ˜¯æŒ‰ç…§æ›´æ–°å’Œèšåˆæ–¹æ³•æ¥è¯´ï¼š<br><img src="/../images/GNN/GNN_Category2.png" alt="GN category2"><br>è¿™å¼ å›¾è¿˜æ˜¯æ¸…åçš„surveyæ•´ç†çš„ï¼Œå°±ç”¨GCNæ‹¿å‡ºæ¥å½“ä¸ªä¾‹å­ï¼Œä¸€èˆ¬æ¥è¯´æ›´æ–°å‡½æ•°éƒ½é»˜è®¤æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œä½†æ˜¯å°±åƒå‰é¢æå‡ºçš„ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å®ç°æƒå€¼å…±äº«ï¼Œæ‰€ä»¥GCNå®šä¹‰äº†å…¨æ–°çš„å·ç§¯æ–¹å¼è§£å†³é‚»æ¥èŠ‚ç‚¹ä¸åŒæ—¶çš„æƒå€¼å…±äº«é—®é¢˜ï¼Œäºæ­¤åŒæ—¶å’ŒCNNä¸€æ ·ï¼Œä¸åŒçš„å·ç§¯æ ¸å¯ä»¥æå–ä¸åŒçš„ç‰¹å¾ï¼Œåˆ©ç”¨ä¸åŒå·ç§¯æ ¸çš„GCNæ›´æ–°ä¹Ÿå¯ä»¥æœ€ç»ˆè®¡ç®—å‡ºä¸€ä¸ªé«˜ç»´åº¦åŒ…å«ä¸åŒç‰¹å¾çš„featureã€‚</p>
<h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><p>pytorchï¼š<a href="https://github.com/rusty1s/pytorch_geometric" target="_blank" rel="noopener">geometric</a></p>
<p>tensor flow: <a href="https://github.com/deepmind/graph_nets" target="_blank" rel="noopener">graph_nets</a></p>
<h2 id="ç›¸å…³è®ºæ–‡"><a href="#ç›¸å…³è®ºæ–‡" class="headerlink" title="ç›¸å…³è®ºæ–‡"></a>ç›¸å…³è®ºæ–‡</h2><p>æ¸…åçš„ç»¼è¿°[3]è¿˜æ•´ç†äº†GNNçš„è®ºæ–‡åˆ—è¡¨ã€‚</p>
<p><a href="https://github.com/thunlp/GNNPapers" target="_blank" rel="noopener">è®ºæ–‡åˆ—è¡¨</a></p>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ol>
<li>æµ…å±‚ç»“æ„<br>GNNçš„æ”¶æ•› -&gt; $f$ æ˜¯ä¸€ä¸ªå‹ç¼©æ˜ å°„ -&gt; å±‚æ•°é«˜æ¢¯åº¦æ¶ˆå¤±</li>
<li>ç®—åŠ›</li>
</ol>
<h2 id="GNN-Visualization"><a href="#GNN-Visualization" class="headerlink" title="GNN Visualization"></a>GNN Visualization</h2><p>è®ºæ–‡ï¼šGraph-structured representations for visual question answering[7]<br><img src="/../images/GNN/QA.png" alt="Question Answering"></p>
<h2 id="GNN-for-Dynamic-Graph"><a href="#GNN-for-Dynamic-Graph" class="headerlink" title="GNN for Dynamic Graph"></a>GNN for Dynamic Graph</h2><p>è®ºæ–‡ä¸€ï¼šEvolveGCN[5]<br>å‰æï¼šæ‰€æœ‰çš„å›¾éƒ½æ˜¯éšç€æ—¶é—´<strong>åŠ¨æ€è¿ç»­</strong>å˜åŒ–çš„ã€‚<br>æ²¡æœ‰è€ƒè™‘ä½ç½®å…³ç³»ï¼Œåˆ©ç”¨RNNçš„æ€æƒ³åŠ å…¥éšå±‚è®°å½•å‰æ—¶åˆ»çš„ç‰¹å¾å€¼ã€‚<br>Application: Link prediction &amp; Edge classification<br><img src="/../images/GNN/EvolveGCN.png" alt="EvolveGCN"></p>
<p>è®ºæ–‡äºŒï¼šPredicting Citywide Crowd Flows in Irregular Regions Using Multi-View Graph Convolutional Networks[6]<br><strong>STG:</strong> spatio-temporal graph</p>
<ol>
<li>Convolutional networks over graphs</li>
<li>Spatial graph convolutional network<br>$$<br>w_{ij}=\begin{cases}<br>exp(-\frac{dis(ij)^2}{2\theta}) &amp;\text{if dis(ij)$\lt$ k}\\<br>0 &amp;\text{otherwise}<br>\end{cases}<br>$$</li>
</ol>
<p><img src="/../images/GNN/STG.png" alt="STG"></p>
<h2 id="Node-Importance-and-Influence"><a href="#Node-Importance-and-Influence" class="headerlink" title="Node Importance and Influence"></a>Node Importance and Influence</h2><p>è®ºæ–‡ï¼šDeepInf: Social Influence Prediction with Deep Learning[8]<br><img src="/../images/GNN/Node_imp.png" alt="Node Importance"></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1] <a href="https://doi.org/10.1109/tnn.2008.2005605" target="_blank" rel="noopener">Monfardini, G., Ah Chung Tsoi, Hagenbuchner, M., Scarselli, F., &amp; Gori, M. (2008). The Graph Neural Network Model. IEEE Transactions on Neural Networks, 20(1), 61â€“80.</a></p>
<p>[2] <a href="https://arxiv.org/abs/1806.01261" target="_blank" rel="noopener">Battaglia, P. W., Hamrick, J. B., Bapst, V., Sanchez-Gonzalez, A., Zambaldi, V., Malinowski, M., â€¦ Pascanu, R. (2018). Relational inductive biases, deep learning, and graph networks, 1â€“40.</a></p>
<p>[3] <a href="http://arxiv.org/abs/1812.08434" target="_blank" rel="noopener">Zhou, J., Cui, G., Zhang, Z., Yang, C., Liu, Z., &amp; Sun, M. (2018). Graph Neural Networks: A Review of Methods and Applications, 1â€“20.</a></p>
<p>[4] <a href="https://doi.org/10.1002/nme.2457" target="_blank" rel="noopener">Gilmer, J., Schoenholz, S. S., Riley, P. F., Vinyals, O., &amp; Dahl, G. E. (2017). Neural Message Passing for Quantum Chemistry.</a></p>
<p>[5] A. Pareja et al., â€œEvolveGCN : Evolving Graph Convolutional Networks for Dynamic Graphs,â€ 2018.</p>
<p>[6] J. Sun, J. Zhang, Q. Li, X. Yi, and Y. Zheng, â€œPredicting Citywide Crowd Flows in Irregular Regions Using Multi-View Graph Convolutional Networks,â€ vol. 14, no. 8, pp. 1â€“11, 2019.</p>
<p>[7] D. Teney, L. Liu, and A. Van Den Hengel, â€œGraph-structured representations for visual question answering,â€ in Proceedings - 30th IEEE Conference on Computer Vision and Pattern Recognition, CVPR 2017, 2017, vol. 2017â€“Janua, pp. 3233â€“3241.</p>
<p>[8] J. Qiu, J. Tang, H. Ma, Y. Dong, K. Wang, and J. Tang, â€œDeepInf: Social Influence Prediction with Deep Learning,â€ 2018.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/12/Online-Dynamic-Graph-Layout-pinning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/12/Online-Dynamic-Graph-Layout-pinning/" itemprop="url">
                  Online Dynamic Graph Layout: pinning
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-12 23:10:08" itemprop="dateCreated datePublished" datetime="2018-10-12T23:10:08+08:00">2018-10-12</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/08/Cholesky-factorization-and-Conjugate-Gradient/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/08/Cholesky-factorization-and-Conjugate-Gradient/" itemprop="url">
                  Cholesky factorization and Conjugate Gradient
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-08 00:48:12" itemprop="dateCreated datePublished" datetime="2018-10-08T00:48:12+08:00">2018-10-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-11-07 17:47:40" itemprop="dateModified" datetime="2018-11-07T17:47:40+08:00">2018-11-07</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/mathematique/" itemprop="url" rel="index"><span itemprop="name">mathematique</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/mathematique/linear-algebra/" itemprop="url" rel="index"><span itemprop="name">linear algebra</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Both two approaches are used to solve the linear equation:<br>$$<br>Ax=b<br>$$</p>
<h2 id="Cholesky-factorization"><a href="#Cholesky-factorization" class="headerlink" title="Cholesky factorization"></a>Cholesky factorization</h2><p>Preconditions:</p>
<ul>
<li>A hermitian matrix: $A^*=A$</li>
<li>A positive definitive: for any $X$, $(X^*)AX\gt 0$</li>
</ul>
<h3 id="Basic-idea"><a href="#Basic-idea" class="headerlink" title="Basic idea"></a>Basic idea</h3><p>Decompose $A$ into $A=LL^{*}$ with $L$ an lower triangular matrix, so the solution is changed to:<br>$$<br>\begin{cases}<br>L^*x=Y\\<br>LY=b<br>\end{cases}<br>$$</p>
<h3 id="LU-Decomposition"><a href="#LU-Decomposition" class="headerlink" title="LU Decomposition"></a>LU Decomposition</h3><p>First of all, there is <strong>no constraints</strong> to A, and the LU decomposition solution is proposed:</p>
<ul>
<li>L: lower triangular matrix whose diagonal is ones.</li>
<li>U: upper triangular matrix</li>
</ul>
<p>$$<br>L=\left [\begin{matrix}<br>1 &amp; 0 &amp; \cdots &amp; 0\\<br>l_{21} &amp; 1 &amp; \cdots &amp; 0\\<br>\vdots &amp; \vdots &amp; \ddots &amp;\vdots\\<br>l_{n1} &amp; l_{n2} &amp; \cdots &amp; 1<br>\end{matrix}\right ]\\<br>$$<br>$$<br>U=\left [\begin{matrix}<br>u_{11} &amp; u_{12} &amp; \cdots &amp; u_{1n}\\<br>0 &amp; u_{22} &amp; \cdots &amp; u_{2n}\\<br>\vdots &amp; \vdots &amp; \ddots &amp;\vdots\\<br>0 &amp; 0 &amp; \cdots &amp; u_{nn}<br>\end{matrix}\right ]<br>$$</p>
<p>$$<br>A=LU<br>$$<br>So<br>$$<br>a_{ij}=\sum_k^{\min{\left(i,j\right)}}l_{il}u_{kj}<br>$$<br>Suppose that $i\lt j$,<br>$$<br>\begin{aligned}<br>a_{ij}&amp;=\sum_k^{i-1}l_{ik}u_{kj}+u_{ij}\\<br>u_{ij}&amp;=a_{ij}-\sum_k^{i-1}l_{ik}u_{kj}\\<br>a_{ji}&amp;=\sum_k^{i-1}l_{jk}u_{ki}+l_{ji}u_{ii}\\<br>l_{ji}u_{ii}&amp;=a_{ji}-\sum_k^{i-1}l_{jk}u_{ki}<br>\end{aligned}<br>$$<br>The functions above is called <em>Doolittle Decomposition</em>, and the value of $L$ and $U$ can be calculated.</p>
<p>And the linear equation: $Ax=b$, can be changed into:<br>$$<br>\begin{cases}<br>Ux=Y\\<br>LY=b<br>\end{cases}<br>$$</p>
<h3 id="Gaussian-Elimination-pivot-de-gausse"><a href="#Gaussian-Elimination-pivot-de-gausse" class="headerlink" title="Gaussian Elimination(pivot de gausse)"></a>Gaussian Elimination(pivot de gausse)</h3><p>Here, Gaussian Elimination is an effective way to generate $L$ and $U$.</p>
<p>As we have a matrix $A$, we want to change it into an upper triangular matrix, firstly we eliminate the first column:</p>
<p>$a_{i1}\leftarrow a_{i1}-a_{11}\times \frac{a_{i1}}{a_{11}}=0$</p>
<p>This equals to:<br>$$<br>L=\left [\begin{matrix}<br>1 &amp; 0 &amp; \cdots &amp; 0\\<br>-\frac{a_{21}}{a_{11}} &amp; 1\\<br>\vdots &amp;  &amp; \ddots\\<br>-\frac{a_{n1}}{a_{11}} &amp;  &amp;  &amp; 1<br>\end{matrix}\right ]<br>$$<br>$$<br>A^{(1)}=LA^{(0)}<br>$$<br>Hence we define:<br>$$<br>L_i=\left [\begin{matrix}<br>1 &amp; 0 &amp; \cdots &amp; 0\\<br> &amp; 1\\<br> &amp;l_{i+1,i}\\<br> &amp;\vdots  &amp; \ddots\\<br> &amp;l_{n,i}  &amp;  &amp; 1<br>\end{matrix}\right ]<br>$$<br>With<br>$$<br>l_{i,j}=-\frac{a_{i,j}^{(j-1)}}{a_{j,j}^{(j-1)}}<br>$$<br>After $N-1$ steps,<br>$$<br>A^{(N-1)}=L_{N-1}â€¦L_1A^{(0)}<br>$$<br>$A^{(N-1)}$ is an upper diagonal matrix, whatâ€™s more:<br>$$<br>L=L_{N-1}â€¦L_1=\left [\begin{matrix}<br>1 &amp; 0 &amp; \cdots &amp; 0\\<br> l_{2,1}&amp; 1\\<br> &amp;l_{i+1,i}\\<br> \vdots&amp;\vdots  &amp; \ddots\\<br> l_{n,1}&amp;l_{n,i}  &amp; \cdots &amp; 1<br>\end{matrix}\right ]<br>$$</p>
<h3 id="LDLT-Decomposition"><a href="#LDLT-Decomposition" class="headerlink" title="LDLT Decomposition"></a>LDLT Decomposition</h3><p>In this case, $A$ is an symetric matrix: $A^T=A$</p>
<p>We introduce a matrix $D$: $D=Diag(U)$, so<br>$$<br>U=D\tilde{U}<br>$$<br>$$<br>\tilde{U}=<br>\left [\begin{matrix}<br>1 &amp; \frac{u_{12}}{u_{11}} &amp; \cdots &amp; \frac{u_{1n}}{u_{11}}\\<br>0 &amp; 1 &amp; \cdots &amp; \frac{u_{2n}}{u_{22}}\\<br>\vdots &amp; \vdots &amp; \ddots &amp;\vdots\\<br>0 &amp; 0 &amp; \cdots &amp; 1<br>\end{matrix}\right ]<br>$$<br>So $A=LD\tilde{U}$, as $A^T=A$<br>$$<br>\begin{aligned}<br>LD\tilde{U}&amp;=(LD\tilde{U})^T\\<br>LD\tilde{U}&amp;=\tilde{U}DL^T<br>\end{aligned}<br>$$</p>
<p>So one of the solutions is: $\tilde{U}^T=L$</p>
<p>As shown in <em>Doolittle Decomposition</em>,<br>$$l_{ji}u_{ii}=a_{ji}-\sum_k^{i-1}l_{jk}u_{ki}$$<br>So if $u_{ii}\neq 0$, $L$ and $U$ have only one solution: $\tilde{U}^T=L$.<br>$$<br>A=LDL^T<br>$$</p>
<blockquote>
<p><strong>Proposition</strong>:<br>If the Order Principal Minor Determinant of A is zero =&gt; LU decomposition has only one solution</p>
</blockquote>
<p><strong>Demonstration</strong></p>
<p>In the previous introduction of gaussian elimination, an essential condition to ensure the existence and 1-existence is that each $a_{ii}\neq 0$.</p>
<p>If one determinant of one minor matrix is zero =&gt; at least two columns are linearly dependent. After doing gaussian elimination, one of the two columns $i$ is totally zero, so $a_{ii}=0$</p>
<h3 id="Cholesky"><a href="#Cholesky" class="headerlink" title="Cholesky"></a>Cholesky</h3><h4 id="In-Real-Number-Field"><a href="#In-Real-Number-Field" class="headerlink" title="In Real Number Field"></a>In Real Number Field</h4><p>In real number field, the hermitian matrix is equal to symetric matrix.</p>
<p><strong>Demonstration of D is positive:</strong></p>
<p>$L$â€™s diagonal is ones and $L$ is a triangle matrix =&gt; $L$ is reversable</p>
<p>$A$ is positive definitive =&gt; $L^{-1}A{L^{-1}}^T\gt 0$ =&gt; $D&gt;0$</p>
<p>Hence we can decompose D into: $\tilde{D}$ with $\tilde{d_{i,i}}=\sqrt{d_{ii}}$<br>$$<br>D=\tilde{D}\tilde{D}=\tilde{D}\tilde{D}^T<br>$$<br>Hence<br>$$<br>A=L\tilde{D}\tilde{D}^TL=(L\tilde{D})(L\tilde{D})^T<br>$$</p>
<h4 id="Construction"><a href="#Construction" class="headerlink" title="Construction"></a>Construction</h4><p>//TODO</p>
<h2 id="Conjugate-Gradient"><a href="#Conjugate-Gradient" class="headerlink" title="Conjugate Gradient"></a>Conjugate Gradient</h2><p>Precondition:</p>
<ul>
<li>$A$ symetric positive definitive</li>
</ul>
<h3 id="Basic-idea-1"><a href="#Basic-idea-1" class="headerlink" title="Basic idea"></a>Basic idea</h3><p>Given a set of independent vectors $r_0, r_1, â€¦, r_{n-1}$, so we want to construct another vectors $p_0, p_1, â€¦, p_{n-1}$, which fits:<br>$$\langle p_i,p_j\rangle=0$$<br>So x can be represented as: $x=\sum_{i=0}^{n-1}\alpha_ip_i$</p>
<h3 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h3><ol>
<li>Define inner product $\langle.,.\rangle$ as:<br>$$\langle x,y\rangle=x^TAy$$</li>
<li>Translate $\alpha_i$:<br>$$<br>\alpha_i=\frac{\langle x,p_i\rangle}{\langle p_i,p_i\rangle}<br>=\frac{x^TAp_i}{pi^TAp_i}<br>=\frac{b^Tp_i}{p_i^TAp_i}<br>$$</li>
<li>Define $r_i$:<br>$$r_i=b-Ax_i,\;x_i=\sum_{k\lt i}\alpha_kp_k$$</li>
<li>Find conjugate vectors $p_0,â€¦,p_{n-1}$:<br>given $r_i$, let<br>$$p_i=r_i-\sum_{k\lt i}\beta_kp_k$$<br>and $\beta_k=\frac{\langle r_i,p_k\rangle}{\langle p_k,p_k\rangle}$</li>
</ol>
<h3 id="Simplification"><a href="#Simplification" class="headerlink" title="Simplification"></a>Simplification</h3><h4 id="Simplify-r-i"><a href="#Simplify-r-i" class="headerlink" title="Simplify $r_i$"></a>Simplify $r_i$</h4><p>$$<br>\begin{aligned}<br>r_{i+1}&amp;=b-Ax_{i+1}\\<br>&amp;=b-A(x_i+\alpha_ip_i)\\<br>&amp;=r_i-A\alpha_ip_i<br>\end{aligned}<br>$$</p>
<h4 id="Simplify-beta-k"><a href="#Simplify-beta-k" class="headerlink" title="Simplify $\beta_k$"></a>Simplify $\beta_k$</h4><p>$$<br>\beta_k=\frac{\langle r_i,p_k\rangle}{\langle p_k,p_k\rangle}<br>=\frac{r_i^TAp_k}{p_k^TAp_k}<br>\;\;\;\;\text{$k\lt i$}<br>$$<br>$$<br>p_k^Tr_i=p_k^T(b-Ax_i)=0\;\;\;\;\forall k\lt i<br>$$<br>$$<br>\begin{aligned}<br>p_k^TAr_i&amp;=\frac{1}{\alpha_k}(r_k-r_{k+1})^Tr_i\\<br>&amp;=<br>\begin{cases}<br>0&amp;\text{$k\lt i-1$}\\<br>\frac{1}{-\alpha_{i-1}}r_i^Tr_i&amp;\text{$k=i-1$}<br>\end{cases}<br>\end{aligned}<br>$$<br>We can use the same approach to calculate $p_k^TAp_k$</p>
<h4 id="Simplify-alpha-i"><a href="#Simplify-alpha-i" class="headerlink" title="Simplify $\alpha_i$"></a>Simplify $\alpha_i$</h4><p>$$<br>\alpha_i<br>=\frac{b^Tp_i}{p_i^TAp_i}=\frac{(r_i+Ax_i)^Tp_i}{p_i^TAp_i}=\frac{r_i^Tp_i}{p_i^TAp_i}=\frac{r_i^Tr_i}{p_i^TAp_i}<br>$$</p>
<h3 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h3><blockquote>
<p>Conjugate Gradient</p>
<p><strong>Input</strong>: Given right matrix $b$, positive symetric matrix A and initial iterative value $x_0\in R^n$(usually considered as $0^n$)</p>
<p><strong>Output</strong>: solution $x$</p>
<p><strong>States</strong><br>$r_0=b-Ax_0$<br>$p_0=r_0$</p>
<p><strong>repeat</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;$\alpha_k:=\frac{r_k^Tr_k}{p_k^TAP_k}$<br>&nbsp;&nbsp;&nbsp;&nbsp;$x_{k+1}:=x_k+\alpha_kp_k$<br>&nbsp;&nbsp;&nbsp;&nbsp;$r_{k+1}:=r_k-\alpha_kAp_k$<br>&nbsp;&nbsp;&nbsp;&nbsp; <strong>if</strong> $r_{k+1}\lt \epsilon$&nbsp;&nbsp;<strong>then</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>return</strong> $x_{k+1}$<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>end</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;$\beta_k:=\frac{r_{k+1}^Tr_{k+1}}{r_k^Tr_k}$<br>&nbsp;&nbsp;&nbsp;&nbsp;$p_{k+1}:=r_{k+1}+\beta_kp_k$<br><strong>until</strong> convergence<br><strong>return</strong> $x_{k+1}$</p>
</blockquote>
<h3 id="Demonstration-Schmidt-orthogonalization"><a href="#Demonstration-Schmidt-orthogonalization" class="headerlink" title="Demonstration (Schmidt orthogonalization)"></a>Demonstration (Schmidt orthogonalization)</h3><p>Schmidt orthogonalization is a method to achieve a set of orthogonalized vectors from a set of linearly independent vectors.</p>
<p>Here, as mentioned before:<br>$$p_i=r_i-\sum_{k\lt i}\alpha_kp_k$$<br>we use Mathematical Induction to demonstrate it:</p>
<ol>
<li>for $p_0,p_1$ $\langle p_0,p_1\rangle=0$</li>
<li>in case $p_j,\forall i\lt j$:<br>$$<br>\begin{aligned}<br>\langle p_i,p_j\rangle&amp;=\langle p_i,r_j-\sum_{k\lt j}\alpha_kp_k\rangle\\<br>&amp;=\langle p_i,r_j\rangle-\langle p_i,\sum_{k\lt j}\alpha_kp_k\rangle\\<br>&amp;=\langle p_i,r_j\rangle-\langle p_i,\alpha_ip_i\rangle\\<br>&amp;=\langle p_i,r_j\rangle-\frac{\langle p_i,r_j\rangle}{\langle p_i,p_i\rangle}\langle p_i,p_i\rangle\\<br>&amp;=0<br>\end{aligned}<br>$$</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Nina" />
            
              <p class="site-author-name" itemprop="name">Nina</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nina</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Pisces</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    
  


  
  

  

  

  

  

  

</body>
</html>
