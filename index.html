<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="English">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Nina&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Nina&#39;s Blog">
<meta property="og:locale" content="English">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nina&#39;s Blog">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Nina's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="English">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Nina's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Good Good Study, Day Day Up</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/golangå­¦ä¹ ç¬”è®°å…«ï¼šerror-panic-å’Œ-recover/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/golangå­¦ä¹ ç¬”è®°å…«ï¼šerror-panic-å’Œ-recover/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°å…«ï¼šerror panic å’Œ recover
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-03-03 22:41:20 / Modified: 22:42:27" itemprop="dateCreated datePublished" datetime="2020-03-03T22:41:20+08:00">2020-03-03</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="error"><a href="#error" class="headerlink" title="error"></a>error</h2><p>errorçš„åŸºç¡€æ¥å£ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</span><br><span class="line">    Error() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ä¹Ÿå°±å¯ä»¥å¥—ä¸€ä¸ªå¤æ‚ä¸€ç‚¹çš„å£³å­ï¼Œæ¯”å¦‚os.PathError</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PathError records an error and the operation and</span></span><br><span class="line"><span class="comment">// file path that caused it.</span></span><br><span class="line"><span class="keyword">type</span> PathError <span class="keyword">struct</span> &#123;</span><br><span class="line">    Op <span class="keyword">string</span>    <span class="comment">// "open", "unlink", etc.</span></span><br><span class="line">    Path <span class="keyword">string</span>  <span class="comment">// The associated file.</span></span><br><span class="line">    Err error    <span class="comment">// Returned by the system call.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *PathError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> e.Op + <span class="string">" "</span> + e.Path + <span class="string">": "</span> + e.Err.Error()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>PathError</code>â€˜s <code>Error</code> generates a string like this:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open /etc/passwx: no such file or directory</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ€è·¯å°±å¾ˆç®€å•ï¼Œå¦‚æœæ•æ‰åˆ°æœ‰errorï¼Œå°±å¯ä»¥æ‰§è¡Œä¸€äº›æ¯”å¦‚å›æ»šä¹‹ç±»çš„ä»£ç æ¥æ¢å¤æˆ–è€…é‡æ–°æ‰§è¡Œã€‚</p>
<h2 id="panic"><a href="#panic" class="headerlink" title="panic"></a>panic</h2><p>å½“ç„¶ä¹Ÿæœ‰ä¸€äº›é”™æ˜¯å¸Œæœ›ç›´æ¥æŠ›å‡ºå¹¶ä¸”åœæ­¢æ‰§è¡Œçš„ï¼ˆæ€ä¹ˆé‚£ä¹ˆåƒthrowï¼‰</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A toy implementation of cube root using Newton's method.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CubeRoot</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">    z := x/<span class="number">3</span>   <span class="comment">// Arbitrary initial value</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1e6</span>; i++ &#123;</span><br><span class="line">        prevz := z</span><br><span class="line">        z -= (z*z*z-x) / (<span class="number">3</span>*z*z)</span><br><span class="line">        <span class="keyword">if</span> veryClose(z, prevz) &#123;</span><br><span class="line">            <span class="keyword">return</span> z</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// A million iterations has not converged; something is wrong.</span></span><br><span class="line">    <span class="built_in">panic</span>(fmt.Sprintf(<span class="string">"CubeRoot(%g) did not converge"</span>, x))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶panicä¹Ÿåƒthrowä¸€æ ·æ˜¯ä¸è¢«æå€¡çš„ï¼Œæ¯”èµ·æŠ›å‡ºå¹¶ä¸”åœæ­¢ç¨‹åºå€’ä¸å¦‚å¥½å¥½èµ°å®Œï¼ˆä¸ç„¶ä¹Ÿä¸çŸ¥é“ä¼šå‡ºä»€ä¹ˆé—®é¢˜ï¼‰ã€‚</p>
<h2 id="recover"><a href="#recover" class="headerlink" title="recover"></a>recover</h2><p><strong>å½“å‡½æ•°å‘ç”Ÿ panic æ—¶ï¼Œå®ƒä¼šç»ˆæ­¢è¿è¡Œï¼Œåœ¨æ‰§è¡Œå®Œæ‰€æœ‰çš„å»¶è¿Ÿå‡½æ•°åï¼Œç¨‹åºæ§åˆ¶è¿”å›åˆ°è¯¥å‡½æ•°çš„è°ƒç”¨æ–¹ã€‚è¿™æ ·çš„è¿‡ç¨‹ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œç›´åˆ°å½“å‰åç¨‹çš„æ‰€æœ‰å‡½æ•°éƒ½è¿”å›é€€å‡ºï¼Œç„¶åç¨‹åºä¼šæ‰“å°å‡º panic ä¿¡æ¯ï¼Œæ¥ç€æ‰“å°å‡ºå †æ ˆè·Ÿè¸ªï¼Œæœ€åç¨‹åºç»ˆæ­¢</strong>ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fullName</span><span class="params">(firstName *<span class="keyword">string</span>, lastName *<span class="keyword">string</span>)</span></span> &#123;  </span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">"deferred call in fullName"</span>)</span><br><span class="line">    <span class="keyword">if</span> firstName == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"runtime error: first name cannot be nil"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> lastName == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"runtime error: last name cannot be nil"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">"%s %s\n"</span>, *firstName, *lastName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;  </span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">"deferred call in main"</span>)</span><br><span class="line">    firstName := <span class="string">"Elon"</span></span><br><span class="line">    fullName(&amp;firstName, <span class="literal">nil</span>)</span><br><span class="line">    fmt.Println(<span class="string">"returned normally from main"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸¤ä¸ªå‡½æ•°é‡Œé¢çš„deferå°±æ˜¯<strong>å»¶è¿Ÿå‡½æ•°</strong>ï¼Œæ‰€ä»¥é‡åˆ°panicä¹‹åçš„è¾“å‡ºä¼šå˜æˆï¼šâ€defer call in fullNameâ€ -&gt; â€œdeferred call in mainâ€-&gt;â€runtime errorâ€ï¼Œåˆ©ç”¨å…ˆæ‰§è¡Œå»¶è¿Ÿå‡½æ•°çš„ç‰¹å¾ï¼Œrecoverå‡ºç°äº†ã€‚åœ¨å»¶è¿Ÿå‡½æ•°å†…è°ƒç”¨ <code>recover</code>ï¼Œå¯ä»¥å–åˆ° <code>panic</code> çš„é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä¸”åœæ­¢ panic ç»­å‘äº‹ä»¶ï¼ˆPanicking Sequenceï¼‰ï¼Œç¨‹åºè¿è¡Œæ¢å¤æ­£å¸¸ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">recoverName</span><span class="params">()</span></span> &#123;  </span><br><span class="line">    <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r!= <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"recovered from "</span>, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fullName</span><span class="params">(firstName *<span class="keyword">string</span>, lastName *<span class="keyword">string</span>)</span></span> &#123;  </span><br><span class="line">    <span class="keyword">defer</span> recoverName()</span><br><span class="line">    <span class="keyword">if</span> firstName == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"runtime error: first name cannot be nil"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> lastName == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"runtime error: last name cannot be nil"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">"%s %s\n"</span>, *firstName, *lastName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;  </span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">"deferred call in main"</span>)</span><br><span class="line">    firstName := <span class="string">"Elon"</span></span><br><span class="line">    fullName(&amp;firstName, <span class="literal">nil</span>)</span><br><span class="line">    fmt.Println(<span class="string">"returned normally from main"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ç¨‹åºçš„è¾“å‡ºæµç¨‹å°±ä¼šå˜æˆï¼šâ€recovered fromâ€ -&gt; â€œreturned normally from mainâ€ -&gt; â€œdeferred call in mainâ€</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/golangå­¦ä¹ ç¬”è®°ä¸ƒï¼šinterface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/golangå­¦ä¹ ç¬”è®°ä¸ƒï¼šinterface/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°ä¸ƒï¼šinterface
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-03-03 22:40:03 / Modified: 22:40:30" itemprop="dateCreated datePublished" datetime="2020-03-03T22:40:03+08:00">2020-03-03</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ¥å£çš„åŸºæœ¬ä»‹ç»å’Œä½¿ç”¨åœ¨è¿™é‡Œå°±ä¸å†™äº†ï¼Œä½œä¸º go æœ€é‡è¦çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œå¤šæ€ç­‰éƒ½æ˜¯é€šè¿‡å®ƒæ¥å®ç°çš„ã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="æ¥å£åµŒå¥—"><a href="#æ¥å£åµŒå¥—" class="headerlink" title="æ¥å£åµŒå¥—"></a>æ¥å£åµŒå¥—</h3><p>æƒ³è¦ä½¿ç”¨è¯¥å­æ¥å£çš„è¯ï¼Œå¿…é¡»å°†çˆ¶æ¥å£å’Œå­æ¥å£çš„æ‰€æœ‰æ–¹æ³•éƒ½å®ç°ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> stringer <span class="keyword">interface</span>&#123; </span><br><span class="line">   <span class="keyword">string</span>()<span class="keyword">string</span></span><br><span class="line">&#125; </span><br><span class="line">  </span><br><span class="line"><span class="keyword">type</span> tester <span class="keyword">interface</span>&#123; </span><br><span class="line">   stringer               <span class="comment">// åµŒå…¥å…¶ä»–æ¥å£ </span></span><br><span class="line">   test() </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ’å¥é¢˜å¤–è¯ï¼Œå¦‚æœstructureæƒ³è¦åƒinterfaceä¸€æ ·è¿›è¡ŒåµŒå¥—çš„è¯éœ€è¦è¿›è¡Œåˆå§‹åŒ–ã€‚åˆå§‹åŒ–æ–¹å¼ä»æ—§æ˜¯è‡ªå·±åˆå§‹åŒ–andä¾èµ–æ³¨å…¥ä¸¤ç§ã€‚</p>
<h3 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Sequence []<span class="keyword">int</span></span><br><span class="line"><span class="comment">// Method for printing - sorts the elements before printing.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Sequence)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    s = s.Copy() <span class="comment">// Make a copy; don't overwrite argument.</span></span><br><span class="line">    sort.Sort(s)</span><br><span class="line">    str := <span class="string">"["</span></span><br><span class="line">    <span class="keyword">for</span> i, elem := <span class="keyword">range</span> s &#123; <span class="comment">// Loop is O(NÂ²); will fix that in next example.</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span> &#123;</span><br><span class="line">            str += <span class="string">" "</span></span><br><span class="line">        &#125;</span><br><span class="line">        str += fmt.Sprint(elem)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str + <span class="string">"]"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶æˆ‘æ²¡ææ‡‚ä¸ºä»€ä¹ˆæ˜¯ $O(N^2)$ï¼Œä½†æ˜¯loopæµªè´¹æ—¶é—´æ˜¯çœŸçš„ï¼Œè€Œåˆ©ç”¨ç±»å‹è½¬æ¢å°±å¯ä»¥ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Sequence)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    s = s.Copy()</span><br><span class="line">    sort.Sort(s)</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprint([]<span class="keyword">int</span>(s))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>value.(type) ç®—æ˜¯interfaceç±»å‹åˆ¤æ–­å’Œè½¬æ¢çš„æ–¹æ³•ï¼Œåˆ©ç”¨switchå¯ä»¥è¿›è¡Œç±»å‹åˆ¤æ–­</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Stringer <span class="keyword">interface</span> &#123;</span><br><span class="line">    String() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> value <span class="keyword">interface</span>&#123;&#125; <span class="comment">// Value provided by caller.</span></span><br><span class="line"><span class="keyword">switch</span> str := value.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line"><span class="keyword">case</span> Stringer:</span><br><span class="line">    <span class="keyword">return</span> str.String()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç±»å‹è½¬æ¢åˆ™æ˜¯åœ¨typeé‡Œè¾“å…¥æƒ³è½¬æ¢çš„å€¼ï¼Œå¤±è´¥æ—¶åœ¨ä¸Šé¢çš„æƒ…å†µä¸‹ä¼šæŠ›å‡ºpanicï¼Œæ‰€ä»¥ä¹Ÿæä¾›äº†ç¬¬äºŒä¸ªæ–­è¨€å€¼æ¥åˆ¤æ–­è½¬æ¢æ˜¯å¦æˆåŠŸï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">str, ok := value.(<span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">if</span> ok &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"string value is: %q\n"</span>, str)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"value is not a string\n"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ¥å£ç»§æ‰¿"><a href="#æ¥å£ç»§æ‰¿" class="headerlink" title="æ¥å£ç»§æ‰¿"></a>æ¥å£ç»§æ‰¿</h3><p>OOçš„è¯´æ³•æ‘†åœ¨è¿™é‡Œæœ‰ç‚¹å¥‡æ€ªã€‚ã€‚ã€‚æ‰€æœ‰çš„structåªè¦å®ç°äº†interfaceé‡Œå®šä¹‰çš„æ–¹æ³•ï¼Œå°±å¯ä»¥è¢«è®¤ä¸ºæ˜¯è¿™ä¸ªinterfaceçš„ç»§æ‰¿ï¼Œè¿™ä¹Ÿæ˜¯GOè¯­è¨€å®ç°å¤šæ€çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>å¦‚æœä¸€ä¸ªç±»å‹åªæ˜¯ç”¨æ¥å®ç°æ¥å£ï¼Œå¹¶ä¸”é™¤äº†è¯¥æ¥å£ä»¥å¤–æ²¡æœ‰å…¶å®ƒè¢«å¯¼å‡ºçš„æ–¹æ³•ï¼Œé‚£å°±ä¸éœ€è¦å¯¼å‡ºè¿™ä¸ªç±»å‹ã€‚åªå¯¼å‡ºæ¥å£ï¼Œæ¸…æ¥šåœ°è¡¨æ˜äº†å…¶é‡è¦çš„æ˜¯è¡Œä¸ºï¼Œè€Œä¸æ˜¯å®ç°ï¼Œå¹¶ä¸”å…¶å®ƒå…·æœ‰ä¸åŒå±æ€§çš„å®ç°å¯ä»¥åæ˜ åŸå§‹ç±»å‹çš„è¡Œä¸ºã€‚è¿™ä¹Ÿé¿å…äº†å¯¹æ¯ä¸ªå…¬å…±æ–¹æ³•å®ä¾‹è¿›è¡Œé‡å¤çš„æ–‡æ¡£ä»‹ç»ã€‚</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Block <span class="keyword">interface</span> &#123;</span><br><span class="line">    BlockSize() <span class="keyword">int</span></span><br><span class="line">    Encrypt(src, dst []<span class="keyword">byte</span>)</span><br><span class="line">    Decrypt(src, dst []<span class="keyword">byte</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Stream <span class="keyword">interface</span> &#123;</span><br><span class="line">    XORKeyStream(dst, src []<span class="keyword">byte</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewCTR returns a Stream that encrypts/decrypts using the given Block in</span></span><br><span class="line"><span class="comment">// counter mode. The length of iv must be the same as the Block's block size.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCTR</span><span class="params">(block Block, iv []<span class="keyword">byte</span>)</span> <span class="title">Stream</span></span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„åŠ è§£å¯†çš„ä¾‹å­é‡Œï¼Œæ— è®ºæˆ‘ä»¬ä¼ å…¥çš„æ˜¯å“ªç§åŠ å¯†ç®—æ³•éƒ½æ— æ‰€è°“ï¼Œåªè¦å®ç°æ–¹æ³•æ˜¯åªæœ‰interfaceå†…çš„ï¼Œå°±å¯ä»¥åˆ©ç”¨NewCTRç”Ÿæˆå¯¹åº”çš„streamã€‚</p>
<p>åˆ©ç”¨æ¥å£å®ç°å¤šæ€ï¼Œè€Œå®ç°OOçš„ç»§æ‰¿éœ€è¦ä½¿ç”¨åˆ°åå°„ï¼ˆæ˜å¤©å†è¯´ï¼‰ã€‚</p>
<h2 id="æ¥å£è¯¦è§£"><a href="#æ¥å£è¯¦è§£" class="headerlink" title="æ¥å£è¯¦è§£"></a>æ¥å£è¯¦è§£</h2><p>å¯ä»¥å…ˆå›å¿†ä¸€ä¸‹OOç¼–ç¨‹ä¸­çš„ is-a å’Œ has-aã€‚</p>
<p>is-aå°±æ˜¯ç»§æ‰¿ï¼Œç®€å•æ¥è¯´å°±å’Œå‰é¢çš„æ¥å£ç»§æ‰¿ä¸€æ ·ï¼Œæœ‰ä¸€ä¸ªåŸºç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºéå¸¸å¤šç§å­ç±»æ¥ã€‚å†ç®€å•ä¸€ç‚¹è§£é‡Šå°±æ˜¯åŸºç±»é¸Ÿï¼šæœ‰ç¿…è†€ï¼Œæœ‰è„šï¼Œä¼šé£ï¼Œåƒè™«å­ã€‚é‚£ä¹ˆæˆ‘åˆ›å»ºçš„æ‰€æœ‰é¸Ÿéƒ½å¿…é¡»æœ‰ç¿…è†€ï¼Œæœ‰è„šï¼Œä¼šé£ï¼Œåƒè™«å­ã€‚</p>
<p>ç»§æ‰¿æ˜¯å¼ºè€¦åˆçš„ï¼Œå¦‚æœå“ªå¤©å®šä¹‰å˜äº†ï¼Œæˆ‘ä»¬è®¤ä¸ºé¸Ÿä¸åƒè™«å­æ”¹åƒé±¼äº†ï¼ˆå½“ç„¶å®é™…ä¸Šé¸Ÿä¸¤ä¸ªéƒ½åƒå¿˜è®°è¿™ä¸ªå¤±è´¥çš„æ¯”æ–¹ï¼‰ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å­ç±»é¸Ÿéƒ½å¿…é¡»åƒé±¼ã€‚</p>
<p>has-aå°±æ˜¯ç»„åˆï¼Œæˆ‘ä»¬æœ‰ç¿…è†€ï¼Œè„šï¼Œå¿ƒè„ï¼Œè¡€æ¶²ç­‰ç­‰ç±»ï¼Œé¸Ÿå°±æ˜¯ç”±è¿™äº›ç±»ç»„åˆå‡ºæ¥çš„ï¼Œhas-aæ˜¯ä½è€¦åˆå…³ç³»ï¼Œå“ªå¤©è¡€æ¶²ç±»å‘ç”Ÿäº†æ”¹å˜ï¼Œè¡€çš„é¢œè‰²ä¸æ˜¯çº¢çš„å˜æˆç»¿çš„äº†ï¼Œå¯¹é¸Ÿè¿™ä¸ªç±»æœ¬èº«æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚</p>
<h3 id="duck-typing"><a href="#duck-typing" class="headerlink" title="duck typing"></a>duck typing</h3><p>é‚£ä¹ˆæˆ‘ä»¬å›åˆ° <strong>GO</strong> è¯­è¨€ï¼Œç°åœ¨å…ˆä¸è®²has-aï¼Œè€Œæ˜¯is-açš„é—®é¢˜ï¼Œä¼ ç»ŸOOç¼–ç¨‹çš„is-aæ˜¯ç”±åŸºç±»äº§ç”Ÿæ´¾ç”Ÿç±»ï¼Œæ´¾ç”Ÿç±»ç›´æ¥ç»§æ‰¿åŸºç±»çš„æ‰€æœ‰å…ƒç´ ï¼Œå¯ä»¥åœ¨åŸºç±»çš„åŸºç¡€ä¸Šæ”¹è¿›orè¦†ç›–ï¼ˆè¯´çš„å°±æ˜¯è™šå‡½æ•°è¿™ç§é¢è¯•å®˜çš„æœ€çˆ±ï¼‰ã€‚GOè¯­è¨€çš„ç»§æ‰¿å’Œå¤šæ€çš„æ¦‚å¿µå’Œå‰é¢å°±æœ‰ç‚¹å¾®å¦™çš„ä¸å¤ªä¸€æ ·ï¼Œåœ¨ GO è¯­è¨€ä¸­å½“å®šä¹‰äº†ä¸€ä¸ªé¸Ÿç±»æ¥å£åï¼Œæˆ‘ä»¬è®¤ä¸ºï¼Œæ‰€æœ‰æœ‰ç¿…è†€ï¼Œæœ‰è„šï¼Œä¼šé£åƒè™«å­çš„ï¼Œéƒ½æ˜¯é¸Ÿã€‚</p>
<p>è¿™ä¸ªis-aå°±å˜å¾—ä¸å†æ˜¯ä¸¥æ ¼çš„å±äºå…³ç³»ï¼Œè€Œæ˜¯é€šè¿‡ç‰¹å¾æ¥åˆ¤å®šä¸€ä¸ªä¸œè¥¿çš„å½’å±æƒ…å†µï¼Œè¿™ç§æƒ³æ³•æˆ‘ä»¬å«å®ƒ <strong>duck typing</strong></p>
<blockquote>
<p>é¸­å­ç±»å‹ï¼ˆè‹±è¯­ï¼šduck typingï¼‰æ˜¯åŠ¨æ€ç±»å‹çš„ä¸€ç§é£æ ¼ã€‚åœ¨è¿™ç§é£æ ¼ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡æœ‰æ•ˆçš„è¯­ä¹‰ï¼Œä¸æ˜¯ç”±ç»§æ‰¿è‡ªç‰¹å®šçš„ç±»æˆ–å®ç°ç‰¹å®šçš„æ¥å£ï¼Œè€Œæ˜¯ç”±â€å½“å‰æ–¹æ³•å’Œå±æ€§çš„é›†åˆâ€å†³å®šã€‚</p>
</blockquote>
<p>duck typing åœ¨C++ä¸­çš„å®ç°æˆ‘å·²ç»ä¸ç†Ÿæ‚‰äº†ï¼Œåœ¨GOè¯­è¨€ä¸­å½“ç„¶å°±æ˜¯é€šè¿‡æ¥å£+æ–¹æ³•çš„æ–¹å¼æ¥å®ç°ï¼Œå€’ä¸å¦‚è¯´GOè¯­è¨€æœ¬èº«å·²ç»æ²¡æœ‰ç»§æ‰¿è¿™ç§å¼ºè€¦åˆçš„å…³ç³»å½¢å¼äº†ã€‚</p>
<p>ä¸€ä¸ªæŠ„æ¥çš„ duck typing çš„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Reader <span class="keyword">interface</span> &#123;</span><br><span class="line">   Read(p []<span class="keyword">byte</span>) (n <span class="keyword">int</span>, err error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</span><br><span class="line">   Write(p []<span class="keyword">byte</span>) (n <span class="keyword">int</span>, err error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Closer <span class="keyword">interface</span> &#123;</span><br><span class="line">   Close() error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Seeker <span class="keyword">interface</span> &#123;</span><br><span class="line">   Seek(offset <span class="keyword">int64</span>, whence <span class="keyword">int</span>) (<span class="keyword">int64</span>, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> File <span class="keyword">struct</span> &#123; <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Read</span><span class="params">(buf []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(f *File)</span> <span class="title">Write</span><span class="params">(buf []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(f *File)</span> <span class="title">Seek</span><span class="params">(off <span class="keyword">int64</span>, whence <span class="keyword">int</span>)</span> <span class="params">(pos <span class="keyword">int64</span>, err error)</span> </span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(f *File)</span> <span class="title">Close</span><span class="params">()</span> <span class="title">error</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">var</span> <span class="title">file1</span> <span class="title">Reader</span> = <span class="title">new</span><span class="params">(File)</span></span></span><br><span class="line"><span class="function"><span class="title">var</span> <span class="title">file2</span> <span class="title">Writer</span> = <span class="title">new</span><span class="params">(File)</span></span></span><br><span class="line"><span class="function"><span class="title">var</span> <span class="title">file3</span> <span class="title">Closer</span> = <span class="title">new</span><span class="params">(File)</span></span></span><br><span class="line"><span class="function"><span class="title">var</span> <span class="title">file4</span> <span class="title">Seeker</span> = <span class="title">new</span><span class="params">(File)</span></span></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºåœ¨Fileå®ç°äº†4ä¸ªæ¥å£ï¼Œå› æ­¤å¯ä»¥å°†Fileå¯¹è±¡èµ‹å€¼ç»™ä»»ä½•ä¸€ä¸ªæ¥å£ã€‚</p>
<h3 id="æ¥å£å€¼æ¥æ”¶-Receiver"><a href="#æ¥å£å€¼æ¥æ”¶-Receiver" class="headerlink" title="æ¥å£å€¼æ¥æ”¶(Receiver)"></a>æ¥å£å€¼æ¥æ”¶(Receiver)</h3><blockquote>
<p>ä¸€ä¸ªç±»å‹å¯ä»¥å®ç°ä»»æ„æ•°é‡çš„æ¥å£ï¼Œæ¯ä¸ªç±»å‹éƒ½å®ç°äº†ä¸€ä¸ªç©ºæ¥å£interface{}ã€‚<br>æ¥å£æ˜¯ä¸€ç³»åˆ—æ¥å£çš„é›†åˆï¼Œæ˜¯ä¸€ç§æŠ½è±¡æ•°æ®ç±»å‹ï¼Œæ¥å£å˜é‡å¯ä»¥å¼•ç”¨ä»»ä½•å®ç°äº†æ¥å£çš„å…¨éƒ¨æ–¹æ³•çš„å…·ä½“æ•°æ®ç±»å‹çš„å€¼ã€‚</p>
<p>æ¥å£å˜é‡å­˜å‚¨äº†ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯åˆ†é…ç»™æ¥å£å˜é‡çš„å…·ä½“å€¼ï¼ˆæ¥å£å®ç°è€…çš„å€¼ï¼‰ï¼Œä¸€ä¸ªæ˜¯å€¼çš„ç±»å‹çš„æè¿°å™¨ï¼ˆæ¥å£å®ç°è€…çš„ç±»å‹ï¼‰ï¼Œå½¢å¼æ˜¯ï¼ˆvalue, concrete type)ï¼Œè€Œä¸æ˜¯(value, interface type)ã€‚</p>
</blockquote>
<p>ä¸‹é¢è¿™æ˜¯ä¸€ä¸ªå®šä¹‰äº†GETæ–¹æ³•çš„æ¥å£ï¼Œå‡½æ•° f ä¹Ÿå°±æ˜¯è°ƒç”¨äº†æ¥å£å†…çš„ GET æ–¹æ³•å¹¶è¾“å‡ºã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Retriever <span class="keyword">interface</span> &#123;</span><br><span class="line">   Get(url <span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(r Retriever)</span></span> &#123;</span><br><span class="line">    s := r.Get(<span class="string">'\args'</span>)</span><br><span class="line">  	fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="pointer-receiver"><a href="#pointer-receiver" class="headerlink" title="pointer receiver"></a>pointer receiver</h4><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹æŒ‡é’ˆæ¥æ”¶è€…çš„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RealRetriever <span class="keyword">struct</span> &#123;</span><br><span class="line">   Contents <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡é’ˆæ¥æ”¶è€…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RealRetriever)</span> <span class="title">Get</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> r.Contents</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    retriever := RealRetriever&#123;&#125;</span><br><span class="line">    f(&amp;retriever) <span class="comment">//pointer</span></span><br><span class="line">    f(retriever)  <span class="comment">//value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>f(&amp;retriever)</code> æ‰§è¡Œå®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œè€Œ <code>f(retriever)</code> ä¼šæŠ¥é”™ï¼Œç®€å•æ¥è¯´å°±æ˜¯ <code>f(retriever)</code> æ˜¯ä¸ªcall by valueï¼Œè°ƒç”¨çš„æ—¶å€™ä¼šå¯¹ retriever è¿›è¡Œå¤åˆ¶ï¼Œæ‹·è´ä¹‹åçš„rå¹¶ä¸æ”¯æŒGETçš„æ¥æ”¶è€…æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„æ¦‚å¿µã€‚</p>
<h4 id="value-receiver"><a href="#value-receiver" class="headerlink" title="value receiver"></a>value receiver</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MockRetriever <span class="keyword">struct</span> &#123;</span><br><span class="line">   Contents <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å€¼æ¥æ”¶è€…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r MockRetriever)</span> <span class="title">Get</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> r.Contents</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œå‘ç°ä¸¤ä¸ªéƒ½æ˜¯å¯ä»¥çš„ï¼Œå½“ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå¼•ç”¨çš„æ—¶å€™ï¼Œgoå†…éƒ¨çš„éšå¼è½¬æ¢å¯ä»¥é€šè¿‡åœ°å€æ‰¾åˆ°Getæ–¹æ³•ï¼Œè€Œä¹‹å‰call by valueçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å€¼æ˜¯æ— æ³•æ‰¾åˆ°åœ°å€åœ¨å“ªå„¿çš„ã€‚</p>
<h4 id="ç©ºæ¥å£"><a href="#ç©ºæ¥å£" class="headerlink" title="ç©ºæ¥å£"></a>ç©ºæ¥å£</h4><blockquote>
<p>ç©ºæ¥å£ç±»å‹interface{}ä¸€ä¸ªæ–¹æ³•ç­¾åä¹Ÿä¸åŒ…å«ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°æ®ç±»å‹éƒ½å®ç°äº†ç©ºæ¥å£ã€‚<br>ç©ºæ¥å£ç±»å‹å¯ä»¥ç”¨äºå­˜å‚¨ä»»æ„æ•°æ®ç±»å‹çš„å®ä¾‹ã€‚</p>
</blockquote>
<p>ç©ºæ¥å£ç»™äº†æˆ‘ä¸€ç§æŒ‡é’ˆçš„æ„Ÿè§‰ğŸ˜‚ï¼Œå¯ä»¥æŒ‡å‘ä»»ä½•ä¸€ä¸ªinterfaceã€‚</p>
<p>å¦‚æœå®šä¹‰ä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯ <code>interface{}</code> ç±»å‹ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥å¯ä»¥æ¥å—ä»»ä½•ç±»å‹ä½œä¸ºå®ƒçš„å‚æ•°ã€‚ä½†æ˜¯å¯¹äºå‡½æ•°å†…éƒ¨æ¥è®²ï¼Œä¼ å…¥çš„æ°¸è¿œæ˜¯ä¸€ä¸ªinterfaceç±»å‹ã€‚</p>
<p>æ•°ç»„çš„ç©ºæ¥å£åˆ™ä¸èƒ½ç®€å•åœ°é€šè¿‡ç­‰å·æ¥èµ‹å€¼ï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line"><span class="keyword">var</span> s []<span class="keyword">interface</span>&#123;&#125; = t</span><br></pre></td></tr></table></figure>
<p>åŒç†ï¼Œå½“ä½¿ç”¨ <code>[]interface{}</code> ä½œä¸ºå‚æ•°ç±»å‹çš„æ—¶å€™ï¼Œåƒä¸‹é¢è¿™æ ·ç›´æ¥ä¼ è¿›å»ä¹Ÿæ˜¯æ²¡æœ‰ç”¨çš„ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printAll</span><span class="params">(vals []<span class="keyword">interface</span>&#123;&#125;)</span></span> &#123; <span class="comment">//1</span></span><br><span class="line">    <span class="keyword">for</span> _, val := <span class="keyword">range</span> vals &#123;</span><br><span class="line">        fmt.Println(val)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    names := []<span class="keyword">string</span>&#123;<span class="string">"stanley"</span>, <span class="string">"david"</span>, <span class="string">"oscar"</span>&#125;</span><br><span class="line">    printAll(names)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“ä¸ºä»€ä¹ˆä¸è‡ªåŠ¨è½¬æ¢æœ‰ä¸ªåšå®¢æåˆ°äº†wikiä¸Šå ç”¨å­˜å‚¨ç©ºé—´çš„è§£é‡Šï¼ˆæˆ‘æœ¬äººçš„æ€€ç–‘å°±æ˜¯è½¬æ¢ä»£ä»·å¤ªé«˜ï¼‰<a href="https://github.com/golang/go/wiki/InterfaceSlice" target="_blank" rel="noopener">https://github.com/golang/go/wiki/InterfaceSlice</a></p>
<p>å½“ç„¶å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ·»åŠ åœ°å€ç©ºé—´æ¥åšï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">s := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(t))</span><br></pre></td></tr></table></figure>
<p>åˆ¤æ–­interfaceçš„ç±»å‹å¯ä»¥ç”¨ä¹‹å‰ç±»å‹è½¬æ¢é‡Œé¢çš„ç±»å‹æ–­è¨€æ¥åšã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/24/golangå­¦ä¹ ç¬”è®°å…­ï¼šnew-å’Œ-make/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/24/golangå­¦ä¹ ç¬”è®°å…­ï¼šnew-å’Œ-make/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°å…­ï¼šnew å’Œ make
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-24 21:58:10 / Modified: 21:59:52" itemprop="dateCreated datePublished" datetime="2020-02-24T21:58:10+08:00">2020-02-24</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ¥å§è®¤çœŸæŠ„ä¸€ä¸‹effective go</p>
<h4 id="new"><a href="#new" class="headerlink" title="new"></a>new</h4><p>ä½¿ç”¨newä¼šç»™å˜é‡åˆ†é…ä¸€ä¸ªåœ°å€ç©ºé—´ï¼Œä½†æ˜¯å¹¶ä¸ä¼šå»åˆå§‹åŒ–ï¼Œè€Œæ˜¯å…¨éƒ¨å®šä½é›¶ï¼ˆzeros itï¼‰åŒæ—¶newè¿”å›äº†ä¸€ä¸ªæŒ‡å‘åœ°å€ç©ºé—´çš„æŒ‡é’ˆã€‚</p>
<p>composit literalï¼ˆåˆ›å»ºçš„è¯­æ³•ï¼Ÿä¸­æ–‡ç¿»è¯‘æˆè°œï¼‰</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewFile</span><span class="params">(fd <span class="keyword">int</span>, name <span class="keyword">string</span>)</span> *<span class="title">File</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> fd &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    f := File&#123;fd, name, <span class="literal">nil</span>, <span class="number">0</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> &amp;f</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶å°±å¯ä»¥ç®€åŒ–ä¸º <code>return &amp;File{fd, name, nil, 0}</code>ï¼Œè€Œä¸”åˆå§‹åŒ–çš„æ—¶å€™å¯ä»¥æ— è§†é¡ºåºï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &amp;File&#123;fd: fd, name: name&#125;</span><br></pre></td></tr></table></figure>
<p>æ²¡å¡«çš„ä¸¤ä¸ªå‚æ•°ä¼šé»˜è®¤ç½®ç©º/é›¶ã€‚</p>
<p>è¿™æ ·çš„è¯­æ³•å¯ä»¥ç”¨åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œæ¯”å¦‚åˆ›å»ºæ•°ç»„æˆ–è€…sliceçš„æ—¶å€™</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a := [...]<span class="keyword">string</span>   &#123;Enone: <span class="string">"no error"</span>, Eio: <span class="string">"Eio"</span>, Einval: <span class="string">"invalid argument"</span>&#125;</span><br><span class="line">s := []<span class="keyword">string</span>      &#123;Enone: <span class="string">"no error"</span>, Eio: <span class="string">"Eio"</span>, Einval: <span class="string">"invalid argument"</span>&#125;</span><br><span class="line">m := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;Enone: <span class="string">"no error"</span>, Eio: <span class="string">"Eio"</span>, Einval: <span class="string">"invalid argument"</span>&#125;</span><br></pre></td></tr></table></figure>
<h4 id="make"><a href="#make" class="headerlink" title="make"></a>make</h4><p>å“‡æˆ‘æ„Ÿè§‰æˆ‘æ´»çš„åƒä¸€ä¸ªæ±‰åŒ–ç»„ã€‚ã€‚ã€‚</p>
<ul>
<li>é¦–å…ˆï¼Œåƒå‰é¢è¯´çš„ï¼Œmakeåªè´Ÿè´£åˆ›å»ºæ–°çš„sliceï¼Œmapå’Œchannel</li>
<li>makeè¿”å›çš„æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥å®ƒéœ€è¦è¢«åˆå§‹åŒ–</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Unnecessarily complex:</span></span><br><span class="line"><span class="keyword">var</span> p *[]<span class="keyword">int</span> = <span class="built_in">new</span>([]<span class="keyword">int</span>)</span><br><span class="line">*p = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">100</span>, <span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶ä¸Šé¢é‚£æ®µä»£ç è¢«effective goè®¤ä¸ºæ˜¯æ²¡å¿…è¦è¿™ä¹ˆå¤æ‚ï¼Œä½†æ˜¯è¿˜æŒºæœ‰æ„æ€çš„ï¼Œå……åˆ†åœ°å±•ç¤ºäº†new è¿”å›æŒ‡é’ˆmakeè¿”å›å¼•ç”¨çš„ç‰¹è´¨ï¼Œpå°±æ˜¯ä¸€ä¸ªåˆå§‹åŒ–é•¿åº¦æ˜¯100ï¼Œå®¹é‡ä¹Ÿæ˜¯100çš„åˆ‡ç‰‡ã€‚</p>
<p>å½“ç„¶å¸¸ç”¨å†™æ³•è¿˜æ˜¯ä¸‹é¢è¿™ä¸ªï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">100</span>)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/24/golangå­¦ä¹ ç¬”è®°äº”ï¼šdeferç®€ä»‹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/24/golangå­¦ä¹ ç¬”è®°äº”ï¼šdeferç®€ä»‹/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°äº”ï¼šdeferç®€ä»‹
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-24 21:57:47 / Modified: 21:59:06" itemprop="dateCreated datePublished" datetime="2020-02-24T21:57:47+08:00">2020-02-24</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¹Ÿæ˜¯ä¸çŸ¥é“åº”è¯¥å†™åœ¨å“ªå„¿ä¸å¦‚æ–°å¼€ä¸€ä¸ªæ–‡ä»¶ç³»åˆ—ã€‚</p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Contents</span><span class="params">(filename <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">    f, err := os.Open(filename)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> f.Close()  <span class="comment">// f.Close will run when we're finished.</span></span><br><span class="line">  	<span class="keyword">return</span> <span class="literal">nil</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯åœ¨å‡½æ•°æ‰§è¡Œç»“æŸä¹‹åä¼šæ‰§è¡Œdeferè°ƒç”¨çš„å‡½æ•°å†…å®¹ï¼Œå°±åƒææ„å‡½æ•°ä¸€æ ·åšä¸€äº›æ¸…ç†ä¹‹ç±»çš„æ“ä½œã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p><strong>deferåé¢åªèƒ½è·Ÿä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼</strong></p>
<h2 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a>å¥½å¤„</h2><ul>
<li>deferå¯ä»¥ä¿è¯å³ä½¿å‡½æ•°å› ä¸ºpanicç­‰æ„å¤–é€€å‡ºçš„æ—¶å€™ä¹Ÿå¯ä»¥å°†ä¸€äº›å¿…è¦çš„ä¸œè¥¿æ‰§è¡Œ</li>
<li>ä¹¦å†™å¥½çœ‹ï¼Œæ¯”å¦‚ä¸Šé¢çš„æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œdeferå¯ä»¥è®©å…³é—­çš„æ“ä½œæŒ¨ç€æ‰“å¼€ã€‚</li>
</ul>
<h2 id="è°ƒç”¨"><a href="#è°ƒç”¨" class="headerlink" title="è°ƒç”¨"></a>è°ƒç”¨</h2><p>deferæ˜¯ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨å‘¢ï¼ŒæŠ„çš„åšå®¢ï¼š<a href="https://www.jianshu.com/p/5b0b36f398a2" target="_blank" rel="noopener">https://www.jianshu.com/p/5b0b36f398a2</a></p>
<p>é‡Œé¢ç ”ç©¶äº†returnçš„æ±‡ç¼–ï¼š</p>
<p>returnæŒ‡ä»¤çš„æ‰§è¡Œåˆ†ä¸‰æ­¥ï¼Œç¬¬ä¸€æ­¥æ‹·è´returnå€¼åˆ°è¿”å›å€¼å†…å­˜åœ°å€ï¼Œç¬¬äºŒæ­¥ä¼šè°ƒç”¨runtime.deferreturnå»æ‰§è¡Œå‰é¢æ³¨å†Œçš„deferå‡½æ•°ï¼Œç¬¬ä¸‰éƒ¨å†æ‰§è¡Œretæ±‡ç¼–æŒ‡ä»¤ã€‚</p>
<h3 id="æ‰§è¡Œé¡ºåº"><a href="#æ‰§è¡Œé¡ºåº" class="headerlink" title="æ‰§è¡Œé¡ºåº"></a>æ‰§è¡Œé¡ºåº</h3><p>deferçš„æ‰§è¡Œé»˜è®¤æ˜¯å…ˆè¿›åå‡ºï¼ˆLIFOï¼‰ï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªå‡½æ•°é‡Œå‡ºç°ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Printf(<span class="string">"%d "</span>, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åè¾“å‡ºçš„é¡ºåºä¼šå˜æˆ 4ï¼Œ3ï¼Œ2ï¼Œ1ï¼Œ0</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/24/golangå­¦ä¹ ç¬”è®°å››ï¼šåˆ†å·å’Œæ¢è¡Œ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/24/golangå­¦ä¹ ç¬”è®°å››ï¼šåˆ†å·å’Œæ¢è¡Œ/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°å››ï¼šåˆ†å·å’Œæ¢è¡Œ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-24 21:57:25 / Modified: 21:58:39" itemprop="dateCreated datePublished" datetime="2020-02-24T21:57:25+08:00">2020-02-24</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¸çŸ¥é“åº”è¯¥æ‰”åœ¨å“ªå„¿ä¸å¦‚æ–°å¼€ä¸€ä¸ªã€‚ã€‚ã€‚</p>
<p>è¿˜æ˜¯æ¥è‡ªäº effective go</p>
<p>go å’Œ C ä¸€æ ·éƒ½æ˜¯ç”¨åˆ†å·æ¥åˆ¤æ–­ä¸€ä¸ªè¯­å¥çš„ç»“æŸï¼Œä½†æ˜¯ go ï¼ˆå¯èƒ½æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼‰å¢åŠ äº†ä¸€ä¸ªè‡ªåŠ¨æ·»åŠ åˆ†å·çš„æ–¹æ³•ï¼Œgoä¼šåœ¨ä¸€è¡Œæ˜¯ä»¥ä»¥ä¸‹è¯­å¥ç»“æŸçš„æ—¶å€™è‡ªåŠ¨æ·»åŠ åˆ†å·ï¼š</p>
<ul>
<li>å½“è¾“å…¥è¢«æ–­å¼€ä¸ºæ ‡è®°æ—¶ï¼Œå¦‚æœè¡Œæœ«æ ‡è®°ä¸º<ul>
<li>ä¸€ä¸ªæ ‡è¯†ç¬¦</li>
<li>ä¸€ä¸ªæ•´æ•°ã€æµ®ç‚¹æ•°ã€è™šæ•°ã€å­—ç¬¦æˆ–å­—ç¬¦ä¸²æ–‡å­—</li>
<li>å…³é”®å­—<code>break</code>ã€<code>continue</code>ã€<code>fallthrough</code>æˆ–<code>return</code>ä¸­çš„ä¸€ä¸ª</li>
<li>è¿ç®—ç¬¦å’Œåˆ†éš”ç¬¦<code>++</code>ã€<code>--</code>ã€<code>)</code>ã€<code>]</code>æˆ–<code>}</code>ä¸­çš„ä¸€ä¸ª</li>
</ul>
</li>
</ul>
<p>å¦‚æœæ˜¯ä¸€æŠŠä¸€æ®µå¤åˆè¯­å¥æ‰”åˆ°ä¸€è¡Œé‡Œå»çš„è¯ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="keyword">for</span> &#123; dst &lt;- &lt;-src &#125; &#125;()</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¹¶ä¸ç”¨åˆ†å·ï¼Œå› ä¸ºgoä¼šè‡ªåŠ¨åœ¨æ”¶å¤§æ‹¬å·å‰å¢åŠ åˆ†å·ã€‚</p>
<p>æ ¹æ®è¿™ä¸ªæ–¹æ³•ï¼Œgoè§£å†³äº†ä¸€ä¸ªå¤šå¹´çš„äº‰ç«¯ï¼Œå¤§æ‹¬å·æ˜¯å¦æ¢è¡Œçš„é—®é¢˜å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> i &lt; f() &#123;</span><br><span class="line">    g()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™æ ·æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ¢è¡Œçš„è¯f()åé¢å°±ä¼šå¤šäº†ä¸€ä¸ªåˆ†å·å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> i &lt; f()  <span class="comment">// wrong!</span></span><br><span class="line">&#123;           <span class="comment">// wrong!</span></span><br><span class="line">    g()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å¤‡æ³¨ï¼š</strong>å½“ç„¶å¾ªç¯é‡Œé¢ç”¨æ¥åŒºåˆ«initializerï¼Œconditionçš„åˆ†å·è¿˜æ˜¯ä¸èƒ½ä¸¢å‘€</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/20/golangå­¦ä¹ ç¬”è®°ä¸‰ï¼šContext/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/20/golangå­¦ä¹ ç¬”è®°ä¸‰ï¼šContext/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°ä¸‰ï¼šContext
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-20 22:08:41" itemprop="dateCreated datePublished" datetime="2020-02-20T22:08:41+08:00">2020-02-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-02-21 11:39:03" itemprop="dateModified" datetime="2020-02-21T11:39:03+08:00">2020-02-21</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å­¦ä¹ å®Œå…¨æ²¡æœ‰é¡ºåºï¼Œå°±æ˜¯å†™serverçš„æ—¶å€™çœ‹åˆ°ä¸æ‡‚çš„å°±å»å­¦ï¼Œä½¿ç”¨å¯¼å‘å‹å­¦ä¹ ã€‚ã€‚ã€‚</p>
<p>http serverå¤ªç»å¸¸çœ‹åˆ°contextäº†ä½†æ˜¯åˆä¸æ˜¯ç‰¹åˆ«äº†è§£ï¼Œå°±å»ç¿»äº†ä¸€ä¸‹å®˜ç½‘å’Œå„ç§å¥‡æ€ªçš„åšå®¢ğŸ˜‚</p>
<p>å®˜ç½‘æ–‡æ¡£ï¼š<a href="https://pkg.go.dev/golang.org/x/net/context" target="_blank" rel="noopener">https://pkg.go.dev/golang.org/x/net/context</a></p>
<p>å®˜æ–¹åšå®¢ï¼š<a href="https://blog.golang.org/context" target="_blank" rel="noopener">https://blog.golang.org/context</a></p>
<h2 id="ä¸ºä»€ä¹ˆæœ‰context"><a href="#ä¸ºä»€ä¹ˆæœ‰context" class="headerlink" title="ä¸ºä»€ä¹ˆæœ‰context"></a>ä¸ºä»€ä¹ˆæœ‰context</h2><p>å†…å®¹æ˜¯æŠ„çš„ğŸ˜‚ï¼ŒåŸæ–‡æŸåšå®¢ï¼š<a href="https://www.cnblogs.com/qcrao-2018/archive/2019/06/12/11007503.html" target="_blank" rel="noopener">https://www.cnblogs.com/qcrao-2018/archive/2019/06/12/11007503.html</a></p>
<p>è®²å¾—æ ¼å¤–æ¸…æ¥šï¼Œæ²¡æœ‰åŠ¨åŠ›å†å»å†™ä¸€æ¬¡ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œå½“æœ‰ä¸€ä¸ªrequestè¿‡æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå¼€å¾ˆå¤šgoroutineå»åšä¸åŒçš„å¤„ç†ï¼Œæ¯”å¦‚è·å–æ•°æ®åº“ç­‰ç­‰ï¼Œcontextå°±æ˜¯ç»™è¿™äº›goroutineé—´çš„å…±äº«å€¼ä¼ é€’æä¾›ä¸€ä¸ªæ–¹æ³•ã€‚</p>
<p><img src="/../images/go/without_context.png" alt="without context"></p>
<p><img src="/../images/go/with_context.png" alt="with context"></p>
<p>æ–‡ä¸­ä¸¾äº†ä¸¤ä¸ªåœºæ™¯ï¼Œä¸€ä¸ªæ˜¯å„ç§goroutineéœ€è¦åŒä¸€ä¸ªtokenï¼Œä¹Ÿå°±æ˜¯ä¼ ç»Ÿæ„ä¹‰çš„å…±äº«å€¼ï¼Œå¦ä¸€ä¸ªå°±æ˜¯å½“æŸé¡¹æ“ä½œå¡ä½æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¶…æ—¶æ§åˆ¶ï¼Œgoroutineå°±ä¼šéšç€requestçš„åˆ°æ¥è¶Šå¼€è¶Šå¤šè¶Šå¼€è¶Šå¤šï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªå…¬å…±çš„deadlineåšè¶…æ—¶å–æ¶ˆçš„æ“ä½œã€‚</p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å›åˆ°å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A Context carries a deadline, cancelation signal, and request-scoped values</span></span><br><span class="line"><span class="comment">// across API boundaries. Its methods are safe for simultaneous use by multiple</span></span><br><span class="line"><span class="comment">// goroutines.</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="comment">// Done returns a channel that is closed when this Context is canceled</span></span><br><span class="line">    <span class="comment">// or times out.</span></span><br><span class="line">    Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Err indicates why this context was canceled, after the Done channel</span></span><br><span class="line">    <span class="comment">// is closed.</span></span><br><span class="line">    Err() error</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Deadline returns the time when this Context will be canceled, if any.</span></span><br><span class="line">    Deadline() (deadline time.Time, ok <span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Value returns the value associated with key or nil if none.</span></span><br><span class="line">    Value(key <span class="keyword">interface</span>&#123;&#125;) <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å››ä¸ªä¹Ÿå°±æ˜¯ä¸€ä¸ªcontextæ‰€éœ€è¦æœ‰çš„åŸºæœ¬å‡½æ•°ï¼ŒDoneè¿”å›ä¸€ä¸ªè¢«å…³é—­çš„channelï¼Œä¸ºä»€ä¹ˆè¦ç”¨ä¸€ä¸ªè¢«å…³é—­çš„channelï¼Ÿæ˜¯å› ä¸ºgoroutineä»ä¸€ä¸ªè¢«å…³é—­çš„channelé‡Œæ˜¯å¯ä»¥å–å‡ºé›¶å€¼çš„ï¼Œæ‰€ä»¥ä¸€æ—¦goroutineä»é‡Œé¢å–å‡ºé›¶å€¼ï¼Œå°±æ„å‘³ç€å®ƒå¯ä»¥åœæ­¢å¹¶ä¸”å¼€å§‹åšä¸€äº›æ”¶å°¾å·¥ä½œäº†ã€‚åŒæ—¶Errå‡½æ•°ä¼šè¿”å›é”™è¯¯åŸå› ã€‚</p>
<h3 id="APIä»‹ç»"><a href="#APIä»‹ç»" class="headerlink" title="APIä»‹ç»"></a>APIä»‹ç»</h3><h4 id="Backgroundå’ŒTODO"><a href="#Backgroundå’ŒTODO" class="headerlink" title="Backgroundå’ŒTODO"></a>Backgroundå’ŒTODO</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> emptyCtx <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Deadline</span><span class="params">()</span> <span class="params">(deadline time.Time, ok <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Done</span><span class="params">()</span> &lt;-<span class="title">chan</span> <span class="title">struct</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Err</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>backgroundå’Œtodoå°±æ˜¯æ ¹æ®ä¸Šé¢çš„å®ç°</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Background</span><span class="params">()</span> <span class="title">Context</span></span></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºçš„å°±æ˜¯ä¸€ä¸ªç©ºçš„contextï¼Œå› ä¸ºé‡Œé¢çš„Doneè¿”å›çš„channelæ˜¯ç©ºï¼Œæ‰€ä»¥å…¶å®å®ƒæ°¸è¿œä¹Ÿä¸ä¼šè¢«cancelï¼ŒTODOå°±æ˜¯åœ¨ä½ ä¸çŸ¥é“è¦ä¼ ä»€ä¹ˆè¿›å»çš„æ—¶å€™å…ˆæ‹¿æ¥å ä¸ªä½ç½®ã€‚</p>
<h4 id="WithCancel"><a href="#WithCancel" class="headerlink" title="WithCancel"></a>WithCancel</h4><p>å¾ˆå¤šæ—¶å€™è¶…æ—¶çš„æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœæ­¢æ‰€æœ‰çš„coroutineï¼Œæ‰“ä¸ªæ¯”æ–¹è·å–dbè¶…æ—¶äº†ï¼Œé‚£æˆ‘ä»¬å¸Œæœ›é€€å‡ºdbçš„goroutineï¼ŒæŠŠä¸€ä¸ªè¶…æ—¶çš„errorç»™åˆ°serverï¼Œserverå†è¿”å›è¿™ä¸ªerrorï¼Œä¹Ÿå°±æ˜¯å­goroutineï¼ˆä¸Šé¢çš„goroutineb,câ€¦ï¼‰åœæ­¢çš„æƒ…å†µä¸‹æˆ‘ä»¬ä¸å¸Œæœ›çˆ¶goroutineï¼ˆä¸Šé¢çš„goroutine aï¼‰ä¹Ÿç»™åœäº†ã€‚è¿™ä¸ªæ—¶å€™å°±æœ‰äº†withcancelã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCancel</span><span class="params">(parent Context)</span> <span class="params">(ctx Context, cancel CancelFunc)</span></span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨withcancelï¼Œä¼šæ ¹æ®çˆ¶contextåˆ›å»ºä¸€ä¸ªdeadlineä¸æ¯”çˆ¶contextæ™šçš„å­contextï¼Œå­contexté‡Œé¢ä¼šæœ‰ä¸€ä¸ªæ–°çš„channelï¼Œè¿™ä¸ªchannelè¢«å…³é—­æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p>
<ul>
<li>ddlè¶…äº†</li>
<li>è¿”å›çš„é‚£ä¸ªCancelFuncè¢«å¼•ç”¨äº†</li>
<li>çˆ¶contextçš„Done channelè¢«å…³äº†ã€‚</li>
</ul>
<h4 id="WithTimeout"><a href="#WithTimeout" class="headerlink" title="WithTimeout"></a>WithTimeout</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(parent Context, timeout time.Duration)</span> <span class="params">(Context, CancelFunc)</span></span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯å¦‚æœç¨‹åºè¿è¡Œè¶…æ—¶ï¼Œå°±è‡ªå·±cancelæ‰ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">slowOperationWithTimeout</span><span class="params">(ctx context.Context)</span> <span class="params">(Result, error)</span></span> &#123;</span><br><span class="line">	ctx, cancel := context.WithTimeout(ctx, <span class="number">100</span>*time.Millisecond)</span><br><span class="line">	<span class="keyword">defer</span> cancel()  <span class="comment">// releases resources if slowOperation completes before timeout elapses</span></span><br><span class="line">	<span class="keyword">return</span> slowOperation(ctx)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„defer cancel() æ˜¯å½“æ•´ä¸ªå‡½æ•°æ­£å¸¸è¿›è¡Œå¹¶ä¸”é€€å‡ºï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰è¶…æ—¶çš„æƒ…å†µä¸‹ï¼‰ï¼Œéœ€è¦åœ¨é€€å‡ºä¹‹å‰æ¸…ç†ä¸€ä¸‹ï¼ˆdeferçš„å…·ä½“æƒ…å†µè¯¦è§go errorï¼‰</p>
<h4 id="WithValue"><a href="#WithValue" class="headerlink" title="WithValue"></a>WithValue</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key <span class="keyword">interface</span>&#123;&#125;, val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Context</span></span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡contextä¼ å€¼çš„è¿‡ç¨‹ï¼Œå®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼šè¿”å›çˆ¶contextä¸­keyå¯¹åº”çš„å€¼ï¼Œä¹Ÿå°±æ˜¯valueï¼Œæ‰“ä¸ªæ¯”æ–¹è·å–appidä¹‹ç±»çš„ï¼Ÿ</p>
<p>å…¶å®æ ¹æ®é‚£ä¸ªåšå®¢çš„æºä»£ç æè¿°ï¼Œå…¶å®æ¯æ¬¡è·å–valueçš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªcontextå­˜äº†å°±ç”¨è‡ªå·±çš„ï¼Œæ²¡æœ‰å°±å¾€ä¸Šæ‰¾ï¼Œæ‰€ä»¥å­˜ä¸åŒçš„å€¼ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ï¼Œä½†æ˜¯åœ¨å®é™…ä½¿ç”¨æ—¶éå¸¸å®¹æ˜“é™·å…¥æ··ä¹±ï¼Œæ‰€ä»¥å®˜æ–¹æ–‡æ¡£æœ€åæäº†ä¸€ä¸ªçœŸè¯šçš„å»ºè®®ï¼š<strong>Use context Values only for request-scoped data that transits processes and APIs, not for passing optional parameters to functions. </strong> ç¿»è¯‘è¿‡æ¥å°±æ˜¯åªç”¨æ¥ä¼ requestèŒƒå›´å†…çš„å€¼ï¼Œåˆ«å»å½“å‡½æ•°ä¼ å‚é‚£ä¹ˆç”¨ğŸ˜‚ã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å®˜æ–¹æ–‡æ¡£é‡Œçš„ä¸€æ®µè¯ï¼Œç¿»è¯‘ä¸€ä¸‹ï¼š</p>
<ul>
<li>é’ˆå¯¹æ¯ä¸€ä¸ªæ¥çš„requestéœ€è¦åˆ›å»ºä¸€ä¸ªContext</li>
<li>å‡½æ•°è°ƒç”¨é“¾éœ€è¦ä¼ é€’ä¸€ä¸ªContext</li>
<li>ä¸è¦æŠŠContextå­˜åœ¨ä¸€ä¸ªç»“æ„ä½“é‡Œï¼Œè®©å®ƒä½œä¸ºå¤–éƒ¨å‚æ•°åœ¨éœ€è¦çš„å‡½æ•°é‡Œä¼ é€’ï¼ŒContextéœ€è¦ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåå­—é€šå¸¸ç”¨ctxè¡¨ç¤º</li>
<li>ä¸è¦ä¼ é€’ä¸€ä¸ªç©º(nil)Contextï¼Œä½ ä¸çŸ¥é“ä¼ ä»€ä¹ˆçš„æ—¶å€™å°±ç”¨TODO</li>
<li>ä¸è¦æŠŠæœ¬åº”è¯¥ä½œä¸ºå‡½æ•°å‚æ•°çš„ç±»å‹å¡åˆ° context ä¸­ï¼Œcontext å­˜å‚¨çš„åº”è¯¥æ˜¯ä¸€äº›å…±åŒçš„æ•°æ®ã€‚ä¾‹å¦‚ï¼šç™»é™†çš„ sessionã€cookie ç­‰ã€‚</li>
<li>åŒä¸€ä¸ªContextå¯ä»¥è¢«ä¼ é€’åˆ°ä¸åŒçš„goroutineé‡Œï¼Œå½“å®ƒè¢«å¤šä¸ªgoroutineåŒæ—¶ä½¿ç”¨çš„æ—¶å€™æ˜¯å®‰å…¨çš„</li>
</ul>
<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><h3 id="canceleræ¥å£"><a href="#canceleræ¥å£" class="headerlink" title="canceleræ¥å£"></a>canceleræ¥å£</h3><p>å‰é¢å·²ç»æ”¾äº†Contextæ¥å£ï¼Œè¿™é‡Œé¦–å…ˆæŠŠcanceleræ¥å£æ”¾ä¸€ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> canceler <span class="keyword">interface</span> &#123;</span><br><span class="line">    cancel(removeFromParent <span class="keyword">bool</span>, err error)</span><br><span class="line">    Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WithCancelçš„å®ç°"><a href="#WithCancelçš„å®ç°" class="headerlink" title="WithCancelçš„å®ç°"></a>WithCancelçš„å®ç°</h3><p>ç„¶åæ˜¯æ ¹æ®Contextæ¥å£æ´¾ç”Ÿï¼ˆgoè¯­è¨€ä¼¼ä¹ä¸èƒ½è¿™ä¹ˆè¯´ä½†æ˜¯æ¯”è¾ƒå¥½ç†è§£ï¼‰çš„cancelContextç»“æ„ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> cancelCtx <span class="keyword">struct</span> &#123;</span><br><span class="line">    Context</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿æŠ¤ä¹‹åçš„å­—æ®µ</span></span><br><span class="line">    mu       sync.Mutex</span><br><span class="line">    done     <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">    children <span class="keyword">map</span>[canceler]<span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">    err      error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ˜¯Doneçš„å®ç°</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cancelCtx)</span> <span class="title">Done</span><span class="params">()</span> &lt;-<span class="title">chan</span> <span class="title">struct</span></span>&#123;&#125; &#123;</span><br><span class="line">    c.mu.Lock()</span><br><span class="line">    <span class="keyword">if</span> c.done == <span class="literal">nil</span> &#123;</span><br><span class="line">        c.done = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    d := c.done</span><br><span class="line">    c.mu.Unlock()</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åæ­£å°±æ˜¯è¿”å›ä¸€ä¸ªç©ºçš„æ–°channelï¼Œè¿™ä¸ªchannelæ²¡åœ°æ–¹å»å†™å…¥ï¼Œæ‰€ä»¥é™¤éå…³é—­ä¸ç„¶å°±ä¼šä¸€ç›´å¡ä½ã€‚</p>
<p>ç„¶åå°±æ˜¯cancelæ–¹æ³•çš„ä¹¦å†™ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cancelCtx)</span> <span class="title">cancel</span><span class="params">(removeFromParent <span class="keyword">bool</span>, err error)</span></span> &#123;</span><br><span class="line">    <span class="comment">// å¿…é¡»è¦ä¼  err</span></span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"context: internal error: missing cancel error"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    c.mu.Lock()</span><br><span class="line">    <span class="keyword">if</span> c.err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.mu.Unlock()</span><br><span class="line">        <span class="keyword">return</span> <span class="comment">// å·²ç»è¢«å…¶ä»–åç¨‹å–æ¶ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»™ err å­—æ®µèµ‹å€¼</span></span><br><span class="line">    c.err = err</span><br><span class="line">    <span class="comment">// å…³é—­ channelï¼Œé€šçŸ¥å…¶ä»–åç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> c.done == <span class="literal">nil</span> &#123;</span><br><span class="line">        c.done = closedchan</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">close</span>(c.done)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†å®ƒçš„æ‰€æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> child := <span class="keyword">range</span> c.children &#123;</span><br><span class="line">        <span class="comment">// é€’å½’åœ°å–æ¶ˆæ‰€æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">        child.cancel(<span class="literal">false</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†å­èŠ‚ç‚¹ç½®ç©º</span></span><br><span class="line">    c.children = <span class="literal">nil</span></span><br><span class="line">    c.mu.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> removeFromParent &#123;</span><br><span class="line">        <span class="comment">// ä»çˆ¶èŠ‚ç‚¹ä¸­ç§»é™¤è‡ªå·± </span></span><br><span class="line">        removeChild(c.Context, c)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠ„çš„è¿˜æ˜¯ç¬¬ä¸€ç« çš„åšå®¢ï¼Œå†™çš„å¯æ¸…æ¥šäº†æ‡’å¾—å†åŠ ä¸œè¥¿ã€‚å…·ä½“ç©¶ç«Ÿä»€ä¹ˆæ—¶å€™ä»çˆ¶èŠ‚ç‚¹ä¸­ç§»é™¤è‡ªå·±ä»€ä¹ˆæ—¶å€™ä¸ç§»é™¤ï¼Œä¸»è¦è¿˜æ˜¯å–å†³äºéå†åˆ é™¤å­èŠ‚ç‚¹é‡Œé¢çš„å‡½æ•°é€»è¾‘ï¼Œå¸Œæœ›åé¢æ”¹æ”¹å°±æ²¡è¿™ä¸ªå‚æ•°ç®—äº†ğŸ˜‚</p>
<h3 id="WithValueçš„å®ç°"><a href="#WithValueçš„å®ç°" class="headerlink" title="WithValueçš„å®ç°"></a>WithValueçš„å®ç°</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> valueCtx <span class="keyword">struct</span> &#123;</span><br><span class="line">    Context</span><br><span class="line">    key, val <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸é‡è¦é‡è¦çš„æ˜¯åé¢Value()å‡½æ•°çš„å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *valueCtx)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"%v.WithValue(%#v, %#v)"</span>, c.Context, c.key, c.val)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *valueCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">if</span> c.key == key &#123;</span><br><span class="line">        <span class="keyword">return</span> c.val</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c.Context.Value(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¿™ä¸ªå€¼ç›®å‰å–ä¸åˆ°çš„è¯å°±ä¼šä»çˆ¶Contexté‡Œé¢å–ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/20/ginæ¡†æ¶å­¦ä¹ ç¬”è®°ä¸€ï¼šç®€å•ä½¿ç”¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/20/ginæ¡†æ¶å­¦ä¹ ç¬”è®°ä¸€ï¼šç®€å•ä½¿ç”¨/" itemprop="url">
                  ginæ¡†æ¶å­¦ä¹ ç¬”è®°ä¸€ï¼šç®€å•ä½¿ç”¨
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-20 22:07:07 / Modified: 22:08:03" itemprop="dateCreated datePublished" datetime="2020-02-20T22:07:07+08:00">2020-02-20</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/gin/" itemprop="url" rel="index"><span itemprop="name">gin</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åªæ˜¯ä¸€ä¸ªä½¿ç”¨æ–¹å¼çš„memoï¼Œé˜²æ­¢ä»¥åè®°ä¸ä½è¿˜è¦æŸ¥ï¼ˆå…¶å®å°±æ˜¯ä¸ªç®€æ˜“ç‰ˆç¿»è¯‘ã€‚ã€‚ã€‚æ¯•ç«Ÿæ˜¯ä¸ªåƒåœ¾çš„è‡ªå·±ï¼‰</p>
<p>gitåœ°å€ï¼š<a href="https://github.com/gin-gonic/gin" target="_blank" rel="noopener">https://github.com/gin-gonic/gin</a></p>
<p>APIåˆ—è¡¨ï¼š<a href="https://godoc.org/github.com/gin-gonic/gin" target="_blank" rel="noopener">https://godoc.org/github.com/gin-gonic/gin</a></p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure>
<p>è¦è£…å¥½å¤šä¸œè¥¿ã€‚ã€‚ã€‚è€Œä¸”ç½‘ã€‚ã€‚ã€‚æ…¢æ…¢ç­‰å°±æ˜¯äº†</p>
<p>è¿è¡ŒåŸºç¡€ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Creates a gin router with default middleware:</span></span><br><span class="line">	<span class="comment">// logger and recovery (crash-free) middleware</span></span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	router.GET(<span class="string">"/someGet"</span>, getting)</span><br><span class="line">	router.POST(<span class="string">"/somePost"</span>, posting)</span><br><span class="line">	router.PUT(<span class="string">"/somePut"</span>, putting)</span><br><span class="line">	router.DELETE(<span class="string">"/someDelete"</span>, deleting)</span><br><span class="line">	router.PATCH(<span class="string">"/somePatch"</span>, patching)</span><br><span class="line">	router.HEAD(<span class="string">"/someHead"</span>, head)</span><br><span class="line">	router.OPTIONS(<span class="string">"/someOptions"</span>, options)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// By default it serves on :8080 unless a</span></span><br><span class="line">	<span class="comment">// PORT environment variable was defined.</span></span><br><span class="line">	router.Run()</span><br><span class="line">	<span class="comment">// router.Run(":3000") for a hard coded port</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="router"><a href="#router" class="headerlink" title="router"></a>router</h2><h3 id="é»˜è®¤è·¯ç”±"><a href="#é»˜è®¤è·¯ç”±" class="headerlink" title="é»˜è®¤è·¯ç”±"></a>é»˜è®¤è·¯ç”±</h3><p><code>gin.Default()</code></p>
<p>go ginåœ¨å†…éƒ¨å°è£…å¥½äº†ä¸€å¥—è·¯ç”±ç®¡ç†æœºåˆ¶ï¼Œä¸»è¦ä»‹ç»ä¸€ä¸‹é‡Œé¢è·å–å‚æ•°çš„æ–¹å¼å§ã€‚ï¼ˆå…¶å®å°±æ˜¯ç¿»è¯‘gitæ–‡æ¡£ï¼‰</p>
<h4 id="è·¯å¾„åŒ¹é…å‚æ•°"><a href="#è·¯å¾„åŒ¹é…å‚æ•°" class="headerlink" title="è·¯å¾„åŒ¹é…å‚æ•°"></a>è·¯å¾„åŒ¹é…å‚æ•°</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// This handler will match /user/john but will not match /user/ or /user</span></span><br><span class="line">	router.GET(<span class="string">"/user/:name"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">		c.String(http.StatusOK, <span class="string">"Hello %s"</span>, name)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// However, this one will match /user/john/ and also /user/john/send</span></span><br><span class="line">	<span class="comment">// If no other routers match /user/john, it will redirect to /user/john/</span></span><br><span class="line">	router.GET(<span class="string">"/user/:name/*action"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">		action := c.Param(<span class="string">"action"</span>)</span><br><span class="line">		message := name + <span class="string">" is "</span> + action</span><br><span class="line">		c.String(http.StatusOK, message)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// For each matched request Context will hold the route definition</span></span><br><span class="line">	router.POST(<span class="string">"/user/:name/*action"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.FullPath() == <span class="string">"/user/:name/*action"</span> <span class="comment">// true</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="GET-ä¼ å…¥çš„å‚æ•°"><a href="#GET-ä¼ å…¥çš„å‚æ•°" class="headerlink" title="GET ä¼ å…¥çš„å‚æ•°"></a>GET ä¼ å…¥çš„å‚æ•°</h4><p>query string: <code>/welcome?firstname=Jane&amp;lastname=Doe</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">router.GET(<span class="string">"/welcome"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		firstname := c.DefaultQuery(<span class="string">"firstname"</span>, <span class="string">"Guest"</span>)</span><br><span class="line">		lastname := c.Query(<span class="string">"lastname"</span>) <span class="comment">// shortcut for c.Request.URL.Query().Get("lastname")</span></span><br><span class="line"></span><br><span class="line">		c.String(http.StatusOK, <span class="string">"Hello %s %s"</span>, firstname, lastname)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­DefaultQueryï¼šDefaultQuery(key, defaultValue string) stringï¼Œæœ‰é»˜è®¤å€¼çš„è·å–å‚æ•°ã€‚</p>
<h4 id="POSTè¡¨å•è·å–å‚æ•°"><a href="#POSTè¡¨å•è·å–å‚æ•°" class="headerlink" title="POSTè¡¨å•è·å–å‚æ•°"></a>POSTè¡¨å•è·å–å‚æ•°</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">router.POST(<span class="string">"/form_post"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		message := c.PostForm(<span class="string">"message"</span>)</span><br><span class="line">		nick := c.DefaultPostForm(<span class="string">"nick"</span>, <span class="string">"anonymous"</span>)</span><br><span class="line"></span><br><span class="line">		c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"status"</span>:  <span class="string">"posted"</span>,</span><br><span class="line">			<span class="string">"message"</span>: message,</span><br><span class="line">			<span class="string">"nick"</span>:    nick,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="ç”¨mapçš„æ–¹å¼è·å–queryé‡Œçš„æ•°ç»„"><a href="#ç”¨mapçš„æ–¹å¼è·å–queryé‡Œçš„æ•°ç»„" class="headerlink" title="ç”¨mapçš„æ–¹å¼è·å–queryé‡Œçš„æ•°ç»„"></a>ç”¨mapçš„æ–¹å¼è·å–queryé‡Œçš„æ•°ç»„</h4><p>requestï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /post?ids[a]=1234&amp;ids[b]=hello HTTP/1.1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">names[first]=thinkerou&amp;names[second]=tianou</span><br></pre></td></tr></table></figure>
<p>serverä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	router.POST(<span class="string">"/post"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">		ids := c.QueryMap(<span class="string">"ids"</span>)</span><br><span class="line">		names := c.PostFormMap(<span class="string">"names"</span>)</span><br><span class="line"></span><br><span class="line">		fmt.Printf(<span class="string">"ids: %v; names: %v"</span>, ids, names)</span><br><span class="line">	&#125;)</span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è·å–æ–‡ä»¶"><a href="#è·å–æ–‡ä»¶" class="headerlink" title="è·å–æ–‡ä»¶"></a>è·å–æ–‡ä»¶</h4><p>request:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:8080/upload \</span><br><span class="line">  -F "file=@/Users/appleboy/test.zip" \</span><br><span class="line">  -H "Content-Type: multipart/form-data"</span><br></pre></td></tr></table></figure>
<p>serverä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	<span class="comment">// Set a lower memory limit for multipart forms (default is 32 MiB)</span></span><br><span class="line">	<span class="comment">// router.MaxMultipartMemory = 8 &lt;&lt; 20  // 8 MiB</span></span><br><span class="line">	router.POST(<span class="string">"/upload"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="comment">// single file</span></span><br><span class="line">		file, _ := c.FormFile(<span class="string">"file"</span>)</span><br><span class="line">		log.Println(file.Filename)</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Upload the file to specific dst.</span></span><br><span class="line">		<span class="comment">// c.SaveUploadedFile(file, dst)</span></span><br><span class="line"></span><br><span class="line">		c.String(http.StatusOK, fmt.Sprintf(<span class="string">"'%s' uploaded!"</span>, file.Filename))</span><br><span class="line">	&#125;)</span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å‚æ•°ç±»å‹ç»‘å®š"><a href="#å‚æ•°ç±»å‹ç»‘å®š" class="headerlink" title="å‚æ•°ç±»å‹ç»‘å®š"></a>å‚æ•°ç±»å‹ç»‘å®š</h4><p>é’ˆå¯¹jsonï¼Œxmlï¼ŒYAMLç­‰å…¶ä»–ç±»å‹çš„requestæˆ–è€…ä¼ ç»Ÿqueryï¼Œæˆ‘ä»¬æŠŠrequest bodyç»‘å®šåˆ°æŸä¸€ç‰¹å®šç±»å‹ä¸Šï¼Œå†å¯¹è¿™ç§ç±»å‹çš„æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚</p>
<p>bindåˆ†ä¸ºä¸¤ç±»ï¼šmustbind å’Œshouldbindï¼ŒåŒºåˆ«æ˜¯å½“mustbindå‡ºé”™çš„æ—¶å€™ï¼Œè¿”å›errorå¹¶ä¸”å¼ºåˆ¶ç»ˆæ­¢åç»­å¤„ç†å¹¶è¿”å›error 400ã€‚shouldbindå½“å‡ºé”™çš„æ—¶å€™åªä¼šè¿”å›errorï¼Œæ˜¯å¦ç»§ç»­æ‰§è¡Œç”±ç¼–å†™è€…è‡ªå·±å†³å®šã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Binding from JSON</span></span><br><span class="line"><span class="keyword">type</span> Login <span class="keyword">struct</span> &#123;</span><br><span class="line">	User     <span class="keyword">string</span> <span class="string">`form:"user" json:"user" xml:"user"  binding:"required"`</span></span><br><span class="line">	Password <span class="keyword">string</span> <span class="string">`form:"password" json:"password" xml:"password" binding:"required"`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœè¾“å…¥useræ²¡è¾“å…¥passwordï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šæŠ¥é”™ã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æœæŠŠä¸Šé¢passwordçš„bingingæ”¹æˆï¼šbinding:"-"å°±ä¸ä¼šæŠ¥é”™äº†</span></span><br><span class="line">router.POST(<span class="string">"/loginJSON"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> json Login</span><br><span class="line">		<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;json); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">"error"</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> json.User != <span class="string">"manu"</span> || json.Password != <span class="string">"123"</span> &#123;</span><br><span class="line">			c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125; </span><br><span class="line">		</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨bind+validatorå¯ä»¥å®ç°é‰´æƒï¼Œç”¨åˆ°å†è¯´ã€‚</p>
<h4 id="Html-æ¸²æŸ“"><a href="#Html-æ¸²æŸ“" class="headerlink" title="Html æ¸²æŸ“"></a>Html æ¸²æŸ“</h4><p>Using LoadHTMLGlob() or LoadHTMLFiles()</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	router.LoadHTMLGlob(<span class="string">"templates/*"</span>)</span><br><span class="line">	<span class="comment">//router.LoadHTMLFiles("templates/template1.html", "templates/template2.html")</span></span><br><span class="line">	router.GET(<span class="string">"/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.HTML(http.StatusOK, <span class="string">"index.tmpl"</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"Main website"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>templates/index.tmpl</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">		&#123;&#123; .title &#125;&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¸²æŸ“è¿™éƒ¨åˆ†ç”¨åˆ°çš„é¢‘ç‡ä¸€ç›´ä¸ç®—å¤ªé«˜å°±è¿™æ ·å§</p>
<h3 id="ä¸å«middlewareçš„è·¯ç”±"><a href="#ä¸å«middlewareçš„è·¯ç”±" class="headerlink" title="ä¸å«middlewareçš„è·¯ç”±"></a>ä¸å«middlewareçš„è·¯ç”±</h3><p>ä¹Ÿå°±æ˜¯ä¸åƒdefaultä¸€æ ·å°è£…å¥½åŒ…æ‹¬logç­‰ç­‰ï¼Œå…·ä½“ä¹Ÿç­‰ç”¨åˆ°äº†å†è¯´</p>
<h3 id="ç”¨ginè¿è¡Œå¤šä¸ªserver"><a href="#ç”¨ginè¿è¡Œå¤šä¸ªserver" class="headerlink" title="ç”¨ginè¿è¡Œå¤šä¸ªserver"></a>ç”¨ginè¿è¡Œå¤šä¸ªserver</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	<span class="string">"golang.org/x/sync/errgroup"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	g errgroup.Group</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">router01</span><span class="params">()</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">	e := gin.New()</span><br><span class="line">	e.Use(gin.Recovery())</span><br><span class="line">	e.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(</span><br><span class="line">			http.StatusOK,</span><br><span class="line">			gin.H&#123;</span><br><span class="line">				<span class="string">"code"</span>:  http.StatusOK,</span><br><span class="line">				<span class="string">"error"</span>: <span class="string">"Welcome server 01"</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">		)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">router02</span><span class="params">()</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">	e := gin.New()</span><br><span class="line">	e.Use(gin.Recovery())</span><br><span class="line">	e.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(</span><br><span class="line">			http.StatusOK,</span><br><span class="line">			gin.H&#123;</span><br><span class="line">				<span class="string">"code"</span>:  http.StatusOK,</span><br><span class="line">				<span class="string">"error"</span>: <span class="string">"Welcome server 02"</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">		)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server01 := &amp;http.Server&#123;</span><br><span class="line">		Addr:         <span class="string">":8080"</span>,</span><br><span class="line">		Handler:      router01(),</span><br><span class="line">		ReadTimeout:  <span class="number">5</span> * time.Second,</span><br><span class="line">		WriteTimeout: <span class="number">10</span> * time.Second,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	server02 := &amp;http.Server&#123;</span><br><span class="line">		Addr:         <span class="string">":8081"</span>,</span><br><span class="line">		Handler:      router02(),</span><br><span class="line">		ReadTimeout:  <span class="number">5</span> * time.Second,</span><br><span class="line">		WriteTimeout: <span class="number">10</span> * time.Second,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	g.Go(<span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">		err := server01.ListenAndServe()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	g.Go(<span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">		err := server02.ListenAndServe()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := g.Wait(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Graceful-Restart-and-Stop"><a href="#Graceful-Restart-and-Stop" class="headerlink" title="Graceful Restart and Stop"></a>Graceful Restart and Stop</h3><p>éšæ‰‹æŸ¥äº†ä¸€ä¸‹ï¼Œä¼˜é›…é‡å¯å’Œä¼˜é›…å…³é—­å®é™…ä¸Šæ˜¯ä¸€ç§ç­–ç•¥ï¼Œå°±æ˜¯åœ¨shutdownçš„æ—¶å€™å…ˆæ‰§è¡Œå®Œæ‰‹ä¸­æ‰€æœ‰çš„å½“ä¸‹æ‰€æœ‰çš„è¯·æ±‚å†å…³é—­ï¼Œä¼˜é›…é‡å¯å°±æ˜¯è¦åœ¨é‡å¯çš„è¿‡ç¨‹ä¸­æ›´åŠ å¹³æ»‘ï¼ˆè¯´äº†ç­‰äºæ²¡è¯´</p>
<p>ä¸‹é¢æ˜¯æŠ„çš„åˆ«çš„åšå®¢ï¼š</p>
<p>ä¸€ç§GracefulRestartçš„æ–¹æ³•æ˜¯ï¼Œé€šè¿‡éƒ¨ç½²ç³»ç»Ÿé…åˆnginxæ¥å®Œæˆã€‚ç”±äºå¤§éƒ¨åˆ†ä¸šåŠ¡ç³»ç»Ÿéƒ½æ˜¯æŒ‚åœ¨nginxä¹‹åé€šè¿‡nginxè¿›è¡Œåå‘ä»£ç†çš„ï¼Œå› æ­¤åœ¨é‡å¯æŸå°æœºå™¨çš„è¿›ç¨‹Aæ—¶ï¼Œå¯ä»¥æŠŠè¯¥æœºå™¨IPä»nginxçš„upstreamä¸­æ‘˜é™¤æ‰ï¼Œç­‰ä¸€æ®µæ—¶é—´æ¯”å¦‚1åˆ†é’Ÿï¼Œè¯¥è¿›ç¨‹å·®ä¸å¤šä¹Ÿå¤„ç†å®Œäº†æ‰€ä»¥è¯·æ±‚ï¼Œå®é™…ä¸Šå·²ç»å¤„äºç©ºé—²çŠ¶æ€äº†ã€‚è¿™æ—¶å°±å¯ä»¥killæ‰è¯¥è¿›ç¨‹å¹¶é‡å¯ï¼Œç­‰é‡å¯æˆåŠŸä¹‹åï¼Œå†æŠŠè¯¥æœºå™¨çš„IPåŠ å›åˆ°nginxå¯¹åº”çš„upstreamä¸­å»ã€‚<br>è¿™ç§æ–¹å¼æ˜¯è¯­è¨€ã€å¹³å°æ— å…³çš„ä¸€ç§æŠ€æœ¯æ–¹æ¡ˆï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š</p>
<ul>
<li>é¦–å…ˆå°±æ˜¯å¤æ‚ï¼Œéœ€è¦éƒ¨ç½²ç³»ç»Ÿå’Œç½‘å…³(nginx)æ°åˆ°å¥½å¤„åœ°é…åˆã€‚å¼€å‘äººå‘˜ç‚¹å‡»éƒ¨ç½²æ—¶ï¼Œéƒ¨ç½²ç³»ç»Ÿéœ€è¦é€šçŸ¥nginxæ‘˜æ‰æŸä¸ªupstreamçš„æŸä¸ªIPï¼›ç„¶åç­‰è¿›ç¨‹é‡å¯æˆåŠŸä¹‹åï¼Œéƒ¨ç½²ç³»ç»Ÿéœ€è¦é€šçŸ¥nginxåœ¨æŸä¸ªupstreamä¸­åŠ ä¸ŠæŸä¸ªIPã€‚è¿™ä¸€æ•´å¥—ç³»ç»Ÿçš„å¼€å‘æµ‹è¯•è¿˜æ˜¯æœ‰ä¸€å®šå¤æ‚æ€§çš„ã€‚</li>
<li>å…¶æ¬¡æ˜¯ç­‰å¾…æ—¶é—´çš„æœªçŸ¥æ€§ã€‚å½“æŠŠæœºå™¨Aæ‘˜æ‰ä»¥åè¿‡å¤šä¹…è¿›ç¨‹æ‰èƒ½å¤„ç†å®Œè¯·æ±‚ï¼Ÿ10ç§’ï¼Ÿ1åˆ†é’Ÿï¼Ÿè°ä¹Ÿä¸çŸ¥é“â€¦é—´éš”çŸ­äº†ï¼Œä¼šå‡ºé—®é¢˜ï¼Œå› ä¸ºéƒ¨åˆ†è¯·æ±‚è¢«å¡æ–­äº†ï¼›é—´éš”é•¿äº†ï¼Œä¸Šçº¿åˆæ…¢ï¼Œè€Œä¸”ä½ è¿˜æ˜¯ä¸èƒ½ç¡®å®šæ˜¯å¦è¯·æ±‚éƒ½å¤„ç†å®Œäº†ï¼ˆå…¶å®åŸºæœ¬ä¸Šæ²¡é—®é¢˜ï¼Œä½†æ˜¯ç†è®ºä¸Šæ— æ³•ä¿è¯ï¼‰ã€‚</li>
<li>å¦ä¸€ä¸ªé—®é¢˜æ˜¯å‹åŠ›é™¡å¢ã€‚å¯¹äºå¤§å…¬å¸åŠ¨è¾„å‡ ç™¾å°çš„é›†ç¾¤ï¼Œæ‘˜ä¸€ä¸¤å°æ— å…³ç´§è¦ã€‚ä½†æ˜¯å¯¹äºå°å…¬å¸ï¼Œæ¯”å¦‚æŸä¸ªæœåŠ¡åªæœ‰ä¸¤å°æœºå™¨ï¼Œå¹¶ä¸”æ¯å°æœºå™¨å‹åŠ›éƒ½æŒºå¤§ã€‚è¿™æ—¶å¦‚æœç›´æ¥æ‘˜ä¸€å°ï¼Œæ‰€æœ‰æµé‡åˆ°å¦ä¸€å°æœºå™¨ä¸Šï¼Œä½¿å¾—é‚£å°æœºå™¨æ‰¿å—ä¸ä½ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ã€‚</li>
</ul>
<p>å› æ­¤è¿™é‡Œå¼•å‡ºç¬¬äºŒç§å®ç°æ–¹å¼â€”â€”fdç»§æ‰¿</p>
<p>åé¢çš„ä¸æŠ„äº†ï¼Œç­‰æœ‰æ—¶é—´æ…¢æ…¢æ•´ç†ä¸€ä¸‹ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/18/golangå­¦ä¹ ç¬”è®°äºŒï¼šconcurrency/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/18/golangå­¦ä¹ ç¬”è®°äºŒï¼šconcurrency/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°äºŒï¼šconcurrency
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-18 10:30:17 / Modified: 10:31:13" itemprop="dateCreated datePublished" datetime="2020-02-18T10:30:17+08:00">2020-02-18</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Goåœ¨æˆ‘ä¸ªäººç†è§£é‡Œæœ€ç‹¬ç‰¹çš„ä¸œè¥¿ï¼Œå¯¹å¹¶å‘æ”¯æŒæœ‰ç€é‡å¤§çš„ä½œç”¨ã€‚</p>
<h2 id="çº¿ç¨‹ï¼Œåç¨‹å’Œgoroutine"><a href="#çº¿ç¨‹ï¼Œåç¨‹å’Œgoroutine" class="headerlink" title="çº¿ç¨‹ï¼Œåç¨‹å’Œgoroutine"></a>çº¿ç¨‹ï¼Œåç¨‹å’Œgoroutine</h2><blockquote>
<ul>
<li>è¿›ç¨‹ï¼šæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å †å’Œæ ˆï¼Œæ—¢ä¸å…±äº«å †ï¼Œäº¦ä¸å…±äº«æ ˆï¼Œè¿›ç¨‹ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ã€‚</li>
<li>çº¿ç¨‹ï¼šæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆå’Œå…±äº«çš„å †ï¼Œå…±äº«å †ï¼Œä¸å…±äº«æ ˆï¼Œçº¿ç¨‹äº¦ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ã€‚</li>
<li>åç¨‹ :å’Œçº¿ç¨‹ä¸€æ ·å…±äº«å †ï¼Œä¸å…±äº«æ ˆï¼Œåç¨‹ç”±ç¨‹åºå‘˜åœ¨åç¨‹çš„ä»£ç é‡Œæ˜¾ç¤ºè°ƒåº¦ã€‚</li>
</ul>
</blockquote>
<p>è¿›ç¨‹æ‡’å¾—è¯´äº†ï¼Œçº¿ç¨‹æŒ‰ç…§é“ç†åº”è¯¥åœ¨JAVAè¯´çš„ï¼Œåç¨‹æŒ‰ç…§é“ç†åº”è¯¥åœ¨swooleé‡Œé¢è¯´çš„ï¼ˆåˆæ¬ äº†ç‚¹ä¸œè¥¿è¦å­¦ï¼‰</p>
<p>ç®€å•è¯´ä¸€ä¸‹å°±æ˜¯ï¼Œåç¨‹å…¨ç¨‹éƒ½æ˜¯ç”¨æˆ·æ€çš„ï¼Œæ“ä½œç³»ç»Ÿå¯¹äºåç¨‹æ²¡æœ‰ä»»ä½•çš„æ„ŸçŸ¥ï¼Œå®ƒæ‰€æœ‰çš„è°ƒåº¦éƒ½ç”±ç”¨æˆ·å®Œæˆã€‚goroutineå…¶å®å°±æ˜¯ä¸éœ€è¦ç”¨æˆ·æŠŠæ‰€æœ‰çš„åç¨‹è°ƒåº¦éƒ½å†™ä¸‹æ¥ï¼Œè€Œæ˜¯ç”¨Goè¯­è¨€åœ¨runtimeï¼Œç³»ç»Ÿè°ƒç”¨ç­‰å¤šæ–¹é¢å¯¹åç¨‹è°ƒåº¦è¿›è¡Œäº†å°è£…å’Œå¤„ç†ã€‚</p>
<h2 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a>goroutine</h2><p>å…¶å®å°±æ˜¯ä¸ªeffective goçš„å­¦ä¹ ç¬”è®°ï¼ˆä¸­æ–‡ç¿»è¯‘ï¼‰ï¼š</p>
<p><a href="https://golang.org/doc/effective_go.html#concurrency" target="_blank" rel="noopener">https://golang.org/doc/effective_go.html#concurrency</a></p>
<p><a href="https://github.com/golang/go/wiki/LearnConcurrency" target="_blank" rel="noopener">https://github.com/golang/go/wiki/LearnConcurrency</a> </p>
<p>ä¸­å¿ƒæ€æƒ³ï¼š</p>
<blockquote>
<p>Do not communicate by sharing memory; instead, share memory by communicating.</p>
</blockquote>
<h3 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h3><p>Communicating Sequential Processes (CSP)</p>
<h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><p>channelæ˜¯ goroutine ä¹‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥ç±»æ¯”æˆ Unix ä¸­çš„è¿›ç¨‹çš„é€šä¿¡æ–¹å¼ç®¡é“ã€‚</p>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>channel ä½¿ç”¨å†…ç½®çš„ make å‡½æ•°åˆ›å»ºï¼Œä¸‹é¢å£°æ˜äº†ä¸€ä¸ª chan int ç±»å‹çš„ channel:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br></pre></td></tr></table></figure>
<p>golang æä¾›äº†å†…ç½®çš„ close å‡½æ•°å¯¹ channel è¿›è¡Œå…³é—­æ“ä½œã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">close</span>(ch)</span><br></pre></td></tr></table></figure>
<p>æœ‰å…³ channel çš„å…³é—­ï¼Œä½ éœ€è¦æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼ˆæŠ„çš„ï¼‰:</p>
<ul>
<li>å…³é—­ä¸€ä¸ªæœªåˆå§‹åŒ–(nil) çš„ channel ä¼šäº§ç”Ÿ panic</li>
<li>é‡å¤å…³é—­åŒä¸€ä¸ª channel ä¼šäº§ç”Ÿ panic</li>
<li>å‘ä¸€ä¸ªå·²å…³é—­çš„ channel ä¸­å‘é€æ¶ˆæ¯ä¼šäº§ç”Ÿ panic</li>
<li>ä»å·²å…³é—­çš„ channel è¯»å–æ¶ˆæ¯ä¸ä¼šäº§ç”Ÿ panicï¼Œä¸”èƒ½è¯»å‡º channel ä¸­è¿˜æœªè¢«è¯»å–çš„æ¶ˆæ¯ï¼Œè‹¥æ¶ˆæ¯å‡å·²è¯»å‡ºï¼Œåˆ™ä¼šè¯»åˆ°ç±»å‹çš„é›¶å€¼ã€‚ä»ä¸€ä¸ªå·²å…³é—­çš„ channel ä¸­è¯»å–æ¶ˆæ¯æ°¸è¿œä¸ä¼šé˜»å¡ï¼Œå¹¶ä¸”ä¼šè¿”å›ä¸€ä¸ªä¸º false çš„ ok-idiomï¼Œå¯ä»¥ç”¨å®ƒæ¥åˆ¤æ–­ channel æ˜¯å¦å…³é—­</li>
<li>å…³é—­ channel ä¼šäº§ç”Ÿä¸€ä¸ªå¹¿æ’­æœºåˆ¶ï¼Œæ‰€æœ‰å‘ channel è¯»å–æ¶ˆæ¯çš„ goroutine éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯</li>
</ul>
<h4 id="buffer"><a href="#buffer" class="headerlink" title="buffer"></a>buffer</h4><p>ç®€å•æ¥è¯´ï¼Œæ— ç¼“å­˜çš„channelåƒå¤šçº¿ç¨‹çš„synchronizeï¼Œå‘ç©ºchannelè¯»å–æ¶ˆæ¯æˆ–è€…å‘æœ‰æ•°æ®çš„channelé‡Œå‘é€æ•°æ®éƒ½ä¼šé˜»å¡ï¼Œæœ‰ç¼“å­˜çš„ channelï¼Œå½“ç¼“å­˜æœªæ»¡æ—¶ï¼Œå‘ channel ä¸­å‘é€æ¶ˆæ¯æ—¶ä¸ä¼šé˜»å¡ï¼Œå½“ç¼“å­˜æ»¡æ—¶ï¼Œå‘é€æ“ä½œå°†è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰å…¶ä»– goroutine ä»ä¸­è¯»å–æ¶ˆæ¯ï¼›ç›¸åº”çš„ï¼Œå½“ channel ä¸­æ¶ˆæ¯ä¸ä¸ºç©ºæ—¶ï¼Œè¯»å–æ¶ˆæ¯ä¸ä¼šå‡ºç°é˜»å¡ï¼Œå½“ channel ä¸ºç©ºæ—¶ï¼Œè¯»å–æ“ä½œä¼šé€ æˆé˜»å¡ï¼Œç›´åˆ°æœ‰ goroutine å‘ channel ä¸­å†™å…¥æ¶ˆæ¯ã€‚</p>
<p>æœ‰ç¼“å­˜çš„channelæœ‰ç‚¹åƒsemaphoreï¼Œåƒä¸‹é¢çš„ä»£ç ï¼Œsem bufferçš„å¤§å°å†³å®šäº†åŒæ—¶æœ‰å‡ ä¸ªåç¨‹åœ¨æ‰§è¡Œhandleã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sem = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, MaxOutstanding)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(r *Request)</span></span> &#123;</span><br><span class="line">    sem &lt;- <span class="number">1</span>    <span class="comment">// Wait for active queue to drain.</span></span><br><span class="line">    process(r)  <span class="comment">// May take a long time.</span></span><br><span class="line">    &lt;-sem       <span class="comment">// Done; enable next request to run.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serve</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        req := &lt;-queue</span><br><span class="line">        <span class="keyword">go</span> handle(req)  <span class="comment">// Don't wait for handle to finish.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶è¿˜æœ‰å¦ä¸€ç§ä¸éœ€è¦ç”¨channelç¼“å­˜å»é™åˆ¶çš„æ–¹æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> r := <span class="keyword">range</span> queue &#123;</span><br><span class="line">        process(r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serve</span><span class="params">(clientRequests <span class="keyword">chan</span> *Request, quit <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Start handlers</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; MaxOutstanding; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> handle(clientRequests)</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;-quit  <span class="comment">// Wait to be told to exit.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¯ä»¥åº”ç”¨çš„ç®—æ³•"><a href="#å¯ä»¥åº”ç”¨çš„ç®—æ³•" class="headerlink" title="å¯ä»¥åº”ç”¨çš„ç®—æ³•"></a>å¯ä»¥åº”ç”¨çš„ç®—æ³•</h4><h5 id="channelåµŒå¥—"><a href="#channelåµŒå¥—" class="headerlink" title="channelåµŒå¥—"></a>channelåµŒå¥—</h5><p>æ¥è‡ªeffective goï¼Œä½†å…¶å®æ²¡æœ‰å¤ªç†è§£ä¹¦ä¸Šè¯´çš„ <code>safe, parallel demultiplexing</code> æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p>
<p>ç®€å•è§£é‡Šä¸€ä¸‹ï¼Œä»£ç æ¥ä¸Šé¢çš„æœ€åä¸€æ®µä»£ç ï¼Œå½“è§£å†³å¤šä¸ªä¸åŒè¿”å›å€¼çš„requesté—®é¢˜çš„æ—¶å€™ï¼Œåˆ©ç”¨ç»“æ„ä½“å’Œresult channelå¯ä»¥è®©handleå˜æˆä¸€ä¸ªé€šç”¨å‡½æ•°ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Request <span class="keyword">struct</span> &#123;</span><br><span class="line">    args        []<span class="keyword">int</span></span><br><span class="line">    f           <span class="function"><span class="keyword">func</span><span class="params">([]<span class="keyword">int</span>)</span> <span class="title">int</span></span></span><br><span class="line"><span class="function">    <span class="title">resultChan</span>  <span class="title">chan</span> <span class="title">int</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ç”±clientè‡ªå·±æä¾›éœ€è¦è§£å†³çš„å‡½æ•°å’Œå®ƒæ‰€æœ‰çš„å‚æ•°ï¼Œå¹¶ä¸”å®šä¸€ä¸ªresult channelç”¨æ¥æ¥æ”¶è¿”å›å€¼ï¼Œè¿™æ ·æ¯ä¸ªrequestéƒ½æœ‰å±äºè‡ªå·±çš„responseè·¯å¾„ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(a []<span class="keyword">int</span>)</span> <span class="params">(s <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> a &#123;</span><br><span class="line">        s += v</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request := &amp;Request&#123;[]<span class="keyword">int</span>&#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;, sum, <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)&#125;</span><br><span class="line"><span class="comment">// Send request</span></span><br><span class="line">clientRequests &lt;- request</span><br><span class="line"><span class="comment">// Wait for response.</span></span><br><span class="line">fmt.Printf(<span class="string">"answer: %d\n"</span>, &lt;-request.resultChan)</span><br></pre></td></tr></table></figure>
<p>å½“requestéƒ½å®šä¹‰å¥½ä¹‹åï¼Œhandlerå°±åªè¦è¿™æ ·å†™å°±å¯ä»¥äº†è€Œå®Œå…¨ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªä¸åŒçš„requestè¿›è¡Œä¿®æ”¹ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> req := <span class="keyword">range</span> queue &#123;</span><br><span class="line">        req.resultChan &lt;- req.f(req.args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="å¹¶è¡Œç®—æ³•"><a href="#å¹¶è¡Œç®—æ³•" class="headerlink" title="å¹¶è¡Œç®—æ³•"></a>å¹¶è¡Œç®—æ³•</h5><p>è¿™ä¸ªå’Œmpiå‡ ä¹ä¸€æ¨¡ä¸€æ ·ä¸æƒ³å†™äº†</p>
<h5 id="leaky-buffer"><a href="#leaky-buffer" class="headerlink" title="leaky buffer"></a>leaky buffer</h5><p>è¿™ä¸ªçš„æ˜¯åŸºäºæ¼æ¡¶ä½œå‡ºçš„è®¾è®¡ï¼Œæ¼æ¡¶æ˜¯åœ¨é€šä¿¡æ‹¥å¡æ§åˆ¶(congestion controlï¼‰ä¸­ä½¿ç”¨çš„ç®—æ³•ã€‚ï¼ˆcongestion control å°±æ¯”å¦‚ä¹‹å‰å­¦çš„æ…¢å¯åŠ¨ï¼Œå¿«é€Ÿæ¢å¤ç­‰ç­‰ã€‚ï¼‰åƒæ¼æ–—ä¸€æ ·ï¼Œæ— è®ºæµå…¥çš„æµé‡å¤šå¤§ï¼Œç»è¿‡æ¼æ–—ä¹‹åæµå‡ºçš„æµé‡é€Ÿç‡éƒ½æ˜¯ç¨³å®šçš„ã€‚</p>
<p>ä¸ºä»€ä¹ˆå«leakyæ˜¯å› ä¸ºå½“æ¼æ–—æ»¡äº†ä¹‹åçš„æ•°æ®å°±ä¼šè¢«ä¸¢å¼ƒï¼Œç„¶åç»è¿‡å…¶ä»–çš„å¤„ç†ã€‚</p>
<p>effective goé‡Œå†™çš„æ¼æ¡¶ç®—æ³•ä¸å¤ªæ¸…æ¥šæˆ‘æ‰¾äº†å¦ä¸€ä¸ª</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> leakybuf</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> LeakyBuf <span class="keyword">struct</span> &#123;</span><br><span class="line">	bufSize  <span class="keyword">int</span> <span class="comment">// size of each buffer</span></span><br><span class="line">	freeList <span class="keyword">chan</span> []<span class="keyword">byte</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewLeakyBuf creates a leaky buffer which can hold at most n buffer, each</span></span><br><span class="line"><span class="comment">// with bufSize bytes.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLeakyBuf</span><span class="params">(n, bufSize <span class="keyword">int</span>)</span> *<span class="title">LeakyBuf</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;LeakyBuf&#123;</span><br><span class="line">		bufSize:  bufSize,</span><br><span class="line">		freeList: <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="keyword">byte</span>, n),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get returns a buffer from the leaky buffer or create a new buffer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lb *LeakyBuf)</span> <span class="title">Get</span><span class="params">()</span> <span class="params">(b []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> b = &lt;-lb.freeList:</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		b = <span class="built_in">make</span>([]<span class="keyword">byte</span>, lb.bufSize)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Put add the buffer into the free buffer pool for reuse. Panic if the buffer</span></span><br><span class="line"><span class="comment">// size is not the same with the leaky buffer's. This is intended to expose</span></span><br><span class="line"><span class="comment">// error usage of leaky buffer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lb *LeakyBuf)</span> <span class="title">Put</span><span class="params">(b []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(b) != lb.bufSize &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">"invalid buffer size that's put into leaky buffer"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> lb.freeList &lt;- b:</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®€å•æ¥è¯´å°±æ˜¯ç”¨å¸¦bufferçš„channel freeListæ¥åšè¿™ä¸ªæ¼æ–—ï¼Œå½“æ¼æ–—ç©ºäº†çš„æ—¶å€™getå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„bufferï¼ˆå…·ä½“å¹²ä»€ä¹ˆæˆ‘ä¹Ÿä¸çŸ¥é“ï¼‰ï¼Œè€Œå¯¹putæ¥è¯´å¦‚æœæ¼æ–—æ»¡äº†å°±ä¼šè¿›å…¥defaultï¼ˆä¹Ÿå°±æ˜¯æŠ›å¼ƒå½“å‰bufferï¼‰ï¼Œè¿™ä¸ªç®—æ³•æ˜¯æƒ³è¯æ˜åˆ©ç”¨channelæ¥å®ç°ä¸€äº›ç®—æ³•ä¼šæ›´åŠ ç®€å•æ˜“æ‡‚ã€‚</p>
<h2 id="ä¸€äº›æ³¨æ„äº‹é¡¹"><a href="#ä¸€äº›æ³¨æ„äº‹é¡¹" class="headerlink" title="ä¸€äº›æ³¨æ„äº‹é¡¹"></a>ä¸€äº›æ³¨æ„äº‹é¡¹</h2><h3 id="åç¨‹å‚æ•°è°ƒç”¨é—®é¢˜"><a href="#åç¨‹å‚æ•°è°ƒç”¨é—®é¢˜" class="headerlink" title="åç¨‹å‚æ•°è°ƒç”¨é—®é¢˜"></a>åç¨‹å‚æ•°è°ƒç”¨é—®é¢˜</h3><p>é¦–å…ˆå›åˆ°æœ€å‰é¢bufferçš„åŠŸèƒ½é‡Œæåˆ°çš„å¯ä»¥å½“semaphoreç”¨çš„ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sem = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, MaxOutstanding)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(r *Request)</span></span> &#123;</span><br><span class="line">    sem &lt;- <span class="number">1</span>    <span class="comment">// Wait for active queue to drain.</span></span><br><span class="line">    process(r)  <span class="comment">// May take a long time.</span></span><br><span class="line">    &lt;-sem       <span class="comment">// Done; enable next request to run.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serve</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        req := &lt;-queue</span><br><span class="line">        <span class="keyword">go</span> handle(req)  <span class="comment">// Don't wait for handle to finish.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶è¿™ä¸ªä»£ç æœ‰é—®é¢˜ï¼Œè™½ç„¶åŒæ—¶åªæœ‰ MaxOutstandingä¸ªåç¨‹ä¼šæ‰§è¡Œï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šåŒæ—¶åˆ›å»ºéå¸¸éå¸¸å¤šä¸ªåç¨‹ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜åšäº†ä¸€å®šçš„æ”¹è¿›ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serve</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> req := <span class="keyword">range</span> queue &#123;</span><br><span class="line">        sem &lt;- <span class="number">1</span></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            process(req) <span class="comment">// Buggy; see explanation below.</span></span><br><span class="line">            &lt;-sem</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠsemè¿™ä¸ªchannelç”¨æ¥æ§åˆ¶åç¨‹çš„åˆ›å»ºï¼Œè¿™æ ·è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™å°±æ¶‰åŠåˆ°æ ‡é¢˜çš„å‚æ•°è°ƒç”¨é—®é¢˜ã€‚</p>
<p>å…¶å®å’Œå¤šçº¿ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œä¸Šé¢åˆ›å»ºçš„æ‰€æœ‰åç¨‹çš„process(req)æŒ‡å‘çš„reqéƒ½æ˜¯åŒä¸€ä¸ªåœ°å€ï¼Œåœ¨å¾ªç¯çš„è¿‡ç¨‹ä¸­reqä¸æ–­åœ°å˜åŒ–ï¼Œå°±ä¼šå¯¼è‡´processçš„reqå¹¶ä¸ä¸€å®šæ˜¯æƒ³æ‰§è¡Œçš„é‚£ä¸€ä¸ªï¼Œå°±å¤šçº¿ç¨‹çš„ç»éªŒæ¥è¯´å¾ªç¯æ¬¡æ•°å°‘çš„è¯å¾ˆæœ‰å¯èƒ½ç¬¬ä¸€ä¸ªåç¨‹åˆ›å»ºå¥½çš„æ—¶å€™reqå·²ç»å¾ªç¯åˆ°äº†æœ€åä¸€ä¸ªã€‚ï¼ˆå¤šçº¿ç¨‹è¸©è¿‡çš„å‘å†è¸©ä¸€éï¼‰</p>
<p>æ‰€ä»¥åˆå¤šäº†ç¬¬äºŒæ¬¡æ”¹è¿›ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serve</span><span class="params">(queue <span class="keyword">chan</span> *Request)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> req := <span class="keyword">range</span> queue &#123;</span><br><span class="line">        sem &lt;- <span class="number">1</span></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(req *Request)</span></span> &#123;</span><br><span class="line">            process(req)</span><br><span class="line">            &lt;-sem</span><br><span class="line">        &#125;(req)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠreqä½œä¸ºå‚æ•°ä¼ è¿›å»å°±æ²¡é—®é¢˜äº†ï¼ŒæŒ‰ç…§cçš„ç»éªŒä¼šç»™å®ƒåœ¨æœ¬åœ°å¤åˆ¶ä¸€å—åœ°å€ç©ºé—´çš„ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¾ªç¯ä¸€å¼€å§‹å°±ï¼šreq := reqï¼Œä½†æ˜¯çœ‹ç€å¾ˆå¥‡æ€ªã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/18/golangå­¦ä¹ ç¬”è®°ä¸€ï¼šåŸºç¡€ç¯‡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/18/golangå­¦ä¹ ç¬”è®°ä¸€ï¼šåŸºç¡€ç¯‡/" itemprop="url">
                  golangå­¦ä¹ ç¬”è®°ä¸€ï¼šåŸºç¡€ç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-18 10:26:31" itemprop="dateCreated datePublished" datetime="2020-02-18T10:26:31+08:00">2020-02-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-02-24 21:54:28" itemprop="dateModified" datetime="2020-02-24T21:54:28+08:00">2020-02-24</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go run hello.go</span></span><br><span class="line">Hello, World!</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go build hello.go </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">hello    hello.go</span><br><span class="line"><span class="meta">$</span><span class="bash"> ./hello </span></span><br><span class="line">Hello, World!</span><br></pre></td></tr></table></figure>
<h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>æ³¨é‡Šå’ŒC++ä¸€æ ·ï¼Œéƒ½æ˜¯/**/ æˆ–è€… //ï¼Œå¯ä»¥ç”¨go docæŒ‡ä»¤æ¥æŸ¥çœ‹ä»£ç ä¸­çš„æ³¨é‡Šï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³æŸ¥æ‰¾parseç›¸å…³çš„å†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go doc -all regexp | grep -i parse</span></span><br></pre></td></tr></table></figure>
<h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><h3 id="å˜é‡å£°æ˜"><a href="#å˜é‡å£°æ˜" class="headerlink" title="å˜é‡å£°æ˜"></a>å˜é‡å£°æ˜</h3><h4 id="ä¸€èˆ¬å½¢å¼"><a href="#ä¸€èˆ¬å½¢å¼" class="headerlink" title="ä¸€èˆ¬å½¢å¼"></a>ä¸€èˆ¬å½¢å¼</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier <span class="keyword">type</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier1, identifier2 <span class="keyword">type</span></span><br></pre></td></tr></table></figure>
<h4 id="æ ¹æ®å€¼è‡ªåŠ¨åˆ¤æ–­ç±»å‹"><a href="#æ ¹æ®å€¼è‡ªåŠ¨åˆ¤æ–­ç±»å‹" class="headerlink" title="æ ¹æ®å€¼è‡ªåŠ¨åˆ¤æ–­ç±»å‹"></a>æ ¹æ®å€¼è‡ªåŠ¨åˆ¤æ–­ç±»å‹</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v_name = value</span><br></pre></td></tr></table></figure>
<h4 id="ç”¨-æ›¿ä»£var"><a href="#ç”¨-æ›¿ä»£var" class="headerlink" title="ç”¨:=æ›¿ä»£var"></a>ç”¨:=æ›¿ä»£var</h4><p>ç”¨:=å£°æ˜çš„å˜é‡å¯ä»¥è¢«å¤šæ¬¡å£°æ˜</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v_name := value</span><br></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>å¯ä»¥åœ¨åˆ›å»ºçš„æ—¶å€™åˆå§‹åŒ–å€¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>ä¸åˆå§‹åŒ–å°±é»˜è®¤é›¶ï¼š</p>
<blockquote>
<ul>
<li><p>æ•°å€¼ç±»å‹ï¼ˆåŒ…æ‹¬complex64/128ï¼‰ä¸º <strong>0</strong></p>
</li>
<li><p>å¸ƒå°”ç±»å‹ä¸º <strong>false</strong></p>
</li>
<li><p>å­—ç¬¦ä¸²ä¸º <strong>â€œâ€</strong>ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰</p>
</li>
<li><p>ä»¥ä¸‹å‡ ç§ç±»å‹ä¸º <strong>nil</strong>ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;   <span class="keyword">var</span> a *<span class="keyword">int</span></span><br><span class="line">&gt;   <span class="keyword">var</span> a []<span class="keyword">int</span></span><br><span class="line">&gt;   <span class="keyword">var</span> a <span class="keyword">map</span>[<span class="keyword">string</span>] <span class="keyword">int</span></span><br><span class="line">&gt;   <span class="keyword">var</span> a <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">&gt;   <span class="keyword">var</span> a <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">string</span>)</span> <span class="title">int</span></span></span><br><span class="line"><span class="function">&gt;   <span class="title">var</span> <span class="title">a</span> <span class="title">error</span> // <span class="title">error</span> æ˜¯æ¥å£</span></span><br><span class="line"><span class="function">&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h3 id="new-å’Œ-make"><a href="#new-å’Œ-make" class="headerlink" title="new å’Œ make"></a>new å’Œ make</h3><blockquote>
<p>Goè¯­è¨€ä¸­çš„ new å’Œ make ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>make åªèƒ½ç”¨æ¥åˆ†é…åŠåˆå§‹åŒ–ç±»å‹ä¸º sliceã€mapã€chan çš„æ•°æ®ã€‚new å¯ä»¥åˆ†é…ä»»æ„ç±»å‹çš„æ•°æ®ï¼›</li>
<li>new åˆ†é…è¿”å›çš„æ˜¯æŒ‡é’ˆï¼Œå³ç±»å‹ *Typeã€‚make è¿”å›å¼•ç”¨ï¼Œå³ Typeï¼›</li>
<li>new åˆ†é…çš„ç©ºé—´è¢«æ¸…é›¶ã€‚make åˆ†é…ç©ºé—´åï¼Œä¼šè¿›è¡Œåˆå§‹åŒ–ï¼›</li>
</ul>
</blockquote>
<h2 id="åŒ…å¼•å…¥"><a href="#åŒ…å¼•å…¥" class="headerlink" title="åŒ…å¼•å…¥"></a>åŒ…å¼•å…¥</h2><h3 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h3><p>ä¸ªäººç†è§£ï¼šå’Œiostreamç±»ä¼¼ï¼Œéƒ½æ˜¯æ ¼å¼åŒ–I/Oçš„åŒ…ï¼Œç®€å•æ ¼å¼ï¼š</p>
<h4 id="Printf"><a href="#Printf" class="headerlink" title="Printf"></a>Printf</h4><p>å°±æ˜¯ä¸ªè¾“å‡ºï¼Œç”¨æ³•å’ŒCçš„printfè¿˜æœ‰pythonçš„<code>format</code>æœ‰ç€å¾®å¦™çš„ç›¸ä¼¼æ€§ï¼Œéƒ½æ˜¯ç¬¬ä¸€ä¸ªå˜é‡å®šä¹‰è¾“å‡ºæ ¼å¼ï¼Œåé¢å¡«å…¥è¾“å‡ºå˜é‡ã€‚</p>
<ol>
<li><code>%v</code> å ä½ç¬¦å¯ä»¥æ‰“å°ä»»ä½• Go çš„å€¼ï¼Œâ€œåŠ å·â€æ ‡è®°(<code>%+v</code>)ä¼šæ·»åŠ å­—æ®µå</li>
<li><code>%T</code> å¯ä»¥æ‰“å°å‡ºå˜é‡çš„ç±»å‹</li>
<li><code>%#v</code>  ç›¸åº”å€¼çš„Goè¯­æ³•è¡¨ç¤º</li>
<li><code>%%</code>  å­—æ¯ä¸Šçš„ç™¾åˆ†å·ï¼Œå¹¶éå€¼çš„å ä½ç¬¦</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> Sample <span class="keyword">struct</span> &#123;</span><br><span class="line">	a   <span class="keyword">int</span></span><br><span class="line">	str <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := Sample&#123;a: <span class="number">1</span>, str: <span class="string">"hello"</span>&#125;</span><br><span class="line"> </span><br><span class="line">	fmt.Printf(<span class="string">"%v\n"</span>, s)   <span class="comment">//&#123;1, hello&#125;</span></span><br><span class="line">	fmt.Printf(<span class="string">"%+v\n"</span>, s)  <span class="comment">//&#123;a:1, str:hello&#125;</span></span><br><span class="line">	fmt.Printf(<span class="string">"%#v\n"</span>, s)  <span class="comment">//main.Sample&#123;a:1, str:"hello"&#125;</span></span><br><span class="line">	fmt.Printf(<span class="string">"%T\n"</span>, s)   <span class="comment">// main.Sample</span></span><br><span class="line">	fmt.Printf(<span class="string">"%%\n"</span>, s.a) <span class="comment">// %  %!(EXTRA int=1)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆæŠ„ä¸€ä¸ªä¾‹å­ï¼‰ï¼Œå…¶ä»–æ™®é€šçš„<code>%d</code>ä»€ä¹ˆçš„å°±æ‡’å¾—å†™äº†ã€‚</p>
<p>å…¶ä»–ç‰¹æ®Šç”¨æ³•ï¼š</p>
<p><strong>æŒ‡å®šå®½åº¦</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fmt.Printf(<span class="string">"%10d\n"</span>, <span class="number">353</span>)  <span class="comment">// will print "       353"</span></span><br><span class="line"><span class="comment">//å°†å®½åº¦æŒ‡å®šä¸º * æ¥å°†å®½åº¦å½“ä½œ Printf çš„å‚æ•°:</span></span><br><span class="line">fmt.Printf(<span class="string">"%*d\n"</span>, <span class="number">10</span>, <span class="number">353</span>)  <span class="comment">// will print "       353"</span></span><br></pre></td></tr></table></figure>
<p><strong>å¤šæ¬¡å¼•ç”¨ä¸€ä¸ªå˜é‡</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœä½ åœ¨ä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ä¸­å¤šæ¬¡å¼•ç”¨ä¸€ä¸ªå˜é‡ï¼Œä½ å¯ä»¥ä½¿ç”¨ %[n]ï¼Œå…¶ä¸­ n æ˜¯ä½ çš„å‚æ•°ç´¢å¼•ï¼ˆä½ç½®ï¼Œä» 1 å¼€å§‹ï¼‰</span></span><br><span class="line">fmt.Printf(<span class="string">"The price of %[1]s was $%[2]d. $%[2]d! imagine that.\n"</span>, <span class="string">"carrot"</span>, <span class="number">23</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Sprintf"><a href="#Sprintf" class="headerlink" title="Sprintf"></a>Sprintf</h4><p><code>Sprintf</code> åˆ™æ ¼å¼åŒ–å¹¶è¿”å›ä¸€ä¸ªå­— ç¬¦ä¸²è€Œä¸å¸¦ä»»ä½•<strong>è¾“å‡º</strong>ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s := fmt.Sprintf(<span class="string">"æ˜¯å­—ç¬¦ä¸² %s "</span>,<span class="string">"string"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Fprintf"><a href="#Fprintf" class="headerlink" title="Fprintf"></a>Fprintf</h4><p>å’ŒPrintfçš„åŒºåˆ«ï¼šæ ¼å¼åŒ–å¹¶è¾“å‡ºåˆ°<code>æŒ‡å®šçš„åœ°æ–¹</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Fprintf(os.Stdout, <span class="string">"%s\n"</span>, <span class="string">"hello world!"</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±æ˜¯å’Œ<code>Printf</code>ä¸€æ ·ä»<code>os.stdout</code>è¾“å‡ºï¼Œçœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">buf := bufio.NewWriter(os.Stdout)</span><br><span class="line">	<span class="comment">// and now so does buf.</span></span><br><span class="line">fmt.Fprintf(buf, <span class="string">"%s\n"</span>, <span class="string">"hello world! - buffered"</span>)</span><br><span class="line">buf.Flush()</span><br></pre></td></tr></table></figure>
<p>å°±å˜æˆäº†æŠŠè¾“å‡ºæ‰”è¿›é˜Ÿåˆ—é‡Œã€‚</p>
<h4 id="Println"><a href="#Println" class="headerlink" title="Println"></a>Println</h4><p>è¾“å‡ºä½†æ˜¯æ— æ³•æ ¼å¼åŒ–ã€‚</p>
<h3 id="è‡ªå®šä¹‰åŒ…"><a href="#è‡ªå®šä¹‰åŒ…" class="headerlink" title="è‡ªå®šä¹‰åŒ…"></a>è‡ªå®šä¹‰åŒ…</h3><p>æŠ„åšå®¢æ—¶é—´ï¼š</p>
<blockquote>
<ul>
<li>æ–‡ä»¶åä¸åŒ…åæ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä¸ä¸€å®šè¦å°†æ–‡ä»¶åä¸åŒ…åå®šæˆåŒä¸€ä¸ªã€‚</li>
<li>æ–‡ä»¶å¤¹åä¸åŒ…åæ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå¹¶ééœ€è¦ä¸€è‡´ã€‚</li>
<li>åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶åªèƒ½æœ‰ä¸€ä¸ªåŒ…åï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ã€‚</li>
</ul>
</blockquote>
<p>æ–‡ä»¶ç»“æ„:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Test</span><br><span class="line">--helloworld.go</span><br><span class="line"></span><br><span class="line">myMath</span><br><span class="line">--myMath1.go</span><br><span class="line">--myMath2.go</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç :</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// helloworld.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"./myMath"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    fmt.Println(<span class="string">"Hello World!"</span>)</span><br><span class="line">    fmt.Println(mathClass.Add(<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">    fmt.Println(mathClass.Sub(<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// myMath1.go</span></span><br><span class="line"><span class="keyword">package</span> mathClass</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(x,y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// myMath2.go</span></span><br><span class="line"><span class="keyword">package</span> mathClass</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sub</span><span class="params">(x,y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x - y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h2><p>å¸¸é‡ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿è¡Œæ—¶ä¸ä¼šè¢«ä¿®æ”¹çš„é‡ï¼Œå¸¸é‡ä¸­çš„æ•°æ®ç±»å‹åªå¯ä»¥æ˜¯å¸ƒå°”å‹ã€æ•°å­—å‹ï¼ˆæ•´æ•°å‹ã€æµ®ç‚¹å‹å’Œå¤æ•°ï¼‰å’Œå­—ç¬¦ä¸²å‹ã€‚å¸¸é‡å¯ä»¥ç”¨<code>len()</code>, <code>cap()</code>, <code>unsafe.Sizeof()</code>å‡½æ•°è®¡ç®—è¡¨è¾¾å¼çš„å€¼ã€‚</p>
<ul>
<li>æ˜¾å¼ç±»å‹å®šä¹‰ï¼š <code>const b string = &quot;abc&quot;</code></li>
<li>éšå¼ç±»å‹å®šä¹‰ï¼š <code>const b = &quot;abc&quot;</code></li>
</ul>
<h3 id="itoa"><a href="#itoa" class="headerlink" title="itoa"></a>itoa</h3><p>iotaï¼Œç‰¹æ®Šå¸¸é‡ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå¯ä»¥è¢«ç¼–è¯‘å™¨ä¿®æ”¹çš„å¸¸é‡ã€‚const ä¸­æ¯æ–°å¢ä¸€è¡Œå¸¸é‡å£°æ˜å°†ä½¿ iota è®¡æ•°ä¸€æ¬¡(iota å¯ç†è§£ä¸º const è¯­å¥å—ä¸­çš„<strong>è¡Œç´¢å¼•</strong>)ã€‚</p>
<p>ç¬¬ä¸€ä¸ª iota ç­‰äº 0ï¼Œæ¯å½“ iota åœ¨æ–°çš„ä¸€è¡Œè¢«ä½¿ç”¨æ—¶ï¼Œå®ƒçš„å€¼éƒ½ä¼šè‡ªåŠ¨åŠ  1ï¼›æ‰€ä»¥ a=0, b=1, c=2 å¯ä»¥ç®€å†™ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    a = <span class="literal">iota</span></span><br><span class="line">    b</span><br><span class="line">    c</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç»§ç»­æŠ„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">const</span> (</span><br><span class="line">            a = <span class="literal">iota</span>   <span class="comment">//0</span></span><br><span class="line">            b          <span class="comment">//1</span></span><br><span class="line">            c          <span class="comment">//2</span></span><br><span class="line">            d = <span class="string">"ha"</span>   <span class="comment">//ç‹¬ç«‹å€¼ï¼Œiota += 1</span></span><br><span class="line">            e          <span class="comment">//"ha"   iota += 1</span></span><br><span class="line">            f = <span class="number">100</span>    <span class="comment">//iota +=1</span></span><br><span class="line">            g          <span class="comment">//100  iota +=1</span></span><br><span class="line">            h = <span class="literal">iota</span>   <span class="comment">//7,æ¢å¤è®¡æ•°</span></span><br><span class="line">            i          <span class="comment">//8</span></span><br><span class="line">    )</span><br><span class="line">    fmt.Println(a,b,c,d,e,f,g,h,i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><p>goçš„è¿ç®—ç¬¦å€’æ˜¯å’ŒCçš„æ²¡ä»€ä¹ˆå¤ªå¤§åŒºåˆ«ï¼Œè¦ç”¨è‡ªå·±æŸ¥ã€‚</p>
<h2 id="è¯­å¥"><a href="#è¯­å¥" class="headerlink" title="è¯­å¥"></a>è¯­å¥</h2><p>æ•´ä½“æ¥è®²å’Œå¸¸ç”¨çš„è¯­è¨€æ²¡ä»€ä¹ˆå¤ªå¤§åŒºåˆ«ï¼Œè¯´ç‚¹ä¸ä¸€æ ·çš„å§</p>
<h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p>Go å¯¹ <code>if</code> è¯­å¥åšäº†ç¨å¾®ä¿®æ”¹ï¼Œæ”¯æŒåœ¨æ¡ä»¶è¯­å¥è¢«æ±‚å€¼ä¹‹å‰å…ˆè¿›è¡Œåˆå§‹åŒ–ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> err := process(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¹Ÿæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ go çš„ç¼–å†™æ–¹å¼ï¼Œè™½ç„¶ <code>err</code> ä¸èƒ½åœ¨ <code>if</code> è¯­å¥ä¹‹å¤–ä½¿ç”¨ï¼Œä½†ä»–å¯ä»¥åœ¨ä»»ä½• <code>else if</code> æˆ–è€… <code>else</code> ä¹‹å†…ä½¿ç”¨ã€‚</p>
<p>è¿™æ ·çš„å†™æ³•å’Œä¸‹é¢çš„å†™æ³•ç›¸æ¯”è¦ç®€ä»‹æ–¹ä¾¿éå¸¸éå¸¸å¤šï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">f, err := os.Open(name)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">d, err := f.Stat()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    f.Close()</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">codeUsing(f, d)</span><br></pre></td></tr></table></figure>
<h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><p>goè¯­è¨€<strong>æ²¡æœ‰while</strong>ï¼Œä¹Ÿæ˜¯forã€‚ã€‚ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> condition &#123; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><h3 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">function_name</span><span class="params">( [parameter list] )</span> [<span class="title">return_types</span>]</span> &#123;</span><br><span class="line">   å‡½æ•°ä½“</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// example</span></span><br><span class="line"><span class="comment">/* å‡½æ•°è¿”å›ä¸¤ä¸ªæ•°çš„æœ€å¤§å€¼ */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(num1, num2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">   <span class="comment">/* å£°æ˜å±€éƒ¨å˜é‡ */</span></span><br><span class="line">   <span class="keyword">var</span> result <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (num1 &gt; num2) &#123;</span><br><span class="line">      result = num1</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result = num2</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h3><p>å¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒGo è¯­è¨€ä½¿ç”¨çš„æ˜¯å€¼ä¼ é€’ï¼Œå³åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¸ä¼šå½±å“åˆ°å®é™…å‚æ•°ã€‚</p>
<p>é™¤äº†æ™®é€šçš„è¿”å›å€¼å¤–ï¼Œå½“ç»™è¿”å›å€¼å‘½åæ—¶ï¼Œå®ƒä¼šè¢«ç›´æ¥åˆå§‹åŒ–ï¼Œå¹¶ä¸”ç»‘å®šç»™ä¸€ä¸ªè¿”å›å€¼ï¼Œè¿™æ ·åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥ç›´æ¥æŠŠå®ƒå½“ä½œå‚æ•°æ¥ç”¨ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadFull</span><span class="params">(r Reader, buf []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(buf) &gt; <span class="number">0</span> &amp;&amp; err == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> nr <span class="keyword">int</span></span><br><span class="line">        nr, err = r.Read(buf)</span><br><span class="line">        n += nr</span><br><span class="line">        buf = buf[nr:]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¿”å›åœ°å€é—®é¢˜ï¼š</strong></p>
<p>å› ä¸ºgoåœ¨æ‰§è¡Œè¿”å›çš„æ—¶å€™ä¼šå…ˆç»™è¿”å›å†…å®¹åˆ†é…åœ°å€ï¼Œæ‰€ä»¥è¿”å›å¼•ç”¨å¹¶ä¸ä¼šæœ‰é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ï¼šreturn &amp;f</p>
<h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><p>è¿˜æ˜¯å’ŒCä¸€æ ·ï¼Œgoè¯­è¨€åˆå§‹åŒ–æ•°ç»„æ—¶éœ€è¦ç”³æ˜æ•°ç»„çš„é•¿åº¦ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> æ•°ç»„å˜é‡å [å…ƒç´ æ•°é‡]Type</span><br><span class="line"> <span class="comment">//  ä¾‹å­</span></span><br><span class="line"><span class="keyword">var</span> a [<span class="number">3</span>]<span class="keyword">int</span>             <span class="comment">// å®šä¹‰ä¸‰ä¸ªæ•´æ•°çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">// â€œ...â€çœç•¥å·ï¼Œåˆ™è¡¨ç¤ºæ•°ç»„çš„é•¿åº¦æ˜¯æ ¹æ®åˆå§‹åŒ–å€¼çš„ä¸ªæ•°æ¥è®¡ç®—</span></span><br><span class="line">q := [...]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯9102å¹´äº†è¿˜ç”¨è¿™ä¹ˆæ­»æ¿çš„è¯­è¨€è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæ‰€ä»¥å‡ºç°äº†åˆ‡ç‰‡ï¼š</p>
<h3 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h3><p>åˆ‡ç‰‡ï¼ˆsliceï¼‰æ˜¯å»ºç«‹åœ¨æ•°ç»„ä¹‹ä¸Šçš„æ›´æ–¹ä¾¿ï¼Œæ›´çµæ´»ï¼Œæ›´å¼ºå¤§çš„æ•°æ®ç»“æ„ã€‚åˆ‡ç‰‡å¹¶ä¸å­˜å‚¨ä»»ä½•å…ƒç´ è€Œåªæ˜¯å¯¹ç°æœ‰æ•°ç»„çš„å¼•ç”¨ã€‚</p>
<p>åˆ‡ç‰‡ä¸ªäººæ„Ÿè§‰å’ŒåŠ¨æ€æ•°ç»„å·®ä¸å¤šï¼Œå…·ä½“çš„è¿ç®—é€»è¾‘å’ŒåŸå› å°±åé¢å†è¯´ï¼Œè¿™é‡Œåªæä½¿ç”¨æ–¹æ³•ã€‚ä½ å¯ä»¥å£°æ˜ä¸€ä¸ªæœªæŒ‡å®šå¤§å°çš„æ•°ç»„æ¥å®šä¹‰åˆ‡ç‰‡ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> identifier []<span class="keyword">type</span></span><br></pre></td></tr></table></figure>
<p>åˆ‡ç‰‡ä¸éœ€è¦è¯´æ˜é•¿åº¦ã€‚</p>
<p>æˆ–ä½¿ç”¨make()å‡½æ•°æ¥åˆ›å»ºåˆ‡ç‰‡:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slice1 []<span class="keyword">type</span> = <span class="built_in">make</span>([]<span class="keyword">type</span>, <span class="built_in">len</span>)</span><br><span class="line"></span><br><span class="line">ä¹Ÿå¯ä»¥ç®€å†™ä¸º</span><br><span class="line"></span><br><span class="line">slice1 := <span class="built_in">make</span>([]<span class="keyword">type</span>, <span class="built_in">len</span>)</span><br></pre></td></tr></table></figure>
<p>å‘åˆ‡ç‰‡ä¸­å¢åŠ æ–°å…ƒç´ ï¼šappend(oldslice, newelement)</p>
<h2 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h2><p>å’ŒCçš„è¿˜æ˜¯æ— æ¯”ç›¸ä¼¼ï¼Œç´¯äº†æ”¾å¼ƒã€‚</p>
<h2 id="ç»“æ„å’Œæ–¹æ³•"><a href="#ç»“æ„å’Œæ–¹æ³•" class="headerlink" title="ç»“æ„å’Œæ–¹æ³•"></a>ç»“æ„å’Œæ–¹æ³•</h2><p>ç»“æ„çš„å®šä¹‰æ–¹æ³•</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> struct_variable_type <span class="keyword">struct</span> &#123;</span><br><span class="line">   member definition</span><br><span class="line">   member definition</span><br><span class="line">   ...</span><br><span class="line">   member definition</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³äºç»“æ„ï¼šï¼ˆæŠ„çš„ï¼‰</p>
<blockquote>
<ol>
<li>ç”¨äºå®šä¹‰å¤æ‚çš„æ•°æ®ç»“æ„</li>
<li>structé‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µ(å±æ€§)ï¼Œå­—æ®µå¯ä»¥æ˜¯ä»»æ„ç±»å‹</li>
<li>structç±»å‹å¯ä»¥å®šä¹‰æ–¹æ³•(æ³¨æ„å’Œå‡½æ•°çš„åŒºåˆ«)</li>
<li>structç±»å‹æ˜¯å€¼ç±»å‹</li>
<li>structç±»å‹å¯ä»¥åµŒå¥—</li>
<li>Goè¯­è¨€æ²¡æœ‰classç±»å‹ï¼Œåªæœ‰structç±»å‹</li>
</ol>
</blockquote>
<p> åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<ol>
<li>æŒ‡é’ˆç±»å‹<br>var å˜é‡ = new (ç»“æ„ä½“åç§°)<br>var å˜é‡ = &amp;ç»“æ„ä½“åç§°{}<br>var å˜é‡ = &amp;ç»“æ„ä½“åç§°{æˆå‘˜A:å€¼ï¼Œæˆå‘˜B:å€¼}</li>
<li>å€¼ç±»å‹<br>var å˜é‡= ç»“æ„ä½“{æˆå‘˜A:å€¼ï¼Œæˆå‘˜B:å€¼}</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Books <span class="keyword">struct</span> &#123;</span><br><span class="line">   title <span class="keyword">string</span></span><br><span class="line">   author <span class="keyword">string</span></span><br><span class="line">   subject <span class="keyword">string</span></span><br><span class="line">   book_id <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> Book1 Books </span><br><span class="line">  <span class="keyword">var</span> Book2 *Books = &amp;Book&#123;&#125;</span><br><span class="line">  <span class="keyword">var</span> Book3 *Books = <span class="built_in">new</span>(Books)</span><br><span class="line">  <span class="keyword">var</span> struct_pointer *Books = &amp;Book1 <span class="comment">//æŒ‡å‘book1ç»“æ„ä½“çš„æŒ‡é’ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¢ä¸ªä¾‹å­ï¼ˆè¿˜æ˜¯æŠ„çš„ï¼‰</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name   <span class="keyword">string</span></span><br><span class="line">    Age    <span class="keyword">int</span></span><br><span class="line">    Source <span class="keyword">int</span></span><br><span class="line">    Next   *Student</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">creat</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> stu_head = Student&#123;Name: <span class="string">"li"</span>, Age: <span class="number">20</span>, Source: <span class="number">100</span>, Next: <span class="literal">nil</span>&#125;</span><br><span class="line">    <span class="keyword">var</span> stu_head1 = <span class="built_in">new</span>(Student)</span><br><span class="line">    <span class="keyword">var</span> stu_head3 = &amp;Student&#123;</span><br><span class="line">        Name: <span class="string">"wang"</span>,</span><br><span class="line">        Age:  <span class="number">12</span>,</span><br><span class="line">        Next: stu_head1,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(stu_head)</span><br><span class="line">    fmt.Println(*stu_head1)</span><br><span class="line">    fmt.Println(stu_head3.Next)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    creat()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p>æ–¹æ³•è¿™ç§ä¸œè¥¿æ€»ç®—å›åˆ°äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„OOç¼–ç¨‹çš„ä¸–ç•Œã€‚ã€‚ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å®ç°æ¥å£æ–¹æ³• */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(struct_name_variable struct_name)</span> <span class="title">method_name1</span><span class="params">()</span> [<span class="title">return_type</span>]</span> &#123;</span><br><span class="line">   <span class="comment">/* æ–¹æ³•å®ç° */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Go æ²¡æœ‰é¢å‘å¯¹è±¡ï¼Œè€Œæˆ‘ä»¬çŸ¥é“å¸¸è§çš„ Javaï¼ŒC++ ç­‰è¯­è¨€ä¸­ï¼Œå®ç°ç±»çš„æ–¹æ³•åšæ³•éƒ½æ˜¯ç¼–è¯‘å™¨éšå¼çš„ç»™å‡½æ•°åŠ ä¸€ä¸ª this æŒ‡é’ˆï¼Œè€Œåœ¨ Go é‡Œï¼Œè¿™ä¸ª this æŒ‡é’ˆéœ€è¦æ˜ç¡®çš„ç”³æ˜å‡ºæ¥ï¼Œå…¶å®å’Œå…¶å®ƒ OO è¯­è¨€å¹¶æ²¡æœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span> <span class="title">getArea</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">  <span class="comment">//c.radius å³ä¸º Circle ç±»å‹å¯¹è±¡ä¸­çš„å±æ€§</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">3.14</span> * c.radius * c.radius</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>åƒPythonçš„dictçš„é”®å€¼å¯¹ï¼Œä½†æ˜¯è¿˜ä¸çŸ¥é“å†…éƒ¨å­˜å‚¨æ–¹å¼ï¼Œç´¯äº†æ€ä¹ˆç”¨ä»¥åå†è¯´ã€‚</p>
<h2 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h2><p>å°±æ˜¯æˆ‘ä»¬çŸ¥é“çš„interfaceã€‚ã€‚ã€‚ã€‚ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™ä¸æ˜¯ç”¨implementationæˆ–è€…æ˜¯ç»§æ‰¿ï¼Œåªè¦åœ¨interfaceé‡Œå®šä¹‰äº†ä¼šè¢«ç»§æ‰¿çš„ç±»å…ƒç´ å°±è¡Œã€‚</p>
<p>ç»§ç»­æŠ„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Phone <span class="keyword">interface</span> &#123;</span><br><span class="line">    call()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> NokiaPhone <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(nokiaPhone NokiaPhone)</span> <span class="title">call</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"I am Nokia, I can call you!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IPhone <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(iPhone IPhone)</span> <span class="title">call</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"I am iPhone, I can call you!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> phone Phone <span class="comment">//!!!,åœ¨å…·ä½“struct iphoneå’Œnokiaé‡Œæ˜¯ä¸‡ä¸‡ä¸èƒ½è¿™ä¹ˆå†™çš„ï¼Œå› ä¸ºnewè¿”å›çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œéœ€è¦èµ‹å€¼ç»™ä¸€ä¸ªæŒ‡é’ˆæ¥æŒ‡å‘è¿™ä¸ªåœ°å€ã€‚</span></span><br><span class="line"></span><br><span class="line">    phone = <span class="built_in">new</span>(NokiaPhone)</span><br><span class="line">    phone.call()</span><br><span class="line"></span><br><span class="line">    phone = <span class="built_in">new</span>(IPhone)</span><br><span class="line">    phone.call()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>interfaceçš„å…·ä½“å®ç°è¯¦è§<a href="https://www.jianshu.com/p/70003e0f49d1" target="_blank" rel="noopener">https://www.jianshu.com/p/70003e0f49d1</a> ï¼ˆåé¢æœ‰ç©ºå†ç ”ç©¶ï¼‰</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/18/RobPike-concurrency-lecture-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nina">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nina's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/18/RobPike-concurrency-lecture-note/" itemprop="url">
                  RobPike concurrency lecture note
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-18 10:19:29 / Modified: 10:25:31" itemprop="dateCreated datePublished" datetime="2020-02-18T10:19:29+08:00">2020-02-18</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Rob Pike çš„è®²åº§</p>
<p>pptï¼š<a href="https://talks.golang.org/2012/concurrency.slide#2" target="_blank" rel="noopener">https://talks.golang.org/2012/concurrency.slide#2</a></p>
<p>vedioï¼š<a href="https://www.youtube.com/watch?v=f6kdp27TYZs" target="_blank" rel="noopener">https://www.youtube.com/watch?v=f6kdp27TYZs</a></p>
<p>å°±æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€ä½†æ˜¯å¾ˆæ¸…æ¥šçš„å…³äºgo concurrencyçš„å…¥é—¨è®²åº§ã€‚</p>
<h2 id="è®²åœ¨å‰é¢"><a href="#è®²åœ¨å‰é¢" class="headerlink" title="è®²åœ¨å‰é¢"></a>è®²åœ¨å‰é¢</h2><h3 id="concurrency-and-parallelism"><a href="#concurrency-and-parallelism" class="headerlink" title="concurrency and parallelism"></a>concurrency and parallelism</h3><p>ä¸æƒ³è¯¦ç»†è¯´ä½†æ˜¯ã€‚ã€‚ã€‚ä»Robçš„è®²åº§æ¥ç®€å•è¯´å°±æ˜¯</p>
<ul>
<li>concurrencyï¼šä¸€ä¸ªprocessor</li>
<li>parallelismï¼šå¤šä¸ªå¤„ç†å™¨åŒæ—¶å¤„ç†</li>
</ul>
<p>ï¼ˆå¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«ç³»åˆ—</p>
<h3 id="CSPçš„å¼€å§‹"><a href="#CSPçš„å¼€å§‹" class="headerlink" title="CSPçš„å¼€å§‹"></a>CSPçš„å¼€å§‹</h3><p>ä¸€åˆ‡çš„å¼€ç«¯ï¼š1978å¹´hoareçš„è®ºæ–‡ï¼Œè®²äº†communicating sequential processçš„åŸç†ã€‚</p>
<h2 id="Go-and-cocurrency"><a href="#Go-and-cocurrency" class="headerlink" title="Go and cocurrency"></a>Go and cocurrency</h2><p>Goå’Œå…¶ä»–å®ç°cspè¯­è¨€æœ€å¤§çš„åŒºåˆ«ï¼šå…¶ä»–è¯­è¨€æ¯”å¦‚Erlangæ˜¯ç›´æ¥å’Œprocessäº¤äº’ï¼Œè€Œgoè¯­è¨€æ˜¯å’Œchannelè¿›è¡Œäº¤æµã€‚</p>
<h3 id="Goroutine"><a href="#Goroutine" class="headerlink" title="Goroutine"></a>Goroutine</h3><ul>
<li>ç®€å•æ¥è¯´ï¼šä¸€ä¸ªç”±goæŒ‡ä»¤ç”Ÿæˆçš„å•ç‹¬è¿è¡Œå‡½æ•°</li>
<li>æ¯ä¸ªgoroutineæ‹¥æœ‰è‡ªå·±çš„stackï¼ŒåŒæ—¶è¿™ä¸ªstackçš„å¤§å°ä¼šéšç€æ‰§è¡Œçš„éœ€è¦å˜å¤§æˆ–ç¼©å°ã€‚è¿™æ ·çš„è¯å’Œæ¯ä¸ªçº¿ç¨‹éƒ½è¦æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œå¹¶ä¸”ä¸ºäº†ä¿è¯è¿è¡Œçš„å­˜å‚¨é—®é¢˜æ ˆç©ºé—´éœ€è¦è®¾è®¡çš„è¶³å¤Ÿå¤§ä¸ä¸€æ ·ï¼Œgoroutineçš„åˆå§‹åŒ–æ˜¯å¾ˆä¾¿å®œçš„</li>
<li>ä»goroutineçš„è°ƒåº¦ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¯èƒ½æ‰§è¡Œç€æˆç™¾ä¸Šåƒä¸ªåç¨‹ï¼ˆå¯ä»¥åé¢æ•´ç†ä¸€ä¸‹goroutineçš„è°ƒåº¦é—®é¢˜ï¼‰</li>
<li>å½“ç„¶ä»ç†è§£ä¸Šæ¥çœ‹å¯ä»¥æŠŠgoroutineç†è§£ä¸ºä¸€ä¸ªéå¸¸éå¸¸è½»ä¾¿çš„çº¿ç¨‹</li>
</ul>
<p>ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">boring</span><span class="params">(msg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; ; i++ &#123;</span><br><span class="line">        fmt.Println(msg, i)</span><br><span class="line">        time.Sleep(time.Duration(rand.Intn(<span class="number">1e3</span>)) * time.Millisecond)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"math/rand"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> boring(<span class="string">"boring!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š<code>Program exited.</code></p>
<h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><p>channelæ˜¯ä¸€ä¸ªgoroutineçš„åŸºç¡€ï¼Œå…·ä½“ä»‹ç»å’Œgoroutineç®€ä»‹é‡Œé¢åŸºæœ¬ä¸Šä¸€æ¨¡ä¸€æ ·ã€‚</p>
<h3 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h3><blockquote>
<p>A control structure unique to concurrency</p>
</blockquote>
<p>çœ‹èµ·æ¥å¾ˆåƒä¸€ä¸ªswitché€‰é¡¹ï¼Œä½†æ˜¯æ˜¯å®Œå…¨é’ˆå¯¹concurrencyè®¾ç½®çš„ï¼Œå®ƒå’Œswitchçš„åŒºåˆ«ï¼š</p>
<ul>
<li>æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯ä¸€ä¸ªcommunication(send or receive)</li>
<li>åœ¨å¼€å§‹æ—¶ä¼šè¡¡é‡æ‰€æœ‰çš„communication</li>
<li>æ•´ä¸ªæµç¨‹ä¼šä¸€ç›´å¡ä½ç›´åˆ°æŸä¸ªcommunicationå¯ä»¥è¿›è¡Œä¸‹å»</li>
<li>å¦‚æœåŒæ—¶æœ‰å¤šä¸ªcommunicationéƒ½å¯ä»¥è¿›è¡Œï¼Œéšæœºé€‰å–ä¸€ä¸ªè¿›è¡Œ</li>
<li>å¦‚æœæ‰€æœ‰communicationéƒ½æ— æ³•è¿›è¡Œå¹¶ä¸”æœ‰ä¸€ä¸ªdefaulté€‰é¡¹ï¼Œä¸å¡ä½ç›´æ¥èµ°default</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> v1 := &lt;-c1:</span><br><span class="line">    fmt.Printf(<span class="string">"received %v from c1\n"</span>, v1)</span><br><span class="line"><span class="keyword">case</span> v2 := &lt;-c2:</span><br><span class="line">    fmt.Printf(<span class="string">"received %v from c2\n"</span>, v1)</span><br><span class="line"><span class="keyword">case</span> c3 &lt;- <span class="number">23</span>:</span><br><span class="line">    fmt.Printf(<span class="string">"sent %v to c3\n"</span>, <span class="number">23</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    fmt.Printf(<span class="string">"no one was ready to communicate\n"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Daisy-chain"><a href="#Daisy-chain" class="headerlink" title="Daisy-chain"></a>Daisy-chain</h3><p>èŠèŠ±é“¾å¹¶ä¸æ˜¯ä¸€ä¸ªåƒselectä¸€æ ·çš„å‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯ä»¥ç”¨goè¯­è¨€å’Œåç¨‹æ¥ç®€å•å®ç°çš„åŠŸèƒ½</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(left, right <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    left &lt;- <span class="number">1</span> + &lt;-right</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">const</span> n = <span class="number">10000</span></span><br><span class="line">    leftmost := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">    right := leftmost</span><br><span class="line">    left := leftmost</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">        right = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">        <span class="keyword">go</span> f(left, right)</span><br><span class="line">        left = right</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(c <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123; c &lt;- <span class="number">1</span> &#125;(right)</span><br><span class="line">    fmt.Println(&lt;-leftmost)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/../images/go/Daisy_chain.png" alt="Daisy Chain"></p>
<p>è¿™æ®µä»£ç å®ç°çš„å°±æ˜¯ä¸Šå›¾æ‰€ç¤ºçš„é€»è¾‘ï¼Œçœ‹èµ·æ¥éå¸¸éš¾ä»¥ç†è§£ï¼Œå®é™…ä¸Šmakeä¸€ä¸ªchannelä¹‹åè¿”å›çš„æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥å°±æ˜¯ä¸€å¼€å§‹leftå’ŒrightæŒ‡å‘çš„éƒ½æ˜¯æœ€å·¦ç«¯ä¹Ÿå°±æ˜¯ç»ˆç«¯çš„channelï¼Œä¹‹åæ–°å»ºäº†ä¸€ä¸ªchannelï¼Œå¹¶ä¸”è®©å·¦è¾¹çš„channelå»è·å–æ–°å»ºchannelçš„å€¼ï¼Œç„¶åå†æŠŠleftçš„æŒ‡é’ˆæŒ‡å‘å®ƒè®©å®ƒå˜æˆä¸‹ä¸€ä¸ªå·¦è¾¹ã€‚æœ€åå‘æœ€å³è¾¹çš„channelè¾“å…¥ä¸€ä¸ªå€¼ï¼Œè§¦å‘äº†è¿™æ¡ä¼ è¯é“¾ã€‚</p>
<p>ä»å®é™…çš„è¿è¡Œæƒ…å†µæ¥çœ‹ï¼Œå³ä½¿æˆ‘ä»¬åˆ›å»ºäº†ä¸Šä¸‡ä¸ªåç¨‹æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯è¿è¡Œæ—¶é—´éå¸¸è¿…é€Ÿï¼Œåç¨‹è½»é‡çš„ç‰¹å¾è®©ä»–åœ¨åˆ›å»ºå’Œè¿è¡Œçš„æ—¶å€™éå¸¸è¿…é€Ÿã€‚</p>
<h2 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a>Attention</h2><p>ç®€å•æ¥è¯´ï¼Œgoå’Œconcurrencyæ˜¯ä¸€ç§ç”¨äºsoftware constructionçš„éå¸¸å¥½çš„è¯­è¨€ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ä¸è¦æ€é¸¡ç”¨ç‰›åˆ€ï¼Œä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨å°±å¯ä»¥è§£å†³çš„é—®é¢˜å°±ä¸è¦ç”¨channeläº†ğŸ˜‚</p>
<p>goé‡Œé¢ä¹Ÿæä¾›äº†sync/atomicåŒ…æ¥æä¾›ä¸€äº›åœ°å€è®¿é—®åŒæ­¥/é”ç­‰å¤šçº¿ç¨‹ä¼šç”¨åˆ°çš„æ“ä½œï¼Œåˆç†è€ƒè™‘ä½¿ç”¨channelã€‚</p>
<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><p>ä¸€äº›å­¦ä¹ ç½‘ç«™</p>
<p>Go Home Page:</p>
<p><a href="http://golang.org/" target="_blank" rel="noopener">golang.org</a></p>
<p>Go Tour (learn Go in your browser)</p>
<p><a href="http://tour.golang.org/" target="_blank" rel="noopener">tour.golang.org</a></p>
<p>Package documentation:</p>
<p><a href="http://golang.org/pkg" target="_blank" rel="noopener">golang.org/pkg</a></p>
<p>Articles galore:</p>
<p><a href="http://golang.org/doc" target="_blank" rel="noopener">golang.org/doc</a></p>
<p>Concurrency is not parallelism:</p>
<p><a href="http://golang.org/s/concurrency-is-not-parallelism" target="_blank" rel="noopener">golang.org/s/concurrency-is-not-parallelism</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Nina" />
            
              <p class="site-author-name" itemprop="name">Nina</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">26</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">32</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nina</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Pisces</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->



  



	





  





  










  





  

  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  


  
  

  

  

  

  

  

</body>
</html>
